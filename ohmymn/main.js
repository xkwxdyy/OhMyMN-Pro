
/*
THIS IS A GENERATED/BUNDLED FILE BY ESBuild

MIT License
Copyright (c) 2021 Ou Rongxing

If you want to view the source code, please visit the github repository.
Github: https://github.com/ourongxing/ohmymn

Welcome to contribute to this project!
*/

try {

"use strict";(()=>{var Ou=Object.create;var pn=Object.defineProperty;var Du=Object.getOwnPropertyDescriptor;var Lu=Object.getOwnPropertyNames;var Bu=Object.getPrototypeOf,Uu=Object.prototype.hasOwnProperty;var Fu=(e,t,o)=>t in e?pn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var $=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Gu=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Lu(t))!Uu.call(e,n)&&n!==o&&pn(e,n,{get:()=>t[n],enumerable:!(r=Du(t,n))||r.enumerable});return e};var C=(e,t,o)=>(o=e!=null?Ou(Bu(e)):{},Gu(t||!e||!e.__esModule?pn(o,"default",{value:e,enumerable:!0}):o,e));var _i=(e,t,o)=>(Fu(e,typeof t!="symbol"?t+"":t,o),o);var To=$((Pg,Ci)=>{var Wu=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};Ci.exports=Wu});var vo=$(($g,Si)=>{var Vu="2.0.0",Ku=Number.MAX_SAFE_INTEGER||9007199254740991,ju=16;Si.exports={SEMVER_SPEC_VERSION:Vu,MAX_LENGTH:256,MAX_SAFE_INTEGER:Ku,MAX_SAFE_COMPONENT_LENGTH:ju}});var Jt=$((Ot,ki)=>{var{MAX_SAFE_COMPONENT_LENGTH:fn}=vo(),qu=To();Ot=ki.exports={};var zu=Ot.re=[],T=Ot.src=[],v=Ot.t={},Hu=0,R=(e,t,o)=>{let r=Hu++;qu(e,r,t),v[e]=r,T[r]=t,zu[r]=new RegExp(t,o?"g":void 0)};R("NUMERICIDENTIFIER","0|[1-9]\\d*");R("NUMERICIDENTIFIERLOOSE","[0-9]+");R("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*");R("MAINVERSION",`(${T[v.NUMERICIDENTIFIER]})\\.(${T[v.NUMERICIDENTIFIER]})\\.(${T[v.NUMERICIDENTIFIER]})`);R("MAINVERSIONLOOSE",`(${T[v.NUMERICIDENTIFIERLOOSE]})\\.(${T[v.NUMERICIDENTIFIERLOOSE]})\\.(${T[v.NUMERICIDENTIFIERLOOSE]})`);R("PRERELEASEIDENTIFIER",`(?:${T[v.NUMERICIDENTIFIER]}|${T[v.NONNUMERICIDENTIFIER]})`);R("PRERELEASEIDENTIFIERLOOSE",`(?:${T[v.NUMERICIDENTIFIERLOOSE]}|${T[v.NONNUMERICIDENTIFIER]})`);R("PRERELEASE",`(?:-(${T[v.PRERELEASEIDENTIFIER]}(?:\\.${T[v.PRERELEASEIDENTIFIER]})*))`);R("PRERELEASELOOSE",`(?:-?(${T[v.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${T[v.PRERELEASEIDENTIFIERLOOSE]})*))`);R("BUILDIDENTIFIER","[0-9A-Za-z-]+");R("BUILD",`(?:\\+(${T[v.BUILDIDENTIFIER]}(?:\\.${T[v.BUILDIDENTIFIER]})*))`);R("FULLPLAIN",`v?${T[v.MAINVERSION]}${T[v.PRERELEASE]}?${T[v.BUILD]}?`);R("FULL",`^${T[v.FULLPLAIN]}$`);R("LOOSEPLAIN",`[v=\\s]*${T[v.MAINVERSIONLOOSE]}${T[v.PRERELEASELOOSE]}?${T[v.BUILD]}?`);R("LOOSE",`^${T[v.LOOSEPLAIN]}$`);R("GTLT","((?:<|>)?=?)");R("XRANGEIDENTIFIERLOOSE",`${T[v.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);R("XRANGEIDENTIFIER",`${T[v.NUMERICIDENTIFIER]}|x|X|\\*`);R("XRANGEPLAIN",`[v=\\s]*(${T[v.XRANGEIDENTIFIER]})(?:\\.(${T[v.XRANGEIDENTIFIER]})(?:\\.(${T[v.XRANGEIDENTIFIER]})(?:${T[v.PRERELEASE]})?${T[v.BUILD]}?)?)?`);R("XRANGEPLAINLOOSE",`[v=\\s]*(${T[v.XRANGEIDENTIFIERLOOSE]})(?:\\.(${T[v.XRANGEIDENTIFIERLOOSE]})(?:\\.(${T[v.XRANGEIDENTIFIERLOOSE]})(?:${T[v.PRERELEASELOOSE]})?${T[v.BUILD]}?)?)?`);R("XRANGE",`^${T[v.GTLT]}\\s*${T[v.XRANGEPLAIN]}$`);R("XRANGELOOSE",`^${T[v.GTLT]}\\s*${T[v.XRANGEPLAINLOOSE]}$`);R("COERCE",`(^|[^\\d])(\\d{1,${fn}})(?:\\.(\\d{1,${fn}}))?(?:\\.(\\d{1,${fn}}))?(?:$|[^\\d])`);R("COERCERTL",T[v.COERCE],!0);R("LONETILDE","(?:~>?)");R("TILDETRIM",`(\\s*)${T[v.LONETILDE]}\\s+`,!0);Ot.tildeTrimReplace="$1~";R("TILDE",`^${T[v.LONETILDE]}${T[v.XRANGEPLAIN]}$`);R("TILDELOOSE",`^${T[v.LONETILDE]}${T[v.XRANGEPLAINLOOSE]}$`);R("LONECARET","(?:\\^)");R("CARETTRIM",`(\\s*)${T[v.LONECARET]}\\s+`,!0);Ot.caretTrimReplace="$1^";R("CARET",`^${T[v.LONECARET]}${T[v.XRANGEPLAIN]}$`);R("CARETLOOSE",`^${T[v.LONECARET]}${T[v.XRANGEPLAINLOOSE]}$`);R("COMPARATORLOOSE",`^${T[v.GTLT]}\\s*(${T[v.LOOSEPLAIN]})$|^$`);R("COMPARATOR",`^${T[v.GTLT]}\\s*(${T[v.FULLPLAIN]})$|^$`);R("COMPARATORTRIM",`(\\s*)${T[v.GTLT]}\\s*(${T[v.LOOSEPLAIN]}|${T[v.XRANGEPLAIN]})`,!0);Ot.comparatorTrimReplace="$1$2$3";R("HYPHENRANGE",`^\\s*(${T[v.XRANGEPLAIN]})\\s+-\\s+(${T[v.XRANGEPLAIN]})\\s*$`);R("HYPHENRANGELOOSE",`^\\s*(${T[v.XRANGEPLAINLOOSE]})\\s+-\\s+(${T[v.XRANGEPLAINLOOSE]})\\s*$`);R("STAR","(<|>)?=?\\s*\\*");R("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");R("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Po=$((Ig,Ti)=>{var Ju=["includePrerelease","loose","rtl"],Xu=e=>e?typeof e!="object"?{loose:!0}:Ju.filter(t=>e[t]).reduce((t,o)=>(t[o]=!0,t),{}):{};Ti.exports=Xu});var dn=$((Ng,$i)=>{var vi=/^[0-9]+$/,Pi=(e,t)=>{let o=vi.test(e),r=vi.test(t);return o&&r&&(e=+e,t=+t),e===t?0:o&&!r?-1:r&&!o?1:e<t?-1:1},Zu=(e,t)=>Pi(t,e);$i.exports={compareIdentifiers:Pi,rcompareIdentifiers:Zu}});var Te=$((Eg,Ai)=>{var yr=To(),{MAX_LENGTH:Ii,MAX_SAFE_INTEGER:br}=vo(),{re:Ni,t:Ei}=Jt(),Yu=Po(),{compareIdentifiers:co}=dn(),Fe=class{constructor(t,o){if(o=Yu(o),t instanceof Fe){if(t.loose===!!o.loose&&t.includePrerelease===!!o.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid Version: ${t}`);if(t.length>Ii)throw new TypeError(`version is longer than ${Ii} characters`);yr("SemVer",t,o),this.options=o,this.loose=!!o.loose,this.includePrerelease=!!o.includePrerelease;let r=t.trim().match(o.loose?Ni[Ei.LOOSE]:Ni[Ei.FULL]);if(!r)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>br||this.major<0)throw new TypeError("Invalid major version");if(this.minor>br||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>br||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(n=>{if(/^[0-9]+$/.test(n)){let i=+n;if(i>=0&&i<br)return i}return n}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(yr("SemVer.compare",this.version,this.options,t),!(t instanceof Fe)){if(typeof t=="string"&&t===this.version)return 0;t=new Fe(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof Fe||(t=new Fe(t,this.options)),co(this.major,t.major)||co(this.minor,t.minor)||co(this.patch,t.patch)}comparePre(t){if(t instanceof Fe||(t=new Fe(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let o=0;do{let r=this.prerelease[o],n=t.prerelease[o];if(yr("prerelease compare",o,r,n),r===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(r===void 0)return-1;if(r===n)continue;return co(r,n)}while(++o)}compareBuild(t){t instanceof Fe||(t=new Fe(t,this.options));let o=0;do{let r=this.build[o],n=t.build[o];if(yr("prerelease compare",o,r,n),r===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(r===void 0)return-1;if(r===n)continue;return co(r,n)}while(++o)}inc(t,o){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",o);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",o);break;case"prepatch":this.prerelease.length=0,this.inc("patch",o),this.inc("pre",o);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",o),this.inc("pre",o);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let r=this.prerelease.length;for(;--r>=0;)typeof this.prerelease[r]=="number"&&(this.prerelease[r]++,r=-2);r===-1&&this.prerelease.push(0)}o&&(co(this.prerelease[0],o)===0?isNaN(this.prerelease[1])&&(this.prerelease=[o,0]):this.prerelease=[o,0]);break;default:throw new Error(`invalid increment argument: ${t}`)}return this.format(),this.raw=this.version,this}};Ai.exports=Fe});var He=$((Ag,Mi)=>{var Ri=Te(),Qu=(e,t,o)=>new Ri(e,o).compare(new Ri(t,o));Mi.exports=Qu});var $o=$((Rg,Oi)=>{var ep=He(),tp=(e,t,o)=>ep(e,t,o)>=0;Oi.exports=tp});var S=$((Mg,Tl)=>{"use strict";var op=Object.create,Cr=Object.defineProperty,rp=Object.getOwnPropertyDescriptor,np=Object.getOwnPropertyNames,ip=Object.getPrototypeOf,lp=Object.prototype.hasOwnProperty,ap=(e,t)=>{for(var o in t)Cr(e,o,{get:t[o],enumerable:!0})},Bi=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of np(t))!lp.call(e,n)&&n!==o&&Cr(e,n,{get:()=>t[n],enumerable:!(r=rp(t,n))||r.enumerable});return e},sp=(e,t,o)=>(o=e!=null?op(ip(e)):{},Bi(t||!e||!e.__esModule?Cr(o,"default",{value:e,enumerable:!0}):o,e)),cp=e=>Bi(Cr({},"__esModule",{value:!0}),e),Ui={};ap(Ui,{CGRectString2CGRect:()=>bn,CGRectValue2CGRect:()=>$p,CGSizeString2CGSize:()=>wl,CGSizeValue2CGSize:()=>Pp,DirectionOfSelection:()=>kl,DocMapSplitMode:()=>Yi,GroupMode:()=>el,HUDController:()=>mp,MN:()=>I,NSDataReadingOptions:()=>Gi,NSDataSearchOptions:()=>Vi,NSDataWritingOptions:()=>Wi,NSJSONReadingOptions:()=>ji,NSJSONWritingOptions:()=>Ki,NSLineBreakMode:()=>rl,NSLocaleLanguageDirection:()=>qi,NSNull2Null:()=>Ip,NSStringEncoding:()=>Fi,NSTextAlignment:()=>ml,NSURLBookmarkCreationOptions:()=>Ji,NSURLBookmarkFileCreationOptions:()=>Hi,NSURLBookmarkResolutionOptions:()=>zi,NSValue2String:()=>Sr,NodeNote:()=>Io,NotebookType:()=>Qi,OSType:()=>Xi,StudyMode:()=>Zi,UIAlertViewStyle:()=>tl,UIButtonType:()=>ol,UIControlEvents:()=>il,UIControlState:()=>nl,UIGestureRecognizerState:()=>yl,UIImageOrientation:()=>ll,UISwipeGestureRecognizerDirection:()=>bl,UITableViewCellAccessoryTypeStyle:()=>fl,UITableViewCellSelectionStyle:()=>pl,UITableViewCellSeparatorStyle:()=>sl,UITableViewCellStyle:()=>dl,UITableViewRowAnimation:()=>ul,UITableViewScrollPosition:()=>cl,UITableViewStyle:()=>al,UITextBorderStyle:()=>hl,UIViewAutoresizing:()=>gl,alert:()=>hp,confirm:()=>gp,copy:()=>Cp,copyFile:()=>Up,defineEventHandlers:()=>jp,defineGestureHandlers:()=>Hp,defineLifecycleHandlers:()=>Vp,delay:()=>yn,evaluateJavaScript:()=>wp,eventObserverController:()=>Kp,exportPic:()=>_r,fetch:()=>Ap,genNSURL:()=>wr,gestureRecognizerController:()=>qp,getDocURL:()=>Xp,getLocalDataByKey:()=>bp,getObjCClassDeclar:()=>kp,getPageContent:()=>Jp,i18n:()=>Sp,initGesture:()=>zp,isNSNull:()=>_l,isNoteExist:()=>Mp,isNoteLink:()=>Rp,isfileExists:()=>Lp,loopBreak:()=>Tp,openFile:()=>Wp,openURL:()=>_p,popup:()=>gn,postNotification:()=>xl,readJSON:()=>Bp,removeHighlight:()=>Dp,saveFile:()=>Sl,saveTextFile:()=>Gp,select:()=>yp,setLocalDataByKey:()=>xp,setTimeInterval:()=>vp,showHUD:()=>xr,undoGroupingWithRefresh:()=>Op,writeJSON:()=>Fp,writeTextFile:()=>Cl});Tl.exports=cp(Ui);var Fi=(e=>(e[e.ASCIIStringEncoding=1]="ASCIIStringEncoding",e[e.ISO2022JP=21]="ISO2022JP",e[e.ISOLatin1=5]="ISOLatin1",e[e.ISOLatin2=9]="ISOLatin2",e[e.JapaneseEUC=3]="JapaneseEUC",e[e.MacOSRoman=30]="MacOSRoman",e[e.NEXTSTEP=2]="NEXTSTEP",e[e.NonLossyASCII=7]="NonLossyASCII",e[e.ShiftJIS=8]="ShiftJIS",e[e.Symbol=6]="Symbol",e[e.Unicode=10]="Unicode",e[e.UTF16BigEndian=2415919360]="UTF16BigEndian",e[e.UTF16LittleEndian=2483028224]="UTF16LittleEndian",e[e.UTF32=2348810496]="UTF32",e[e.UTF32BigEndian=2550137088]="UTF32BigEndian",e[e.UTF32LittleEndian=2617245952]="UTF32LittleEndian",e[e.UTF8=4]="UTF8",e[e.WindowsCP1250=15]="WindowsCP1250",e[e.WindowsCP1251=11]="WindowsCP1251",e[e.WindowsCP1252=12]="WindowsCP1252",e[e.WindowsCP1253=13]="WindowsCP1253",e[e.WindowsCP1254=14]="WindowsCP1254",e))(Fi||{}),Gi=(e=>(e[e.Coordinated=4]="Coordinated",e[e.Mapped=1]="Mapped",e[e.MappedAlways=8]="MappedAlways",e[e.Uncached=2]="Uncached",e))(Gi||{}),Wi=(e=>(e[e.Atomic=1]="Atomic",e[e.FileProtectionComplete=536870912]="FileProtectionComplete",e[e.FileProtectionCompleteUnlessOpen=805306368]="FileProtectionCompleteUnlessOpen",e[e.FileProtectionCompleteUntilFirstUserAuthentication=1073741824]="FileProtectionCompleteUntilFirstUserAuthentication",e[e.FileProtectionMask=4026531840]="FileProtectionMask",e[e.FileProtectionNone=268435456]="FileProtectionNone",e[e.WithoutOverwriting=2]="WithoutOverwriting",e))(Wi||{}),Vi=(e=>(e[e.SearchAnchored=2]="SearchAnchored",e[e.SearchBackwards=1]="SearchBackwards",e))(Vi||{}),Ki=(e=>(e[e.PrettyPrinted=0]="PrettyPrinted",e[e.SortedKeys=1]="SortedKeys",e[e.FragmentsAllowed=2]="FragmentsAllowed",e[e.WithoutEscapingSlashes=3]="WithoutEscapingSlashes",e))(Ki||{}),ji=(e=>(e[e.MutableContainers=1]="MutableContainers",e[e.MutableLeaves=2]="MutableLeaves",e[e.FragmentsAllowed=4]="FragmentsAllowed",e[e.JSON5Allowed=8]="JSON5Allowed",e[e.TopLevelDictionaryAssumed=16]="TopLevelDictionaryAssumed",e))(ji||{}),qi=(e=>(e[e.BottomToTop=4]="BottomToTop",e[e.LeftToRight=1]="LeftToRight",e[e.RightToLeft=2]="RightToLeft",e[e.TopToBottom=3]="TopToBottom",e[e.Unknown=0]="Unknown",e))(qi||{}),zi=(e=>(e[e.WithoutMounting=512]="WithoutMounting",e[e.WithoutUI=256]="WithoutUI",e[e.WithSecurityScope=1024]="WithSecurityScope",e))(zi||{}),Hi=(e=>(e[e.MinimalBookmark=512]="MinimalBookmark",e[e.PreferFileIDResolution=256]="PreferFileIDResolution",e[e.SecurityScopeAllowOnlyReadAccess=4096]="SecurityScopeAllowOnlyReadAccess",e[e.SuitableForBookmarkFile=1024]="SuitableForBookmarkFile",e[e.WithSecurityScope=2048]="WithSecurityScope",e))(Hi||{}),Ji=(e=>(e[e.MinimalBookmark=512]="MinimalBookmark",e[e.PreferFileIDResolution=256]="PreferFileIDResolution",e[e.SecurityScopeAllowOnlyReadAccess=4096]="SecurityScopeAllowOnlyReadAccess",e[e.SuitableForBookmarkFile=1024]="SuitableForBookmarkFile",e[e.WithSecurityScope=2048]="WithSecurityScope",e))(Ji||{}),Xi=(e=>(e[e.iPadOS=0]="iPadOS",e[e.iPhoneOS=1]="iPhoneOS",e[e.macOS=2]="macOS",e))(Xi||{}),Zi=(e=>(e[e.doc0=0]="doc0",e[e.doc1=1]="doc1",e[e.study=2]="study",e[e.review=3]="review",e))(Zi||{}),Yi=(e=>(e[e.allMap=0]="allMap",e[e.half=1]="half",e[e.allDoc=2]="allDoc",e))(Yi||{}),Qi=(e=>(e[e.Hiden=0]="Hiden",e[e.Doc=1]="Doc",e[e.MindMap=2]="MindMap",e[e.FlashCard=3]="FlashCard",e))(Qi||{}),el=(e=>(e[e.Tree=0]="Tree",e[e.Frame=1]="Frame",e))(el||{}),tl=(e=>(e[e.Default=0]="Default",e[e.SecureTextInput=1]="SecureTextInput",e[e.PlainTextInput=2]="PlainTextInput",e[e.LoginAndPasswordInput=3]="LoginAndPasswordInput",e))(tl||{}),ol=(e=>(e[e.system=0]="system",e))(ol||{}),rl=(e=>{})(rl||{}),nl=(e=>{})(nl||{}),il=(e=>{})(il||{}),ll=(e=>(e[e.Down=1]="Down",e[e.DownMirrored=5]="DownMirrored",e[e.Left=2]="Left",e[e.LeftMirrored=6]="LeftMirrored",e[e.Right=3]="Right",e[e.RightMirrored=7]="RightMirrored",e[e.Up=0]="Up",e[e.UpMirrored=4]="UpMirrored",e))(ll||{}),al=(e=>{})(al||{}),sl=(e=>{})(sl||{}),cl=(e=>(e[e.Bottom=3]="Bottom",e[e.Middle=2]="Middle",e[e.None=0]="None",e[e.Top=1]="Top",e))(cl||{}),ul=(e=>(e[e.Fade=0]="Fade",e[e.Right=1]="Right",e[e.Left=2]="Left",e[e.Top=3]="Top",e[e.Bottom=4]="Bottom",e[e.None=5]="None",e[e.Middle=6]="Middle",e[e.Automatic=7]="Automatic",e))(ul||{}),pl=(e=>{})(pl||{}),fl=(e=>{})(fl||{}),dl=(e=>(e[e.Default=0]="Default",e[e.Value1=1]="Value1",e[e.Value2=2]="Value2",e[e.Subtitle=3]="Subtitle",e))(dl||{}),ml=(e=>(e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right",e[e.Justified=3]="Justified",e[e.Natural=4]="Natural",e))(ml||{}),hl=(e=>{})(hl||{}),gl=(e=>{})(gl||{}),yl=(e=>{})(yl||{}),bl=(e=>(e[e.Right=1]="Right",e[e.Left=2]="Left",e[e.Up=4]="Up",e[e.Down=8]="Down",e))(bl||{}),Di=sp($o()),Li,up=class{constructor(){var e;this.app=Application.sharedInstance(),this.db=Database.sharedInstance(),this.isZH=(Li=NSLocale.preferredLanguages())==null?void 0:Li[0].startsWith("zh"),this.version=(e=this.app.appVersion)!=null?e:"3.7.21",this.isMN4=(0,Di.default)(this.version,"4.0.0"),this.isMac=this.app.osType===2,this.isMacMN4=this.isMac&&(0,Di.default)(this.version,"4.0.2"),this.isMacMN3=this.isMac&&!this.isMacMN4,this.scheme=this.isMN4?"marginnote4app":"marginnote3app",this.themeColor={Gray:UIColor.colorWithHexString("#414141"),Default:UIColor.colorWithHexString("#FFFFFF"),Dark:UIColor.colorWithHexString("#000000"),Green:UIColor.colorWithHexString("#E9FBC7"),Sepia:UIColor.colorWithHexString("#F5EFDC")}}get studyController(){return this.app.studyController(this.app.focusWindow)}get notebookController(){return this.studyController.notebookController}get currentDocumentController(){return this.studyController.readerController.currentDocumentController}get currentWindow(){return this.app.focusWindow}get currentThemeColor(){return this.themeColor[this.app.currentTheme]}get currentAddon(){var o,r;var e,t;return{key:(o=(e=self.addon)==null?void 0:e.key)!=null?o:"mnaddon",title:(r=(t=self.addon)==null?void 0:t.title)!=null?r:"MarginNote"}}get currnetNotebookId(){var e;return(e=this.notebookController)==null?void 0:e.notebookId}get currentDocmd5(){try{let{docMd5:e}=this.currentDocumentController;return e&&e.length===32?"00000000":e}catch{return}}log(e,t="normal",...o){self.useConsole?console.log(e,`${I.currentAddon.key}-${t}`,...o):JSB.log(`${I.currentAddon.key}-${t} %@`,e)}error(e,t="error",...o){self.useConsole?console.error(e,`${I.currentAddon.key}-${t}`,...o):JSB.log(`${I.currentAddon.key}-${t} %@`,String(e)==="[object Object]"?JSON.stringify(e,void 0,2):String(e))}},I=new up,pp={copy_success:"\u590D\u5236\u6210\u529F, \u5FEB\u53BB\u7C98\u8D34\u5427!",copy_empty:"\u8981\u590D\u5236\u7684\u5185\u5BB9\u4E3A\u7A7A",sure:"\u786E\u5B9A",cancel:"\u{1F645} \u53D6\u6D88",not_JSON:"\u8FD4\u56DE\u503C\u4E0D\u662F\u6709\u6548\u7684 JSON \u683C\u5F0F",not_receive:"\u6CA1\u6709\u6536\u5230\u8FD4\u56DE\u503C\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC",make_your_choice:"\u505A\u51FA\u4F60\u7684\u9009\u62E9"},fp={copy_success:"Copy successfully, go ahead and paste",copy_empty:"The content to be copied is empty",sure:"Confirm",cancel:"\u{1F645}\u200D\u2640\uFE0F Cancel",not_JSON:"The returned value is not a valid JSON format",not_receive:"No return value received, please check the network",make_your_choice:"Make your choice"},Xt=I.isZH?pp:fp;function dp(e){return Array.from(e).reduce((t,o)=>(t+=o.charCodeAt(0)>255?2:1,t),0)}function mn(e,t,...o){let r=[t,...o].map(n=>(n<0&&(n=dp(e)+n),n===0||n===1?n:Array.from(e).reduce((i,l,a)=>{let s=i.byte+(l.charCodeAt(0)>255?2:1);return!i.enough&&s<=n?i={index:a,byte:s,enough:!1}:i={...i,enough:!0},i},{index:0,byte:0,enough:!1}).index+1));return e.slice(...r)}var Dt=(e,t=!1)=>{let o=[];return e.length<=1?o=e:o=Array.from(new Set(e)),t&&(o=o.filter(r=>r)),o};function xr(e,t=2,o=I.currentWindow){I.app.showHUD(e,o,t)}var mp={show(e,t=I.currentWindow){I.app.waitHUDOnView(e,t)},hidden(e,t=2,o=I.currentWindow){I.app.stopWaitHUDOnView(o),e&&xr(e,t,o)}};function hp(e){I.app.alert(e)}function gn({title:e=I.currentAddon.title,message:t,type:o=0,buttons:r=[Xt.sure],canCancel:n=!0,multiLine:i=!1}){return new Promise(l=>n?UIAlertView.showWithTitleMessageStyleCancelButtonTitleOtherButtonTitlesTapBlock(e,t,o,Xt.cancel,i?r.map(a=>mn(a.replace(/\n/g,""),0,40)):r,(a,s)=>{l({inputContent:o===0?void 0:a.textFieldAtIndex(0).text,buttonIndex:s-1})}):UIAlertView.showWithTitleMessageStyleCancelButtonTitleOtherButtonTitlesTapBlock(e,t,o,i?mn(r[0].replace(/\n/g,""),0,40):r[0],i?r.slice(1).map(a=>mn(a.replace(/\n/g,""),0,40)):r.slice(1),(a,s)=>{l({inputContent:o===0?void 0:a.textFieldAtIndex(0).text,buttonIndex:s})}))}async function gp(e=I.currentAddon.title,t=""){let{buttonIndex:o}=await gn({title:e,message:t,buttons:[Xt.sure],multiLine:!1,canCancel:!0});return o===0}async function yp(e,t=I.currentAddon.title,o=Xt.make_your_choice,r=!1){let{buttonIndex:n}=await gn({title:t,message:o,buttons:e,multiLine:!0,canCancel:r});return{value:e[n],index:n}}function bp(e){return NSUserDefaults.standardUserDefaults().objectForKey(e)}function xp(e,t){NSUserDefaults.standardUserDefaults().setObjectForKey(e,t)}function wp(e,t){return new Promise(o=>e.evaluateJavaScript(t,o))}function wr(e,t=!1){return e=e.trim(),/^[\w\-]+:\/\//.test(e)||(e=`https://${e}`),NSURL.URLWithString(t?encodeURI(e):e)}function _p(e,t=!1){I.app.openURL(wr(e,t))}function xl(e,t){NSNotificationCenter.defaultCenter().postNotificationNameObjectUserInfo(e,self,t)}function Cp(e,t=!0){e?(UIPasteboard.generalPasteboard().string=e.trim(),t&&xr(Xt.copy_success)):t&&xr(Xt.copy_empty)}function Sp(e){return I.isZH?e.zh:e.en}function kp(e,t){return`${e} : ${t}`}function yn(e){return new Promise(t=>NSTimer.scheduledTimerWithTimeInterval(e,!1,t))}async function Tp(e,t,o){for(let r=0;r<e;r++){if(o())return!0;await yn(t)}return!1}async function vp(e,t){let o=async(n,i,l)=>{for(;!l.stop;)i(),await yn(n)},r={stop:!1};return o(e,t,r),{invalidate:()=>{r.stop=!0}}}function Sr(e){return Database.transArrayToJSCompatible([e])[0]}function bn(e){let t=e.match(/\d+\.?\d+/g).map(o=>Number(o));return{x:t[0],y:t[1],height:t[2],width:t[3]}}function wl(e){let t=e.match(/\d+\.?\d+/g).map(o=>Number(o));return{width:t[0],height:t[1]}}function Pp(e){return wl(Sr(e))}function $p(e){return bn(Sr(e))}function _l(e){return e===NSNull.new()}function Ip(e){return _l(e)?null:e}var Np=class{constructor(e){this.data=e}json(){if(this.data.length()===0)return{};let e=NSJSONSerialization.JSONObjectWithDataOptions(this.data,1);if(NSJSONSerialization.isValidJSONObject(e))return e;throw Xt.not_JSON}text(){return this.data.length()===0,""}};function Ep(e,t){var n,i,l;let o=NSMutableURLRequest.requestWithURL(wr(e));o.setHTTPMethod((n=t.method)!=null?n:"GET"),o.setTimeoutInterval((i=t.timeout)!=null?i:10);let r={"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.1 Safari/605.1.15","Content-Type":"application/json",Accept:"application/json"};return o.setAllHTTPHeaderFields({...r,...(l=t.headers)!=null?l:{}}),t.search?o.setURL(wr(`${e.trim()}?${Object.entries(t.search).reduce((a,s)=>{let[c,u]=s;return`${a?a+"&":""}${c}=${encodeURIComponent(u)}`},"")}`)):t.body?o.setHTTPBody(NSData.dataWithStringEncoding(t.body,4)):t.form?o.setHTTPBody(NSData.dataWithStringEncoding(Object.entries(t.form).reduce((a,s)=>{let[c,u]=s;return`${a?a+"&":""}${c}=${encodeURIComponent(u)}`},""),4)):t.json&&o.setHTTPBody(NSJSONSerialization.dataWithJSONObjectOptions(t.json,1)),o}function Ap(e,t={}){return new Promise((o,r)=>{let n=NSOperationQueue.mainQueue(),i=Ep(e,t);NSURLConnection.sendAsynchronousRequestQueueCompletionHandler(i,n,(l,a,s)=>{s.localizedDescription&&r(s.localizedDescription),o(new Np(a))})})}function Rp(e){return e.startsWith(I.scheme+"://note/")}function Mp(e){return typeof e=="string"?!!I.db.getNoteById(e):!!I.db.getNoteById(e.noteId)}function Op(e){I.currnetNotebookId&&(UndoManager.sharedInstance().undoGrouping(String(Date.now()),I.currnetNotebookId,e),I.db.setNotebookSyncDirty(I.currnetNotebookId),xl("RefreshAfterDBChange",{notebookid:I.currnetNotebookId}))}function Dp(e){return e&&e.replace(/\*\*/g,"")}function Lp(e){return NSFileManager.defaultManager().fileExistsAtPath(e)}function Cl(e,t){NSData.dataWithStringEncoding(t,4).writeToFileAtomically(e,!1)}function Bp(e){let t=NSJSONSerialization.JSONObjectWithDataOptions(NSData.dataWithContentsOfFile(e),1);if(NSJSONSerialization.isValidJSONObject(t))return t;throw"Invalid JSON"}function Up(e,t){return NSFileManager.defaultManager().copyItemAtPathToPath(e,t)}function Fp(e,t){NSData.dataWithStringEncoding(JSON.stringify(t,void 0,2),4).writeToFileAtomically(e,!1)}function Sl(e,t){I.app.saveFileWithUti(e,t)}function Gp(e,t,o="public.plain-text"){let r=`${I.app.tempPath}/${t}`;Cl(r,e),Sl(r,o)}async function Wp(...e){return new Promise(t=>{I.app.openFileWithUTIs(e,I.studyController,o=>{t(o)})})}function Vp(e){return e}function Kp(e){return{add:()=>{e.forEach(r=>{var i;r=typeof r=="string"?{event:r}:r;let n=(i=r.handler)!=null?i:`on${r.event}`;NSNotificationCenter.defaultCenter().addObserverSelectorName(self,`${n}:`,r.event)})},remove:()=>{e.forEach(r=>{NSNotificationCenter.defaultCenter().removeObserverName(self,typeof r=="string"?r:r.event)})}}}function jp(e){return e}var kl=(e=>(e[e.toRight=1]="toRight",e[e.toLeft=2]="toLeft",e))(kl||{});function qp(e){return{add:()=>{e.forEach(r=>{r.view.addGestureRecognizer(r.gesture)})},remove:()=>{e.forEach(r=>{r.view.removeGestureRecognizer(r.gesture)})}}}var zp={swipe(e,t,o){let r=new UISwipeGestureRecognizer(self,`${o}:`);return r.addTargetAction(self,`${o}:`),r.numberOfTouchesRequired=e,r.direction=t,r},tap(e,t,o){let r=new UITapGestureRecognizer(self,`${o}:`);return r.addTargetAction(self,`${o}:`),r.numberOfTapsRequired=t,r.numberOfTouchesRequired=e,r},pan(e){let t=new UIPanGestureRecognizer(self,`${e}:`);return t.addTargetAction(self,`${e}:`),t}};function Hp(e){return e}function _r(e){var t;let o=(t=I.db.getMediaByHash(e.paint))==null?void 0:t.base64Encoding();if(o)return{html:`<img class="MNPic" src="data:image/jpeg;base64,${o}"/>`,md:`![MNPic](data:image/jpeg;base64,${o})`}}function hn(e){var t;let o={ocr:[],html:[],md:[]},r=(t=e.excerptText)==null?void 0:t.trim();if(e.excerptPic){let n=_r(e.excerptPic);n&&Object.entries(n).forEach(([i,l])=>{i in o&&o[i].push(l)}),r&&o.ocr.push(r)}else r&&Object.values(o).forEach(n=>n.push(r));return o}var Io=class{constructor(e,t){if(this.note=e,I.isMN4){t=t!=null?t:e.notebookId;let o=t&&e.realGroupNoteIdForTopicId&&e.realGroupNoteIdForTopicId(t);if(o){let r=I.db.getNoteById(o);r&&r.createDate.getTime()!==e.createDate.getTime()&&(this.note=r)}}else{let o=e.groupNoteId;if(o){let r=I.db.getNoteById(o);r&&(this.note=r)}}}static getSelectedNodes(){let e=I.notebookController.mindmapView.selViewLst;return e!=null&&e.length?e.map(t=>new Io(t.note.note)):[]}get nodeId(){return this.note.noteId}get descendantNodes(){let{childNodes:e}=this;if(e.length){let o=function(r,n=0,i=[],l={descendant:[],treeIndex:[]}){return n++,r.forEach((a,s)=>{var c;l.descendant.push(a),i=i.slice(0,n-1),i.push(s),l.treeIndex.push(i),(c=a.childNodes)!=null&&c.length&&o(a.childNodes,n,i,l)}),l};var t=o;return o(e)}else return{descendant:[],treeIndex:[]}}get ancestorNodes(){function e(t,o){if(t.note.parentNote){let r=new Io(t.note.parentNote);o=e(r,[...o,r])}return o}return e(this,[])}get childNodes(){var t;var e;return(t=(e=this.note.childNotes)==null?void 0:e.map(o=>new Io(o)))!=null?t:[]}get parentNode(){return this.note.parentNote&&new Io(this.note.parentNote)}get notes(){return this.note.comments.reduce((e,t)=>(t.type=="LinkNote"&&e.push(I.db.getNoteById(t.noteid)),e),[this.note])}get titles(){var t;var e;return Dt((t=(e=this.note.noteTitle)==null?void 0:e.split(/\s*[;；]\s*/))!=null?t:[],!0)}set titles(e){let t=Dt(e,!0).join("; ");this.note.excerptText===this.note.noteTitle?(this.note.noteTitle=t,this.note.excerptText=t):this.note.noteTitle=t}get isOCR(){var e;if((e=this.note.excerptPic)!=null&&e.paint)return this.note.textFirst}get title(){var e;return(e=this.note.noteTitle)!=null?e:""}set title(e){this.note.noteTitle=e}get mainExcerptText(){var e;return(e=this.note.excerptText)!=null?e:""}set mainExcerptText(e){this.note.excerptText=e}appendTitles(...e){let t=Dt([...this.titles,...e],!0).join("; ");return this.note.excerptText===this.note.noteTitle?(this.note.noteTitle=t,this.note.excerptText=t):this.note.noteTitle=t,this}get tags(){return this.note.comments.reduce((t,o)=>(o.type=="TextNote"&&o.text.startsWith("#")&&t.push(...o.text.split(/\s+/).filter(r=>r.startsWith("#"))),t),[]).map(t=>t.slice(1))}set tags(e){this.tidyupTags(),e=Dt(e,!0);let t=this.note.comments[this.note.comments.length-1];(t==null?void 0:t.type)=="TextNote"&&t.text.startsWith("#")&&this.note.removeCommentByIndex(this.note.comments.length-1),this.appendTextComments(e.map(o=>`#${o}`).join(" "))}appendTags(...e){this.tidyupTags(),e=Dt([...this.tags,...e],!0);let t=this.note.comments[this.note.comments.length-1];return(t==null?void 0:t.type)=="TextNote"&&t.text.startsWith("#")&&this.note.removeCommentByIndex(this.note.comments.length-1),this.appendTextComments(e.map(o=>`#${o}`).join(" ")),this}tidyupTags(){let e=[],t=[];return this.note.comments.forEach((o,r)=>{if(o.type=="TextNote"&&o.text.startsWith("#")){let n=o.text.split(" ").filter(i=>i.startsWith("#"));e.push(...n.map(i=>i.slice(1))),t.unshift(r)}}),t.forEach(o=>{this.note.removeCommentByIndex(o)}),this.appendTextComments(Dt(e).map(o=>`#${o}`).join(" ")),this}getCommentIndex(e){let t=this.note.comments;for(let o=0;o<t.length;o++){let r=t[o];if(typeof e=="string"){if(r.type=="TextNote"&&r.text==e)return o}else if(r.type=="LinkNote"&&r.noteid==e.noteId)return o}return-1}get excerptsTextPic(){return this.notes.reduce((e,t)=>(Object.entries(hn(t)).forEach(([o,r])=>{o in e&&e[o].push(...r)}),e),{ocr:[],html:[],md:[]})}get commentsTextPic(){return this.note.comments.reduce((e,t)=>{if(t.type==="PaintNote"){let o=_r(t);o&&Object.entries(o).forEach(([r,n])=>{r in e&&e[r].push(n)})}else if(t.type=="TextNote"||t.type=="HtmlNote"){let o=t.text.trim();o&&!o.includes(I.scheme)&&!o.startsWith("#")&&Object.values(e).map(r=>r.push(o))}return e},{html:[],md:[]})}get excerptsText(){return this.notes.reduce((e,t)=>{var o,r;let n=(o=t.excerptText)==null?void 0:o.trim();return n&&(!((r=t.excerptPic)!=null&&r.paint)||this.isOCR)&&e.push(n),e},[])}get commentsText(){return this.note.comments.reduce((e,t)=>{if(t.type=="TextNote"||t.type=="HtmlNote"){let o=t.text.trim();o&&!o.includes(I.scheme)&&!o.startsWith("#")&&e.push(o)}return e},[])}get allTextPic(){let e=hn(this.note);return this.note.comments.forEach(t=>{if(t.type==="PaintNote"){let o=_r(t);o&&Object.entries(o).forEach(([r,n])=>{r in e&&e[r].push(n)})}else if(t.type=="TextNote"||t.type=="HtmlNote"){let o=t.text.trim();o&&Object.values(e).map(r=>r.push(o))}else if(t.type=="LinkNote"){let o=I.db.getNoteById(t.noteid);o&&Object.entries(hn(o)).forEach(([r,n])=>{r in e&&e[r].push(...n)})}}),{html:e.html.join(`

`),ocr:e.ocr.join(`

`),md:e.md.join(`

`)}}get allText(){var e;let{mainExcerptText:t}=this,o=t&&(!((e=this.note.excerptPic)!=null&&e.paint)||this.isOCR)?[t]:[];return this.note.comments.forEach(r=>{var n,i;if(r.type=="TextNote"||r.type=="HtmlNote"){let l=r.text.trim();l&&o.push(l)}else if(r.type=="LinkNote"){let l=I.db.getNoteById(r.noteid),a=(n=l==null?void 0:l.excerptText)==null?void 0:n.trim();a&&(!((i=l==null?void 0:l.excerptPic)!=null&&i.paint)||this.isOCR)&&o.push(a)}}),o.join(`

`)}get excerptsCommentsText(){var e;let{mainExcerptText:t}=this,o=t&&(!((e=this.note.excerptPic)!=null&&e.paint)||this.isOCR)?[t]:[];return this.note.comments.forEach(r=>{var n,i;if(r.type=="TextNote"||r.type=="HtmlNote"){let l=r.text.trim();l&&!l.includes(I.scheme)&&!l.startsWith("#")&&o.push(l)}else if(r.type=="LinkNote"){let l=I.db.getNoteById(r.noteid),a=(n=l==null?void 0:l.excerptText)==null?void 0:n.trim();a&&(!((i=l==null?void 0:l.excerptPic)!=null&&i.paint)||this.isOCR)&&o.push(a)}}),o}appendTextComments(...e){e=Dt(e,!0);let t=this.note.comments.filter(o=>o.type==="TextNote");return e.forEach(o=>{o&&t.every(r=>r.type==="TextNote"&&r.text!==o)&&this.note.appendTextComment(o)}),this}appendMarkdownComments(...e){e=Dt(e,!0);let t=this.note.comments.filter(o=>o.type==="TextNote");return e.forEach(o=>{o&&t.every(r=>r.type==="TextNote"&&r.text!==o)&&(this.note.appendMarkdownComment?this.note.appendMarkdownComment(o):this.note.appendTextComment(o))}),this}async removeCommentButLinkTag(e,t){let{removedIndex:o,linkTags:r}=this.note.comments.reduce((n,i,l)=>(i.type=="TextNote"&&(i.text.includes(I.scheme+"://note/")||i.text.startsWith("#"))?(n.linkTags.push(i.text),n.removedIndex.unshift(l)):e(i)||n.removedIndex.unshift(l),n),{removedIndex:[],linkTags:[]});return o.forEach(n=>{this.note.removeCommentByIndex(n)}),t&&await t(this),this.appendTextComments(...r),this}};function Jp(e){let{document:t}=I.currentDocumentController;if(!t)return"";let o=t.textContentsForPageNo(e);return o!=null&&o.length?o.reduce((r,n)=>{let i=n.reduce((l,a)=>(l+=String.fromCharCode(Number(a.char)),l),"");if(i){let{y:l}=bn(Sr(n[0].rect));r.push({y:l,line:i})}return r},[]).sort((r,n)=>n.y-r.y).map(r=>r.line).join(" ").trim():""}function Xp(e,t,o){var r,n,i,l;let a=I.db.getNotebookById(t);if(!a)return`${I.scheme}://notebook/${t}`;let s;return o?s=(n=(r=a==null?void 0:a.notes)==null?void 0:r.find(c=>c.docMd5===e&&c.modifiedDate&&(c.startPage===o||c.endPage===o)))==null?void 0:n.noteId:s=(l=(i=a==null?void 0:a.notes)==null?void 0:i.find(c=>c.docMd5===e&&c.modifiedDate))==null?void 0:l.noteId,a?`${I.scheme}://note/${s}`:`${I.scheme}://notebook/${t}`}});var Zt=$((Kg,Al)=>{var{MAX_LENGTH:Zp}=vo(),{re:Il,t:Nl}=Jt(),El=Te(),Yp=Po(),Qp=(e,t)=>{if(t=Yp(t),e instanceof El)return e;if(typeof e!="string"||e.length>Zp||!(t.loose?Il[Nl.LOOSE]:Il[Nl.FULL]).test(e))return null;try{return new El(e,t)}catch{return null}};Al.exports=Qp});var Ml=$((jg,Rl)=>{var ef=Zt(),tf=(e,t)=>{let o=ef(e,t);return o?o.version:null};Rl.exports=tf});var Dl=$((qg,Ol)=>{var of=Zt(),rf=(e,t)=>{let o=of(e.trim().replace(/^[=v]+/,""),t);return o?o.version:null};Ol.exports=rf});var Ul=$((zg,Bl)=>{var Ll=Te(),nf=(e,t,o,r)=>{typeof o=="string"&&(r=o,o=void 0);try{return new Ll(e instanceof Ll?e.version:e,o).inc(t,r).version}catch{return null}};Bl.exports=nf});var kr=$((Hg,Fl)=>{var lf=He(),af=(e,t,o)=>lf(e,t,o)===0;Fl.exports=af});var Vl=$((Jg,Wl)=>{var Gl=Zt(),sf=kr(),cf=(e,t)=>{if(sf(e,t))return null;{let o=Gl(e),r=Gl(t),n=o.prerelease.length||r.prerelease.length,i=n?"pre":"",l=n?"prerelease":"";for(let a in o)if((a==="major"||a==="minor"||a==="patch")&&o[a]!==r[a])return i+a;return l}};Wl.exports=cf});var jl=$((Xg,Kl)=>{var uf=Te(),pf=(e,t)=>new uf(e,t).major;Kl.exports=pf});var zl=$((Zg,ql)=>{var ff=Te(),df=(e,t)=>new ff(e,t).minor;ql.exports=df});var Jl=$((Yg,Hl)=>{var mf=Te(),hf=(e,t)=>new mf(e,t).patch;Hl.exports=hf});var Zl=$((Qg,Xl)=>{var gf=Zt(),yf=(e,t)=>{let o=gf(e,t);return o&&o.prerelease.length?o.prerelease:null};Xl.exports=yf});var Ql=$((ey,Yl)=>{var bf=He(),xf=(e,t,o)=>bf(t,e,o);Yl.exports=xf});var ta=$((ty,ea)=>{var wf=He(),_f=(e,t)=>wf(e,t,!0);ea.exports=_f});var Tr=$((oy,ra)=>{var oa=Te(),Cf=(e,t,o)=>{let r=new oa(e,o),n=new oa(t,o);return r.compare(n)||r.compareBuild(n)};ra.exports=Cf});var ia=$((ry,na)=>{var Sf=Tr(),kf=(e,t)=>e.sort((o,r)=>Sf(o,r,t));na.exports=kf});var aa=$((ny,la)=>{var Tf=Tr(),vf=(e,t)=>e.sort((o,r)=>Tf(r,o,t));la.exports=vf});var No=$((iy,sa)=>{var Pf=He(),$f=(e,t,o)=>Pf(e,t,o)>0;sa.exports=$f});var vr=$((ly,ca)=>{var If=He(),Nf=(e,t,o)=>If(e,t,o)<0;ca.exports=Nf});var xn=$((ay,ua)=>{var Ef=He(),Af=(e,t,o)=>Ef(e,t,o)!==0;ua.exports=Af});var Pr=$((sy,pa)=>{var Rf=He(),Mf=(e,t,o)=>Rf(e,t,o)<=0;pa.exports=Mf});var wn=$((cy,fa)=>{var Of=kr(),Df=xn(),Lf=No(),Bf=$o(),Uf=vr(),Ff=Pr(),Gf=(e,t,o,r)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof o=="object"&&(o=o.version),e===o;case"!==":return typeof e=="object"&&(e=e.version),typeof o=="object"&&(o=o.version),e!==o;case"":case"=":case"==":return Of(e,o,r);case"!=":return Df(e,o,r);case">":return Lf(e,o,r);case">=":return Bf(e,o,r);case"<":return Uf(e,o,r);case"<=":return Ff(e,o,r);default:throw new TypeError(`Invalid operator: ${t}`)}};fa.exports=Gf});var ma=$((uy,da)=>{var Wf=Te(),Vf=Zt(),{re:$r,t:Ir}=Jt(),Kf=(e,t)=>{if(e instanceof Wf)return e;if(typeof e=="number"&&(e=String(e)),typeof e!="string")return null;t=t||{};let o=null;if(!t.rtl)o=e.match($r[Ir.COERCE]);else{let r;for(;(r=$r[Ir.COERCERTL].exec(e))&&(!o||o.index+o[0].length!==e.length);)(!o||r.index+r[0].length!==o.index+o[0].length)&&(o=r),$r[Ir.COERCERTL].lastIndex=r.index+r[1].length+r[2].length;$r[Ir.COERCERTL].lastIndex=-1}return o===null?null:Vf(`${o[2]}.${o[3]||"0"}.${o[4]||"0"}`,t)};da.exports=Kf});var ga=$((py,ha)=>{"use strict";ha.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}});var ba=$((fy,ya)=>{"use strict";ya.exports=W;W.Node=Yt;W.create=W;function W(e){var t=this;if(t instanceof W||(t=new W),t.tail=null,t.head=null,t.length=0,e&&typeof e.forEach=="function")e.forEach(function(n){t.push(n)});else if(arguments.length>0)for(var o=0,r=arguments.length;o<r;o++)t.push(arguments[o]);return t}W.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,o=e.prev;return t&&(t.prev=o),o&&(o.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=o),e.list.length--,e.next=null,e.prev=null,e.list=null,t};W.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}};W.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}};W.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)qf(this,arguments[e]);return this.length};W.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)zf(this,arguments[e]);return this.length};W.prototype.pop=function(){if(!!this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}};W.prototype.shift=function(){if(!!this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}};W.prototype.forEach=function(e,t){t=t||this;for(var o=this.head,r=0;o!==null;r++)e.call(t,o.value,r,this),o=o.next};W.prototype.forEachReverse=function(e,t){t=t||this;for(var o=this.tail,r=this.length-1;o!==null;r--)e.call(t,o.value,r,this),o=o.prev};W.prototype.get=function(e){for(var t=0,o=this.head;o!==null&&t<e;t++)o=o.next;if(t===e&&o!==null)return o.value};W.prototype.getReverse=function(e){for(var t=0,o=this.tail;o!==null&&t<e;t++)o=o.prev;if(t===e&&o!==null)return o.value};W.prototype.map=function(e,t){t=t||this;for(var o=new W,r=this.head;r!==null;)o.push(e.call(t,r.value,this)),r=r.next;return o};W.prototype.mapReverse=function(e,t){t=t||this;for(var o=new W,r=this.tail;r!==null;)o.push(e.call(t,r.value,this)),r=r.prev;return o};W.prototype.reduce=function(e,t){var o,r=this.head;if(arguments.length>1)o=t;else if(this.head)r=this.head.next,o=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var n=0;r!==null;n++)o=e(o,r.value,n),r=r.next;return o};W.prototype.reduceReverse=function(e,t){var o,r=this.tail;if(arguments.length>1)o=t;else if(this.tail)r=this.tail.prev,o=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var n=this.length-1;r!==null;n--)o=e(o,r.value,n),r=r.prev;return o};W.prototype.toArray=function(){for(var e=new Array(this.length),t=0,o=this.head;o!==null;t++)e[t]=o.value,o=o.next;return e};W.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,o=this.tail;o!==null;t++)e[t]=o.value,o=o.prev;return e};W.prototype.slice=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var o=new W;if(t<e||t<0)return o;e<0&&(e=0),t>this.length&&(t=this.length);for(var r=0,n=this.head;n!==null&&r<e;r++)n=n.next;for(;n!==null&&r<t;r++,n=n.next)o.push(n.value);return o};W.prototype.sliceReverse=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var o=new W;if(t<e||t<0)return o;e<0&&(e=0),t>this.length&&(t=this.length);for(var r=this.length,n=this.tail;n!==null&&r>t;r--)n=n.prev;for(;n!==null&&r>e;r--,n=n.prev)o.push(n.value);return o};W.prototype.splice=function(e,t,...o){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,n=this.head;n!==null&&r<e;r++)n=n.next;for(var i=[],r=0;n&&r<t;r++)i.push(n.value),n=this.removeNode(n);n===null&&(n=this.tail),n!==this.head&&n!==this.tail&&(n=n.prev);for(var r=0;r<o.length;r++)n=jf(this,n,o[r]);return i};W.prototype.reverse=function(){for(var e=this.head,t=this.tail,o=e;o!==null;o=o.prev){var r=o.prev;o.prev=o.next,o.next=r}return this.head=t,this.tail=e,this};function jf(e,t,o){var r=t===e.head?new Yt(o,null,t,e):new Yt(o,t,t.next,e);return r.next===null&&(e.tail=r),r.prev===null&&(e.head=r),e.length++,r}function qf(e,t){e.tail=new Yt(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function zf(e,t){e.head=new Yt(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function Yt(e,t,o,r){if(!(this instanceof Yt))return new Yt(e,t,o,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,o?(o.prev=this,this.next=o):this.next=null}try{ga()(W)}catch{}});var Sa=$((dy,Ca)=>{"use strict";var Hf=ba(),Qt=Symbol("max"),xt=Symbol("length"),uo=Symbol("lengthCalculator"),Ao=Symbol("allowStale"),eo=Symbol("maxAge"),bt=Symbol("dispose"),xa=Symbol("noDisposeOnSet"),be=Symbol("lruList"),tt=Symbol("cache"),_a=Symbol("updateAgeOnGet"),_n=()=>1,Sn=class{constructor(t){if(typeof t=="number"&&(t={max:t}),t||(t={}),t.max&&(typeof t.max!="number"||t.max<0))throw new TypeError("max must be a non-negative number");let o=this[Qt]=t.max||1/0,r=t.length||_n;if(this[uo]=typeof r!="function"?_n:r,this[Ao]=t.stale||!1,t.maxAge&&typeof t.maxAge!="number")throw new TypeError("maxAge must be a number");this[eo]=t.maxAge||0,this[bt]=t.dispose,this[xa]=t.noDisposeOnSet||!1,this[_a]=t.updateAgeOnGet||!1,this.reset()}set max(t){if(typeof t!="number"||t<0)throw new TypeError("max must be a non-negative number");this[Qt]=t||1/0,Eo(this)}get max(){return this[Qt]}set allowStale(t){this[Ao]=!!t}get allowStale(){return this[Ao]}set maxAge(t){if(typeof t!="number")throw new TypeError("maxAge must be a non-negative number");this[eo]=t,Eo(this)}get maxAge(){return this[eo]}set lengthCalculator(t){typeof t!="function"&&(t=_n),t!==this[uo]&&(this[uo]=t,this[xt]=0,this[be].forEach(o=>{o.length=this[uo](o.value,o.key),this[xt]+=o.length})),Eo(this)}get lengthCalculator(){return this[uo]}get length(){return this[xt]}get itemCount(){return this[be].length}rforEach(t,o){o=o||this;for(let r=this[be].tail;r!==null;){let n=r.prev;wa(this,t,r,o),r=n}}forEach(t,o){o=o||this;for(let r=this[be].head;r!==null;){let n=r.next;wa(this,t,r,o),r=n}}keys(){return this[be].toArray().map(t=>t.key)}values(){return this[be].toArray().map(t=>t.value)}reset(){this[bt]&&this[be]&&this[be].length&&this[be].forEach(t=>this[bt](t.key,t.value)),this[tt]=new Map,this[be]=new Hf,this[xt]=0}dump(){return this[be].map(t=>Nr(this,t)?!1:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}).toArray().filter(t=>t)}dumpLru(){return this[be]}set(t,o,r){if(r=r||this[eo],r&&typeof r!="number")throw new TypeError("maxAge must be a number");let n=r?Date.now():0,i=this[uo](o,t);if(this[tt].has(t)){if(i>this[Qt])return po(this,this[tt].get(t)),!1;let s=this[tt].get(t).value;return this[bt]&&(this[xa]||this[bt](t,s.value)),s.now=n,s.maxAge=r,s.value=o,this[xt]+=i-s.length,s.length=i,this.get(t),Eo(this),!0}let l=new kn(t,o,i,n,r);return l.length>this[Qt]?(this[bt]&&this[bt](t,o),!1):(this[xt]+=l.length,this[be].unshift(l),this[tt].set(t,this[be].head),Eo(this),!0)}has(t){if(!this[tt].has(t))return!1;let o=this[tt].get(t).value;return!Nr(this,o)}get(t){return Cn(this,t,!0)}peek(t){return Cn(this,t,!1)}pop(){let t=this[be].tail;return t?(po(this,t),t.value):null}del(t){po(this,this[tt].get(t))}load(t){this.reset();let o=Date.now();for(let r=t.length-1;r>=0;r--){let n=t[r],i=n.e||0;if(i===0)this.set(n.k,n.v);else{let l=i-o;l>0&&this.set(n.k,n.v,l)}}}prune(){this[tt].forEach((t,o)=>Cn(this,o,!1))}},Cn=(e,t,o)=>{let r=e[tt].get(t);if(r){let n=r.value;if(Nr(e,n)){if(po(e,r),!e[Ao])return}else o&&(e[_a]&&(r.value.now=Date.now()),e[be].unshiftNode(r));return n.value}},Nr=(e,t)=>{if(!t||!t.maxAge&&!e[eo])return!1;let o=Date.now()-t.now;return t.maxAge?o>t.maxAge:e[eo]&&o>e[eo]},Eo=e=>{if(e[xt]>e[Qt])for(let t=e[be].tail;e[xt]>e[Qt]&&t!==null;){let o=t.prev;po(e,t),t=o}},po=(e,t)=>{if(t){let o=t.value;e[bt]&&e[bt](o.key,o.value),e[xt]-=o.length,e[tt].delete(o.key),e[be].removeNode(t)}},kn=class{constructor(t,o,r,n,i){this.key=t,this.value=o,this.length=r,this.now=n,this.maxAge=i||0}},wa=(e,t,o,r)=>{let n=o.value;Nr(e,n)&&(po(e,o),e[Ao]||(n=void 0)),n&&t.call(r,n.value,n.key,e)};Ca.exports=Sn});var Je=$((my,Pa)=>{var to=class{constructor(t,o){if(o=Xf(o),t instanceof to)return t.loose===!!o.loose&&t.includePrerelease===!!o.includePrerelease?t:new to(t.raw,o);if(t instanceof Tn)return this.raw=t.value,this.set=[[t]],this.format(),this;if(this.options=o,this.loose=!!o.loose,this.includePrerelease=!!o.includePrerelease,this.raw=t,this.set=t.split("||").map(r=>this.parseRange(r.trim())).filter(r=>r.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${t}`);if(this.set.length>1){let r=this.set[0];if(this.set=this.set.filter(n=>!Ta(n[0])),this.set.length===0)this.set=[r];else if(this.set.length>1){for(let n of this.set)if(n.length===1&&td(n[0])){this.set=[n];break}}}this.format()}format(){return this.range=this.set.map(t=>t.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(t){t=t.trim();let r=`parseRange:${Object.keys(this.options).join(",")}:${t}`,n=ka.get(r);if(n)return n;let i=this.options.loose,l=i?Ae[$e.HYPHENRANGELOOSE]:Ae[$e.HYPHENRANGE];t=t.replace(l,pd(this.options.includePrerelease)),ae("hyphen replace",t),t=t.replace(Ae[$e.COMPARATORTRIM],Yf),ae("comparator trim",t),t=t.replace(Ae[$e.TILDETRIM],Qf),t=t.replace(Ae[$e.CARETTRIM],ed),t=t.split(/\s+/).join(" ");let a=t.split(" ").map(p=>od(p,this.options)).join(" ").split(/\s+/).map(p=>ud(p,this.options));i&&(a=a.filter(p=>(ae("loose invalid filter",p,this.options),!!p.match(Ae[$e.COMPARATORLOOSE])))),ae("range list",a);let s=new Map,c=a.map(p=>new Tn(p,this.options));for(let p of c){if(Ta(p))return[p];s.set(p.value,p)}s.size>1&&s.has("")&&s.delete("");let u=[...s.values()];return ka.set(r,u),u}intersects(t,o){if(!(t instanceof to))throw new TypeError("a Range is required");return this.set.some(r=>va(r,o)&&t.set.some(n=>va(n,o)&&r.every(i=>n.every(l=>i.intersects(l,o)))))}test(t){if(!t)return!1;if(typeof t=="string")try{t=new Zf(t,this.options)}catch{return!1}for(let o=0;o<this.set.length;o++)if(fd(this.set[o],t,this.options))return!0;return!1}};Pa.exports=to;var Jf=Sa(),ka=new Jf({max:1e3}),Xf=Po(),Tn=Ro(),ae=To(),Zf=Te(),{re:Ae,t:$e,comparatorTrimReplace:Yf,tildeTrimReplace:Qf,caretTrimReplace:ed}=Jt(),Ta=e=>e.value==="<0.0.0-0",td=e=>e.value==="",va=(e,t)=>{let o=!0,r=e.slice(),n=r.pop();for(;o&&r.length;)o=r.every(i=>n.intersects(i,t)),n=r.pop();return o},od=(e,t)=>(ae("comp",e,t),e=id(e,t),ae("caret",e),e=rd(e,t),ae("tildes",e),e=ad(e,t),ae("xrange",e),e=cd(e,t),ae("stars",e),e),Ie=e=>!e||e.toLowerCase()==="x"||e==="*",rd=(e,t)=>e.trim().split(/\s+/).map(o=>nd(o,t)).join(" "),nd=(e,t)=>{let o=t.loose?Ae[$e.TILDELOOSE]:Ae[$e.TILDE];return e.replace(o,(r,n,i,l,a)=>{ae("tilde",e,r,n,i,l,a);let s;return Ie(n)?s="":Ie(i)?s=`>=${n}.0.0 <${+n+1}.0.0-0`:Ie(l)?s=`>=${n}.${i}.0 <${n}.${+i+1}.0-0`:a?(ae("replaceTilde pr",a),s=`>=${n}.${i}.${l}-${a} <${n}.${+i+1}.0-0`):s=`>=${n}.${i}.${l} <${n}.${+i+1}.0-0`,ae("tilde return",s),s})},id=(e,t)=>e.trim().split(/\s+/).map(o=>ld(o,t)).join(" "),ld=(e,t)=>{ae("caret",e,t);let o=t.loose?Ae[$e.CARETLOOSE]:Ae[$e.CARET],r=t.includePrerelease?"-0":"";return e.replace(o,(n,i,l,a,s)=>{ae("caret",e,n,i,l,a,s);let c;return Ie(i)?c="":Ie(l)?c=`>=${i}.0.0${r} <${+i+1}.0.0-0`:Ie(a)?i==="0"?c=`>=${i}.${l}.0${r} <${i}.${+l+1}.0-0`:c=`>=${i}.${l}.0${r} <${+i+1}.0.0-0`:s?(ae("replaceCaret pr",s),i==="0"?l==="0"?c=`>=${i}.${l}.${a}-${s} <${i}.${l}.${+a+1}-0`:c=`>=${i}.${l}.${a}-${s} <${i}.${+l+1}.0-0`:c=`>=${i}.${l}.${a}-${s} <${+i+1}.0.0-0`):(ae("no pr"),i==="0"?l==="0"?c=`>=${i}.${l}.${a}${r} <${i}.${l}.${+a+1}-0`:c=`>=${i}.${l}.${a}${r} <${i}.${+l+1}.0-0`:c=`>=${i}.${l}.${a} <${+i+1}.0.0-0`),ae("caret return",c),c})},ad=(e,t)=>(ae("replaceXRanges",e,t),e.split(/\s+/).map(o=>sd(o,t)).join(" ")),sd=(e,t)=>{e=e.trim();let o=t.loose?Ae[$e.XRANGELOOSE]:Ae[$e.XRANGE];return e.replace(o,(r,n,i,l,a,s)=>{ae("xRange",e,r,n,i,l,a,s);let c=Ie(i),u=c||Ie(l),p=u||Ie(a),f=p;return n==="="&&f&&(n=""),s=t.includePrerelease?"-0":"",c?n===">"||n==="<"?r="<0.0.0-0":r="*":n&&f?(u&&(l=0),a=0,n===">"?(n=">=",u?(i=+i+1,l=0,a=0):(l=+l+1,a=0)):n==="<="&&(n="<",u?i=+i+1:l=+l+1),n==="<"&&(s="-0"),r=`${n+i}.${l}.${a}${s}`):u?r=`>=${i}.0.0${s} <${+i+1}.0.0-0`:p&&(r=`>=${i}.${l}.0${s} <${i}.${+l+1}.0-0`),ae("xRange return",r),r})},cd=(e,t)=>(ae("replaceStars",e,t),e.trim().replace(Ae[$e.STAR],"")),ud=(e,t)=>(ae("replaceGTE0",e,t),e.trim().replace(Ae[t.includePrerelease?$e.GTE0PRE:$e.GTE0],"")),pd=e=>(t,o,r,n,i,l,a,s,c,u,p,f,d)=>(Ie(r)?o="":Ie(n)?o=`>=${r}.0.0${e?"-0":""}`:Ie(i)?o=`>=${r}.${n}.0${e?"-0":""}`:l?o=`>=${o}`:o=`>=${o}${e?"-0":""}`,Ie(c)?s="":Ie(u)?s=`<${+c+1}.0.0-0`:Ie(p)?s=`<${c}.${+u+1}.0-0`:f?s=`<=${c}.${u}.${p}-${f}`:e?s=`<${c}.${u}.${+p+1}-0`:s=`<=${s}`,`${o} ${s}`.trim()),fd=(e,t,o)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!o.includePrerelease){for(let r=0;r<e.length;r++)if(ae(e[r].semver),e[r].semver!==Tn.ANY&&e[r].semver.prerelease.length>0){let n=e[r].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0}});var Ro=$((hy,Aa)=>{var Mo=Symbol("SemVer ANY"),fo=class{static get ANY(){return Mo}constructor(t,o){if(o=dd(o),t instanceof fo){if(t.loose===!!o.loose)return t;t=t.value}Pn("comparator",t,o),this.options=o,this.loose=!!o.loose,this.parse(t),this.semver===Mo?this.value="":this.value=this.operator+this.semver.version,Pn("comp",this)}parse(t){let o=this.options.loose?$a[Ia.COMPARATORLOOSE]:$a[Ia.COMPARATOR],r=t.match(o);if(!r)throw new TypeError(`Invalid comparator: ${t}`);this.operator=r[1]!==void 0?r[1]:"",this.operator==="="&&(this.operator=""),r[2]?this.semver=new Na(r[2],this.options.loose):this.semver=Mo}toString(){return this.value}test(t){if(Pn("Comparator.test",t,this.options.loose),this.semver===Mo||t===Mo)return!0;if(typeof t=="string")try{t=new Na(t,this.options)}catch{return!1}return vn(t,this.operator,this.semver,this.options)}intersects(t,o){if(!(t instanceof fo))throw new TypeError("a Comparator is required");if((!o||typeof o!="object")&&(o={loose:!!o,includePrerelease:!1}),this.operator==="")return this.value===""?!0:new Ea(t.value,o).test(this.value);if(t.operator==="")return t.value===""?!0:new Ea(this.value,o).test(t.semver);let r=(this.operator===">="||this.operator===">")&&(t.operator===">="||t.operator===">"),n=(this.operator==="<="||this.operator==="<")&&(t.operator==="<="||t.operator==="<"),i=this.semver.version===t.semver.version,l=(this.operator===">="||this.operator==="<=")&&(t.operator===">="||t.operator==="<="),a=vn(this.semver,"<",t.semver,o)&&(this.operator===">="||this.operator===">")&&(t.operator==="<="||t.operator==="<"),s=vn(this.semver,">",t.semver,o)&&(this.operator==="<="||this.operator==="<")&&(t.operator===">="||t.operator===">");return r||n||i&&l||a||s}};Aa.exports=fo;var dd=Po(),{re:$a,t:Ia}=Jt(),vn=wn(),Pn=To(),Na=Te(),Ea=Je()});var Oo=$((gy,Ra)=>{var md=Je(),hd=(e,t,o)=>{try{t=new md(t,o)}catch{return!1}return t.test(e)};Ra.exports=hd});var Oa=$((yy,Ma)=>{var gd=Je(),yd=(e,t)=>new gd(e,t).set.map(o=>o.map(r=>r.value).join(" ").trim().split(" "));Ma.exports=yd});var La=$((by,Da)=>{var bd=Te(),xd=Je(),wd=(e,t,o)=>{let r=null,n=null,i=null;try{i=new xd(t,o)}catch{return null}return e.forEach(l=>{i.test(l)&&(!r||n.compare(l)===-1)&&(r=l,n=new bd(r,o))}),r};Da.exports=wd});var Ua=$((xy,Ba)=>{var _d=Te(),Cd=Je(),Sd=(e,t,o)=>{let r=null,n=null,i=null;try{i=new Cd(t,o)}catch{return null}return e.forEach(l=>{i.test(l)&&(!r||n.compare(l)===1)&&(r=l,n=new _d(r,o))}),r};Ba.exports=Sd});var Wa=$((wy,Ga)=>{var $n=Te(),kd=Je(),Fa=No(),Td=(e,t)=>{e=new kd(e,t);let o=new $n("0.0.0");if(e.test(o)||(o=new $n("0.0.0-0"),e.test(o)))return o;o=null;for(let r=0;r<e.set.length;++r){let n=e.set[r],i=null;n.forEach(l=>{let a=new $n(l.semver.version);switch(l.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!i||Fa(a,i))&&(i=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${l.operator}`)}}),i&&(!o||Fa(o,i))&&(o=i)}return o&&e.test(o)?o:null};Ga.exports=Td});var Ka=$((_y,Va)=>{var vd=Je(),Pd=(e,t)=>{try{return new vd(e,t).range||"*"}catch{return null}};Va.exports=Pd});var Er=$((Cy,Ha)=>{var $d=Te(),za=Ro(),{ANY:Id}=za,Nd=Je(),Ed=Oo(),ja=No(),qa=vr(),Ad=Pr(),Rd=$o(),Md=(e,t,o,r)=>{e=new $d(e,r),t=new Nd(t,r);let n,i,l,a,s;switch(o){case">":n=ja,i=Ad,l=qa,a=">",s=">=";break;case"<":n=qa,i=Rd,l=ja,a="<",s="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Ed(e,t,r))return!1;for(let c=0;c<t.set.length;++c){let u=t.set[c],p=null,f=null;if(u.forEach(d=>{d.semver===Id&&(d=new za(">=0.0.0")),p=p||d,f=f||d,n(d.semver,p.semver,r)?p=d:l(d.semver,f.semver,r)&&(f=d)}),p.operator===a||p.operator===s||(!f.operator||f.operator===a)&&i(e,f.semver))return!1;if(f.operator===s&&l(e,f.semver))return!1}return!0};Ha.exports=Md});var Xa=$((Sy,Ja)=>{var Od=Er(),Dd=(e,t,o)=>Od(e,t,">",o);Ja.exports=Dd});var Ya=$((ky,Za)=>{var Ld=Er(),Bd=(e,t,o)=>Ld(e,t,"<",o);Za.exports=Bd});var ts=$((Ty,es)=>{var Qa=Je(),Ud=(e,t,o)=>(e=new Qa(e,o),t=new Qa(t,o),e.intersects(t));es.exports=Ud});var rs=$((vy,os)=>{var Fd=Oo(),Gd=He();os.exports=(e,t,o)=>{let r=[],n=null,i=null,l=e.sort((u,p)=>Gd(u,p,o));for(let u of l)Fd(u,t,o)?(i=u,n||(n=u)):(i&&r.push([n,i]),i=null,n=null);n&&r.push([n,null]);let a=[];for(let[u,p]of r)u===p?a.push(u):!p&&u===l[0]?a.push("*"):p?u===l[0]?a.push(`<=${p}`):a.push(`${u} - ${p}`):a.push(`>=${u}`);let s=a.join(" || "),c=typeof t.raw=="string"?t.raw:String(t);return s.length<c.length?s:t}});var ss=$((Py,as)=>{var ns=Je(),Ar=Ro(),{ANY:In}=Ar,Do=Oo(),Nn=He(),Wd=(e,t,o={})=>{if(e===t)return!0;e=new ns(e,o),t=new ns(t,o);let r=!1;e:for(let n of e.set){for(let i of t.set){let l=Vd(n,i,o);if(r=r||l!==null,l)continue e}if(r)return!1}return!0},Vd=(e,t,o)=>{if(e===t)return!0;if(e.length===1&&e[0].semver===In){if(t.length===1&&t[0].semver===In)return!0;o.includePrerelease?e=[new Ar(">=0.0.0-0")]:e=[new Ar(">=0.0.0")]}if(t.length===1&&t[0].semver===In){if(o.includePrerelease)return!0;t=[new Ar(">=0.0.0")]}let r=new Set,n,i;for(let d of e)d.operator===">"||d.operator===">="?n=is(n,d,o):d.operator==="<"||d.operator==="<="?i=ls(i,d,o):r.add(d.semver);if(r.size>1)return null;let l;if(n&&i){if(l=Nn(n.semver,i.semver,o),l>0)return null;if(l===0&&(n.operator!==">="||i.operator!=="<="))return null}for(let d of r){if(n&&!Do(d,String(n),o)||i&&!Do(d,String(i),o))return null;for(let h of t)if(!Do(d,String(h),o))return!1;return!0}let a,s,c,u,p=i&&!o.includePrerelease&&i.semver.prerelease.length?i.semver:!1,f=n&&!o.includePrerelease&&n.semver.prerelease.length?n.semver:!1;p&&p.prerelease.length===1&&i.operator==="<"&&p.prerelease[0]===0&&(p=!1);for(let d of t){if(u=u||d.operator===">"||d.operator===">=",c=c||d.operator==="<"||d.operator==="<=",n){if(f&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===f.major&&d.semver.minor===f.minor&&d.semver.patch===f.patch&&(f=!1),d.operator===">"||d.operator===">="){if(a=is(n,d,o),a===d&&a!==n)return!1}else if(n.operator===">="&&!Do(n.semver,String(d),o))return!1}if(i){if(p&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===p.major&&d.semver.minor===p.minor&&d.semver.patch===p.patch&&(p=!1),d.operator==="<"||d.operator==="<="){if(s=ls(i,d,o),s===d&&s!==i)return!1}else if(i.operator==="<="&&!Do(i.semver,String(d),o))return!1}if(!d.operator&&(i||n)&&l!==0)return!1}return!(n&&c&&!i&&l!==0||i&&u&&!n&&l!==0||f||p)},is=(e,t,o)=>{if(!e)return t;let r=Nn(e.semver,t.semver,o);return r>0?e:r<0||t.operator===">"&&e.operator===">="?t:e},ls=(e,t,o)=>{if(!e)return t;let r=Nn(e.semver,t.semver,o);return r<0?e:r>0||t.operator==="<"&&e.operator==="<="?t:e};as.exports=Wd});var An=$(($y,us)=>{var En=Jt(),Kd=vo(),jd=Te(),cs=dn(),qd=Zt(),zd=Ml(),Hd=Dl(),Jd=Ul(),Xd=Vl(),Zd=jl(),Yd=zl(),Qd=Jl(),em=Zl(),tm=He(),om=Ql(),rm=ta(),nm=Tr(),im=ia(),lm=aa(),am=No(),sm=vr(),cm=kr(),um=xn(),pm=$o(),fm=Pr(),dm=wn(),mm=ma(),hm=Ro(),gm=Je(),ym=Oo(),bm=Oa(),xm=La(),wm=Ua(),_m=Wa(),Cm=Ka(),Sm=Er(),km=Xa(),Tm=Ya(),vm=ts(),Pm=rs(),$m=ss();us.exports={parse:qd,valid:zd,clean:Hd,inc:Jd,diff:Xd,major:Zd,minor:Yd,patch:Qd,prerelease:em,compare:tm,rcompare:om,compareLoose:rm,compareBuild:nm,sort:im,rsort:lm,gt:am,lt:sm,eq:cm,neq:um,gte:pm,lte:fm,cmp:dm,coerce:mm,Comparator:hm,Range:gm,satisfies:ym,toComparators:bm,maxSatisfying:xm,minSatisfying:wm,minVersion:_m,validRange:Cm,outside:Sm,gtr:km,ltr:Tm,intersects:vm,simplifyRange:Pm,subset:$m,SemVer:jd,re:En.re,src:En.src,tokens:En.t,SEMVER_SPEC_VERSION:Kd.SEMVER_SPEC_VERSION,compareIdentifiers:cs.compareIdentifiers,rcompareIdentifiers:cs.rcompareIdentifiers}});var hu=$(mi=>{"use strict";var ig=Object.prototype.hasOwnProperty,lg;function du(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch{return null}}function mu(e){try{return encodeURIComponent(e)}catch{return null}}function ag(e){for(var t=/([^=?#&]+)=?([^&]*)/g,o={},r;r=t.exec(e);){var n=du(r[1]),i=du(r[2]);n===null||i===null||n in o||(o[n]=i)}return o}function sg(e,t){t=t||"";var o=[],r,n;typeof t!="string"&&(t="?");for(n in e)if(ig.call(e,n)){if(r=e[n],!r&&(r===null||r===lg||isNaN(r))&&(r=""),n=mu(n),r=mu(r),n===null||r===null)continue;o.push(n+"="+r)}return o.length?t+o.join("&"):""}mi.stringify=sg;mi.parse=ag});var On=C(S());var Pl="ourongxing",$l="4.4.0";var Ge={author:Pl,version:$l,key:"ohmymn",title:"OhMyMN",minMarginNoteVersion:"3.7.21",profileKey:{global:"ohmymn_profile_global_v4",doc:"ohmymn_profile_doc_v4",notebook:"ohmymn_profile_notebook_v4"},color:{border:"#8A95A2",button:"#8A95A2"},github:"https://github.com/ourongxing/ohmymn",forumZH:"https://bbs.marginnote.cn/t/topic/20501",forum:"https://forum.marginnote.com/t/5883",docZH:"https://ohmymn.marginnote.cn",doc:"https://ohmymn.marginnote.cn/en",files:["assets/logo.png","assets/icon/","assets/AutoSimplifyData.json"]};var Nm=C(S());var Rr=C(S()),Lo=C(An());var ps=[{version:{from:"4.0.0",to:">=4.0.6"},global:{addon:{quickSwitch:e=>e.map(t=>t+1),panelPosition:e=>[e[0]>=1?e[0]+2:e[0]],cardAction:e=>{let t=e[0],o=t;return t>=5&&(o+=2),t>=18&&(o+=2),[o]},textAction:e=>[e[0]>=10?e[0]+1:e[0]]},autoformat:{preset:e=>e.map(t=>t>1?t-1:t)}}},{version:{from:"4.0.6 - 4.0.9",to:">=4.0.10"},global:{addon:{removeExcerpt:e=>[e[0]===2?0:e[0]]}}},{version:{from:"4.0.10",to:">=4.0.11"},global:{autocomment:{preset:e=>e.filter(t=>t!==1)}}},{version:{from:"4.0.11 - 4.0.13",to:">=4.0.14"},global:{addon:{cardAction:e=>[e[0]>0?e[0]+1:e[0]],textAction:e=>[e[0]>0?e[0]+1:e[0]]}}},{version:{from:"4.0.14 - 4.0.15",to:">=4.0.16"},global:{addon:{cardAction:e=>[e[0]>=56?e[0]+1:e[0]]}}},{version:{from:"4.0.16",to:">=4.1.0"},global:{addon:{panelControl:e=>e.filter(t=>t!==1).map(t=>t>1?t-1:t),textAction:e=>[e[0]===2?3:e[0]===3?2:e[0]]}}},{version:{from:"4.1.1",to:">=4.2.0"},global:{addon:{cardAction:e=>[e[0]>=26?e[0]+1:e[0]]}}},{version:{from:"4.2.1 - 4.3.0",to:">=4.3.1"},global:{addon:{quickSwitch:e=>e.map(t=>t>1?t+1:t)}}},{version:{from:"4.3.2 - 4.3.3",to:">=4.4.0"},global:{ai:{model:e=>[e[0]===1?0:e[0]===3?2:e[0]]}}}];function Lt(e){var t;try{let o=e.replace(Rr.MN.scheme+"://note/","");if(o===e)return e;let r=Rr.MN.db.getNoteById(o);if(r&&((t=r.childNotes)==null?void 0:t.length)){let n=r.childNotes.reduce((i,l)=>{if(l.comments.length){let a=l.comments[0];if(l.colorIndex!==13&&a.type==="TextNote"&&a.text)return[...i,a.text]}return i},[]);if(n.length)return n.join(";")}}catch(o){Rr.MN.error(o);return}}function ds(e,t){var o;for(let[r,n]of Object.entries(e))for(let[i,l]of Object.entries(n))if(((o=t==null?void 0:t[r])==null?void 0:o[i])===void 0)return!0;return!1}var Bt={to(e){var t;return[e[0],(t=e[5])!=null?t:"",e[e.length-1]]},tell(e,t){let[o,r,n]=e;return t[0]===o&&t[5]===(r===""?void 0:r)&&t[t.length-1]===n}};function Ce(e,t){function o(n,i,l,a){var s;if(((s=n[i])==null?void 0:s[l])!==void 0)n[i][l]=a(n[i][l],n);else if(l==="cardAction")n.gesture&&["single","muilt"].forEach(c=>["Up","Down","Left","Right"].forEach(u=>{n.gesture[`${c}BarSwipe${u}`]=a(n.gesture[`${c}BarSwipe${u}`],n)})),n.toolbar&&Array.from({length:8}).forEach((c,u)=>{n.shortcut[`cardToolbar${u}`]=a(n.shortcut[`cardToolbar${u}`],n)}),n.shortcut&&Array.from({length:8}).forEach((c,u)=>{n.shortcut[`cardShortcut${u}`]=a(n.shortcut[`cardShortcut${u}`],n)});else if(l==="textAction")n.gesture&&["Up","Down","Left","Right"].forEach(c=>{n.gesture[`selectionBarSwipe${c}`]=a(n.gesture[`selectionBarSwipe${c}`],n)}),n.toolbar&&Array.from({length:4}).forEach((c,u)=>{n.shortcut[`textToolbar${u}`]=a(n.shortcut[`textToolbar${u}`],n)}),n.shortcut&&Array.from({length:4}).forEach((c,u)=>{n.shortcut[`textShortcut${u}`]=a(n.shortcut[`textShortcut${u}`],n)});else return!1;return!0}let{lastVersion:r}=g;return ps.forEach(n=>{var c,u;let{version:i,global:l,doc:a,notebook:s}=n;if((0,Lo.satisfies)(r,i.from)&&(0,Lo.satisfies)(g.version,i.to))switch(r=(0,Lo.minVersion)(n.version.to).version,e){case 0:if(a){let p=Object.values(t);for(let[f,d]of Object.entries(a))for(let[h,y]of Object.entries(d))for(let k of p)if(((c=k[f])==null?void 0:c[h])!==void 0)k[f][h]=y(k[f][h],k);else return}break;case 1:if(l){for(let[p,f]of Object.entries(l))for(let[d,h]of Object.entries(f))for(let y of t)if(!o(y,p,d,h))return}break;case 2:if(l){for(let[p,f]of Object.entries(l))for(let[d,h]of Object.entries(f))if(!o(t,p,d,h))return}break;case 3:if(s){let p=Object.values(t);for(let[f,d]of Object.entries(s))for(let[h,y]of Object.entries(d))for(let k of p)if(((u=k[f])==null?void 0:u[h])!==void 0)k[f][h]=y(k[f][h],k);else return}break}}),t}var gs=C(S());var ms=C(S()),Xe=(0,ms.i18n)({zh:{no_profile_in_card:"\u81EA\u5B9A\u4E49\u5185\u5BB9\u8BFB\u53D6\u5931\u8D25",input_number:"\u8BF7\u8F93\u5165\u6570\u5B57",input_integer:"\u8BF7\u8F93\u5165\u6574\u6570",parse_error:"\u5B57\u7B26\u4E32\u89E3\u6790\u9519\u8BEF\uFF0C\u8BF7\u6CE8\u610F\u5B57\u7B26\u8F6C\u4E49\u95EE\u9898",input_positive:"\u8BF7\u8F93\u5165\u6B63\u6574\u6570",not_support_symbol:"\u4E0D\u652F\u6301\u8BE5\u7B26\u53F7",no_item:"\u6570\u7EC4\u5185\u5FC5\u987B\u6709\u5143\u7D20\uFF0C\u5E76\u4E14\u7B2C\u4E00\u4E2A\u5143\u7D20\u5FC5\u987B\u662F\u5B57\u7B26",require_number:"\u5FC5\u987B\u8F93\u5165\u6570\u5B57\u548C\u5355\u4E2A\u5B57\u7B26",ban_1:'\u7981\u6B62\u4F7F\u7528 "//"',ban_2:'\u7981\u6B62\u4F7F\u7528 "/./" \uFF0C\u8BF7\u4F7F\u7528 "/^.+$/gs" \u6765\u8FDB\u884C\u4EFB\u610F\u975E\u7A7A\u5339\u914D',not_support_format:"\u4E0D\u7B26\u5408\u8F93\u5165\u683C\u5F0F\u8981\u6C42",not_mnlink:"\u4E0D\u662F MN \u7684\u5361\u7247\u94FE\u63A5",not_exist:"\u5361\u7247\u4E0D\u5B58\u5728"},en:{no_profile_in_card:"Failed to read custom content",input_number:"Please enter a number",parse_error:"String parsing error, please note character escape problems",input_integer:"Please enter an integer",input_positive:"Please enter a positive integer",not_support_symbol:"Symbol not supported",ban_1:'Do not use "//"',ban_2:'Do not use "/./" , please use "/^.+$/gs" to match any non-empty',no_item:"There must be elements in the array, and the first element must be a character",require_number:"You must enter a number and a single character",not_support_format:"Does not meet the input format requirements",not_mnlink:"Not a MN card link",not_exist:"Card does not exist"}});function F(e,t=!1){try{return JSON.parse(t?`"${e}"`:e)}catch(o){throw gs.MN.error(o),Xe.parse_error}}function pe(e){return e.replace(/"/g,'\\"')}var hs=e=>/^[0-9]+$/.test(e);function xe(e){let t=e.split(/\s*;\s*(?=\()/),o=[];for(let r of t){let[n,i,l]=r.replace(/\((\/.*\/[gimsuy]*)\x20*,\x20*"(.*")\x20*\)?/,'$1orogxng"$2').replace(/"\x20*,\x20*(\d)\)/g,'"orogxng$1').split("orogxng");if(l&&!hs(l)||!l&&hs(i))throw"invalid replace param";o.push({regexp:ys(n),newSubStr:F(i),fnKey:l?Number(l):0})}return o}function ys(e){if(e=e.trim(),e.startsWith("//"))throw Xe.ban_1;if(e.startsWith("/./"))throw Xe.ban_2;if(!e.startsWith("/"))return new RegExp(Im(e));let t=e.match(/^\/(.+?)\/([gimsuy]*)$/);if(!t)throw"";return new RegExp(t[1],t[2])}function Im(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function Ut(e){if(/^\(.+\)$/.test(e))throw"";return e.split(/\s*;\s*(?=(?:\[\s*\/|\/\s*[^\]gimsuy,]))/).map(o=>o.replace(/^\s*\[(.+?)\]\s*$/,"$1").split(/\s*,\s*(?=\/[^\s,gimsuy]+)/).map(r=>ys(r)))}var wt={add(e,t){return e.flags.includes(t)?e:new RegExp(e.source,e.flags+t)},remove(e,t){return e.flags.includes(t)?new RegExp(e.source,e.flags.replace(t,"")):e}};function Bo(e,t){return _t(t.reduce((o,{newSubStr:r,regexp:n})=>(n=wt.add(n,"g"),n.test(e)&&o.push(...e.match(n).map(i=>i.replace(n,r))),o),[]))}function We(e){F(`${pe(e)}`,!0)}function Rn(e){for(let t of Ut(e).flat())t.test("test")}function Uo(e){let t=Lt(e);if(!t)throw Xe.no_profile_in_card;Rn(t)}function Ct(e){for(let t of xe(e))"test".replace(t.regexp,t.newSubStr)}function st(e){let t=Lt(e);if(!t)throw Xe.no_profile_in_card;Ct(t)}var Ne={hollow_circle_number:"\u2460\u2461\u2462\u2463\u2464\u2465\u2466\u2467\u2468\u2469\u246A\u246B\u246C\u246D\u246E\u246F\u2470\u2471\u2472\u2473\u3251\u3252\u3253\u3254\u3255\u3256\u3257\u3258\u3259\u325A\u325B\u325C\u325D\u325E\u325F\u32B1\u32B2\u32B3\u32B4\u32B5\u32B6\u32B7\u32B8\u32B9\u32BA\u32BB\u32BC\u32BD\u32BE\u32BF",solid_circle_number:"\u2776\u2777\u2778\u2779\u277A\u277B\u277C\u277D\u277E\u277F\u24EB\u24EC\u24ED\u24EE\u24EF\u24F0\u24F1\u24F2\u24F3\u24F4",capital_letter:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",lowercase_letter:"abcdefghijklmnopqrstuvwxyz",chinese_capital_number:"\u58F9\u8D30\u53C1\u8086\u4F0D\u9646\u67D2\u634C\u7396\u62FE",chinese_number:"\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D\u5341",greek_capital_number:"\u2160\u2161\u2162\u2163\u2164\u2165\u2166\u2167\u2168\u2169",greek_number:"\u2170\u2171\u2172\u2173\u2174\u2175\u2176\u2177\u2178\u2179"};function Em(e,t,o=1){let r=Object.values(Ne).filter(l=>l.includes(e))[0];if(!r)throw"";let n=[],i=r.search(e);for(let l=i,a=i+t*o-1;l<=a;l=l+o)n.push(r[l%r.length]);return n}function Am(e,t,o=1,r=0){let n=[];for(let i=e,l=e+t*o-1;i<=l;i=i+o)n.push(String(i).padStart(r,"0"));return n}function ot(e,t,o="%"){let r=F(e.replace(new RegExp(`^.*${o}(\\[.+\\]).*$`),"$1").replace(/'/g,'"')),n=r.length;if(n==0||typeof r[0]!="string")throw Xe.no_item;if(n==1||n==2&&typeof r[1]=="number"){let i=n==1?1:r[1],l=r[0];if(/^[0-9]+$/.test(l))return Am(Number(l),t,i,l.length);if(l.length===1)return Em(l,t,i);throw Xe.require_number}else{if(n>1&&r.every(i=>typeof i=="string"))return r;throw Xe.not_support_format}}function bs(e,t){if(/^[0-9]+$/.test(e))return String(Number(e)+t).padStart(e.length,"0");let o=Object.values(Ne).filter(i=>i.includes(e))[0];if(!o)throw Xe.not_support_symbol;let r=o.length,n=o.search(e);return o[(n+t)%r]}var St="\u2E80-\u2EFF\u2F00-\u2FDF\u3040-\u309F\u30A0-\u30FA\u30FC-\u30FF\u3100-\u312F\u3200-\u32FF\u3400-\u4DBF\u4E00-\u9FFF\uF900-\uFAFF",Mr=new RegExp(`([${St}])`,"g"),Or=e=>/^[\u0000-\u00ff]*$/.test(e),Mn=e=>Mr.test(e),ct=e=>!Mn(e),Fo={Cyrillic:e=>/\p{sc=Cyrillic}/u.test(e),Latin:e=>/\p{sc=Latin}/u.test(e),CJK:e=>Mr.test(e),Han:e=>/\p{sc=Han}/u.test(e),Janpanese:e=>/[\u3000-\u303f\u3040-\u309f\u30a0-\u30ff]/u.test(e),Korea:e=>/\p{sc=Hangul}/u.test(e)};function Ft(e){var r;let t=e.split(new RegExp(`[^\\p{L}0-9\\-'.]|[${St}]`,"u")).reduce((n,i)=>(i&&(/\D\.\D/.test(i)?n.push(...i.split(".")):n.push(i)),n),[]),o=(r=e.match(new RegExp(`[${St}]`,"g")))!=null?r:[];return t.length+o.length}function mo(e){return Array.from(e).reduce((t,o)=>(t+=o.charCodeAt(0)>255?2:1,t),0)}function xs(e,t,...o){let r=[t,...o].map(n=>(n<0&&(n=mo(e)+n),n===0||n===1?n:Array.from(e).reduce((i,l,a)=>{let s=i.byte+(l.charCodeAt(0)>255?2:1);return!i.enough&&s<=n?i={index:a,byte:s,enough:!1}:i={...i,enough:!0},i},{index:0,byte:0,enough:!1}).index+1));return e.slice(...r)}function ws(e,t){let{str:o,segments:r}=Array.from(e).reduce((n,i)=>{let l=n.byte+(i.charCodeAt(0)>255?2:1);if(l>t)return{str:i,segments:[...n.segments,n.str],byte:i.charCodeAt(0)>255?2:1};let a=n.str+i;return l===t?{str:"",segments:[...n.segments,a],byte:0}:{str:a,segments:n.segments,byte:l}},{str:"",segments:[],byte:0});return o===""?r:[...r,o]}var de=e=>JSON.parse(JSON.stringify(e)),_t=e=>e.length<=1?e:Array.from(new Set(e));function rt(e,t="YYYY-mm-dd HH:MM"){let o,r={"Y+":e.getFullYear().toString(),"m+":(e.getMonth()+1).toString(),"d+":e.getDate().toString(),"H+":e.getHours().toString(),"M+":e.getMinutes().toString(),"S+":e.getSeconds().toString()};return Object.entries(r).forEach(([n,i])=>{o=new RegExp("("+n+")").exec(t),o&&(t=t.replace(o[1],o[1].length==1?i:i.padStart(o[1].length,"0")))}),t}function _s(e,t=!1){return t?/\w+:\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/.test(e):/^\w+:\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]$/.test(e)}function x(e,t){return`${g.doc}/guide/modules/${e}.html${t?"#"+t:""}`}var ho=class{constructor(){this.collection={};this.count=0}size(){return this.count}set(t,o){this.collection[t.toString()]=o,this.count++}has(t){return t.toString()in this.collection}get(t){return t.toString()in this.collection?this.collection[t.toString()]:null}delete(t){t.toString()in this.collection&&(delete this.collection[t.toString()],this.count--)}values(){let t=[];for(let o of Object.keys(this.collection))t.push(this.collection[o]);return t.length>0?t:[]}clear(){this.collection={},this.count=0}};var Gt=class{constructor(){this.imagesCache=new ho;this.textColor=UIColor.blackColor();this.barPosition="left";this.mainColor=UIColor.colorWithHexString("#8A95A2").colorWithAlphaComponent(.9);this.key=Ge.key;this.title=Ge.title;this.author=Ge.author;this.version=Ge.version;this.globalProfileKey=Ge.profileKey.global;this.docProfileKey=Ge.profileKey.doc;this.notebookProfileKey=Ge.profileKey.notebook;this.github=Ge.github;this.forum=On.MN.isZH?Ge.forumZH:Ge.forum;this.doc=On.MN.isZH?Ge.docZH:Ge.doc}static getInstance(){return Gt.instance||(Gt.instance=new Gt),Gt.instance}},g=Gt.getInstance();var Au=C(S());var mt=C(S()),Pe=C(S());var qe=C(S());var Fr=C(S());var ks=C(S());var nt=C(S()),Dr=C(S());function ut(e=self.globalProfile.addon.panelHeight[0],t=self.globalProfile.addon.panelPosition[0]){var p;let{studyController:o}=nt.MN,r=o.readerController.view;self.panel.lastReaderViewWidth=r.frame.width;let n=o.view.bounds,i=300,l=JSON.parse(self.globalProfile.additional.settingViewFrame),a=[600,450,300,(p=l.height)!=null?p:450][e],s=()=>{let f=r.hidden;if(o.rightMapMode){let d=r.frame.width-i-40;return d<50||f?50:d}else{let d=n.width-r.frame.width+40;return d>n.width-i-50||f?n.width-i-50:d}},c=()=>{let f=r.hidden;if(o.rightMapMode){let d=r.frame.width-i/2;return d<50||f?50:d>n.width-i-50?n.width-i-50:d}else{let d=n.width-r.frame.width-i/2;return d>n.width-i-50||f?n.width-i-50:d<50?50:d}},u=()=>{let f=r.hidden;if(o.rightMapMode){let d=r.frame.width+40;return d<50||f?50:d>n.width-i-50?n.width-i-50:d}else{let d=n.width-r.frame.width-i-40;return d>n.width-i-50||f?n.width-i-50:d<50?50:d}};if(t===6&&l.x)Go({...Dn({x:l.x,y:l.y}),height:a,width:i},.2);else{let f=[s,c,u,()=>50,()=>(n.width-i)/2,()=>n.width-i-50,s][t]();Go({x:f,y:nt.MN.isMN4?150:110,height:a,width:i},.2)}}function oo(){!self.panel.status||(self.settingViewController.view.removeFromSuperview(),self.dragOverlayView.removeFromSuperview(),self.stretchOverlayView.removeFromSuperview(),self.panel.status=!1,nt.MN.studyController.refreshAddonCommands())}function Cs(){if(self.panel.status)return;let{studyController:e}=nt.MN;e.view.addSubview(self.settingViewController.view),e.view.addSubview(self.dragOverlayView),e.view.addSubview(self.stretchOverlayView),self.panel.status=!0,e.refreshAddonCommands(),self.panel.lastOpenPanel=Date.now(),(0,Dr.delay)(.2).then(()=>void e.view.becomeFirstResponder())}function ro(e){let t=e==null?void 0:e.superview.superview;if(g.barPosition=t!=null&&t.frame.x?"right":"left",self.panel.status)oo();else if(self.globalProfile.addon.panelControl.includes(0)){let o=Date.now();self.panel.lastClickButton&&o-self.panel.lastClickButton<300?Cs():self.panel.lastClickButton=o}else Cs()}function Om(e){e==nt.MN.studyController&&(!self.panel.status||(Date.now()-self.panel.lastOpenPanel<200||self.panel.lastReaderViewWidth!==nt.MN.studyController.readerController.view.frame.width&&[0,1,2].includes(self.globalProfile.addon.panelPosition[0]))&&ut())}function Dm(){return nt.MN.studyController.studyMode!==Dr.StudyMode.review&&nt.MN.currnetNotebookId&&nt.MN.currentDocmd5?{image:"logo.png",object:self,selector:"switchPanel:",checked:self.panel.status}:null}function Go(e,t){let{y:o,height:r}=e;function n(){self.settingViewController.view.frame={...e},self.dragOverlayView.frame={...e,height:self.dragOverlayView.frame.height},self.stretchOverlayView.frame={...e,y:o+r-self.stretchOverlayView.frame.height/2,height:self.stretchOverlayView.frame.height}}t?UIView.animateWithDurationAnimationsCompletion(t,n,()=>{}):n()}function Dn({x:e,y:t},o=nt.MN.studyController.view.bounds,r=self.dragOverlayView.frame){let n=e;return g.barPosition==="left"?e<50?e=50:e>(n=o.width-r.width-10)&&(e=n):e<10?e=10:e>(n=o.width-r.width-50)&&(e=n),t<50?t=50:t>(n=o.height-r.height-50)&&(t=n),{x:e,y:t}}var Ss={queryAddonCommandStatus:Dm,switchPanel:ro,controllerWillLayoutSubviews:Om};function Ln(e,t){let o=vs.includes(e)?Lt(t):t;if(e in self.tempProfile.regArray){let r;try{r=o?Ut(o):void 0}catch{r=void 0}self.tempProfile.regArray[e]=r}else if(e in self.tempProfile.replaceParam){let r;try{r=o?xe(o):void 0}catch{r=void 0}self.tempProfile.replaceParam[e]=r}}function Wo(e,t){var o,r,n,i,l,a;for(let[s,c]of Object.entries(e))if(s==="additional")for(let[u,p]of Object.entries(c))c[u]=de((r=(o=t==null?void 0:t[s])==null?void 0:o[u])!=null?r:p);else for(let[u,p]of Object.entries(c)){if(!((i=(n=Re)==null?void 0:n[s])!=null&&i[u]))continue;let[f,d]=Re[s][u],h=(a=(l=t==null?void 0:t[s])==null?void 0:l[u])!=null?a:p;switch(typeof h){case"boolean":self.dataSource[f].rows[d].status=h,c[u]=h;break;case"string":self.dataSource[f].rows[d].content=h,c[u]=h,Ln(u,h);break;default:Array.isArray(h)&&(self.dataSource[f].rows[d].selections=[...h],c[u]=[...h])}}}function Ts(){var e;(e=self.settingViewController.tableView)==null||e.reloadData(),ut(),ks.MN.log("Refresh Panel","profile")}var go={addon:{quickSwitch:[],lockExcerpt:!1,dragMerge:[1],hasTitleThen:[1],removeExcerpt:[0],panelControl:[],panelPosition:[0],panelHeight:[1],autoBackup:!1,useMarkdown:!1,backupID:"",doubleLink:!1},magicaction4card:{smartSelection:!1,defaultMergeText:'%["1"]. $&\\n\\n'},magicaction4text:{showCopyContent:!1,noteOptions:[]},gesture:{singleBarSwipeUpShortcut:"",singleBarSwipeDownShortcut:"",singleBarSwipeRightShortcut:"",singleBarSwipeLeftShortcut:"",muiltBarSwipeUpShortcut:"",muiltBarSwipeDownShortcut:"",muiltBarSwipeRightShortcut:"",muiltBarSwipeLeftShortcut:"",selectionBarSwipeUpShortcut:"",selectionBarSwipeDownShortcut:"",selectionBarSwipeRightShortcut:"",selectionBarSwipeLeftShortcut:"",singleBarSwipeUp:[0],singleBarSwipeDown:[0],singleBarSwipeRight:[0],singleBarSwipeLeft:[0],muiltBarSwipeUp:[0],muiltBarSwipeDown:[0],muiltBarSwipeRight:[0],muiltBarSwipeLeft:[0],selectionBarSwipeUp:[0],selectionBarSwipeDown:[0],selectionBarSwipeRight:[0],selectionBarSwipeLeft:[0]},toolbar:{cardToolbar0:[0],cardToolbar1:[0],cardToolbar2:[0],cardToolbar3:[0],cardToolbar4:[0],cardToolbar5:[0],cardToolbar6:[0],cardToolbar7:[0],textToolbar0:[0],textToolbar1:[0],textToolbar2:[0],textToolbar3:[0],cardToolbar0Shortcut:"",cardToolbar1Shortcut:"",cardToolbar2Shortcut:"",cardToolbar3Shortcut:"",cardToolbar4Shortcut:"",cardToolbar5Shortcut:"",cardToolbar6Shortcut:"",cardToolbar7Shortcut:"",textToolbar0Shortcut:"",textToolbar1Shortcut:"",textToolbar2Shortcut:"",textToolbar3Shortcut:""},shortcut:{shortcutPro:!1,cardShortcut0:[0],cardShortcut1:[0],cardShortcut2:[0],cardShortcut3:[0],cardShortcut4:[0],cardShortcut5:[0],cardShortcut6:[0],cardShortcut7:[0],textShortcut0:[0],textShortcut1:[0],textShortcut2:[0],textShortcut3:[0]},autocomplete:{on:!1,fillWordInfo:[0],dataSource:[0],customFillFront:"{{#phonetic}}\u{1F508}[{{phonetic}}] {{/phonetic}} {{collins}}{{#tags}}\\n\u{1F3F7} {{tags}}{{/tags}}",customFill:"\u270D\u{1F3FB}\\n{{zh}}\\n\u{1F440}",selectLemma:!1,selectMeanings:[],autoContext:!1,translateContext:!1,collins:[0,1,2,3,4,5]},autoformat:{on:!1,preset:[],customFormat:"",formatTitle:!1},anotherautotitle:{on:!1,preset:[],wordCount:"[10, 5]",customBeTitle:""},anotherautodef:{on:!1,preset:[],toTitleLink:!1,titleLinkSplit:[1],customTitleSplit:"",customDefLink:"",customExtractTitle:""},autolist:{on:!1,preset:[],customList:""},autoreplace:{on:!1,preset:[],customReplace:""},autosimplify:{variant:[0],taiwanIdiom:!0,customSimplify:'(/\u58F9/g, "\u4E00"); (/\u59B3/g, "\u4F60")'},autotag:{on:!1,preset:[],customTag:""},autocomment:{on:!1,preset:[],customComment:""},autostyle:{on:!1,preset:[],wordCountArea:"[10, 5, 10]",showArea:!1,defaultTextExcerptColor:[0],defaultPicExcerptColor:[0],defaultTextExcerptStyle:[0],defaultPicExcerptStyle:[0]},copysearch:{multipleTitles:[0],multipleExcerpts:[0],customContent:"[{{titles.0}}]({{url.pure}})",customSearchContent:"[{{titles.0}}]({{url.pure}})",showSearchEngine:!1,modifySymbols:'%["1"]. $&\\n\\n',whichPartofCard:[0],searchChineseText:"https://www.bing.com/search?q={{keyword}}&ensearch=0",searchEnglishText:"https://www.bing.com/search?q={{keyword}}&ensearch=1",searchAcademic:"https://scholar.google.com.hk/scholar?q={{keyword}}",searchQuestion:"https://www.zhihu.com/search?q={{keyword}}",searchWord:"eudic://dict/{{keyword}}",searchTranslation:"https://www.deepl.com/zh/translator#en/zh/{{keyword}}",searchOtherText:""},autoocr:{baiduSecretKey:"",baiduApiKey:"",lang:[0],formulaOCRProviders:[0],markdown:[2],mathpixAppKey:"",showKey:!0},autotranslate:{on:!1,wordCount:"[10, 5]",baiduSecretKey:"",baiduAppID:"",baiduThesaurus:!1,baiduAdvance:!1,translateProviders:[0],caiyunToken:"",showKey:!0,baiduFromLang:[2],caiyunFromLang:[2],baiduToLang:[0],caiyunToLang:[0]},aitranslate:{on:!1,wordCount:"[10, 5]",openaiFromLang:[5],openaiToLang:[0]},aiassistant:{on:!1,wordCount:"[10, 5]",prompt:[0],openaiToLang:[0]},ai:{OpenAIApiKey:"",OpenAIBaseURL:"api.openai.com",defaultTemperature:"0.6",showKey:!0,promptsURL:"",model:[0]},additional:{lastVision:g.version,settingViewFrame:"{}",autoocr:{lastGetToken:0,baiduToken:""}}},no={magicaction4text:{preOCR:!1,preSimplify:!1,preFormat:!1},autoocr:{on:!1,lang:[0]},autoformat:{removeSpace:!1},autosimplify:{on:!1},additional:{needOCRWait:!0}},io={addon:{profile:[0]},additional:{cacheTitle:{},cacheComment:{},cacheTag:{}}},Lr={replaceParam:{customTag:[],customComment:[],customList:[],customReplace:[],customExtractTitle:[],customSimplify:[],customFormat:[]},regArray:{customTitleSplit:[],customBeTitle:[],customDefLink:[]}},vs=[...Object.keys(Lr.regArray),...Object.keys(Lr.replaceParam)];var O=C(S()),Is=C(An());var Wt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Bn(e){let t="",o=0,r,n,i,l,a,s,c;for(e=Lm(e);o<e.length;)r=e.charCodeAt(o++),n=e.charCodeAt(o++),i=e.charCodeAt(o++),l=r>>2,a=(r&3)<<4|n>>4,s=(n&15)<<2|i>>6,c=i&63,Number.isNaN(n)?s=c=64:Number.isNaN(i)&&(c=64),t=t+Wt.charAt(l)+Wt.charAt(a)+Wt.charAt(s)+Wt.charAt(c);return t}function Ps(e){let t="",o=0,r,n,i,l,a,s,c;for(;o<e.length;)l=Wt.indexOf(e.charAt(o++)),a=Wt.indexOf(e.charAt(o++)),s=Wt.indexOf(e.charAt(o++)),c=Wt.indexOf(e.charAt(o++)),r=l<<2|a>>4,n=(a&15)<<4|s>>2,i=(s&3)<<6|c,t=t+String.fromCharCode(r),s!=64&&(t=t+String.fromCharCode(n)),c!=64&&(t=t+String.fromCharCode(i));return t=Bm(t),t}function Lm(e){let t="";for(let o=0;o<e.length;o++){let r=e.charCodeAt(o);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(r&63|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(r&63|128))}return t}function Bm(e){let t="",o=0,r=0,n=0,i=0;for(;o<e.length;)r=e.charCodeAt(o),r<128?(t+=String.fromCharCode(r),o++):r>191&&r<224?(n=e.charCodeAt(o+1),t+=String.fromCharCode((r&31)<<6|n&63),o+=2):(n=e.charCodeAt(o+1),i=e.charCodeAt(o+2),t+=String.fromCharCode((r&15)<<12|(n&63)<<6|i&63),o+=3);return t}var $s=C(S()),M=(0,$s.i18n)({zh:{note_title:`${g.title} \u914D\u7F6E`,note_content:(e,t,o)=>`\u{1F6AB} \u8BF7\u52FF\u4FEE\u6539
\u8303\u56F4\uFF1A${e}
${o?"\u6A21\u5757\uFF1A"+o+`
`:""}\u7248\u672C\uFF1A${g.version}
\u65F6\u95F4\uFF1A${t}`,one_module_global:(e,t)=>`\u68C0\u6D4B\u5230\u5168\u5C40\u914D\u7F6E ${e}\uFF0C\u53EA\u5305\u62EC\u6A21\u5757 ${t}\uFF0C\u5199\u5165\u5230\u54EA\u4E00\u5957\u5168\u5C40\u914D\u7F6E\u4E2D\uFF1F`,profile_management:`${g.title} \u914D\u7F6E\u7BA1\u7406`,detecte_doc_profile:"\u68C0\u6D4B\u5230\u6587\u6863\u914D\u7F6E\uFF0C\u8BFB\u53D6\u540E\u4F1A\u8986\u76D6\u5F53\u524D\u914D\u7F6E\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F",detecte_notebook_profile:"\u68C0\u6D4B\u5230\u7B14\u8BB0\u672C\u914D\u7F6E\uFF0C\u8BFB\u53D6\u540E\u4F1A\u8986\u76D6\u5F53\u524D\u914D\u7F6E\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F",detecte_all_profile:"\u68C0\u6D4B\u5230\u6240\u6709\u914D\u7F6E\uFF0C\u53EF\u4EE5\u9009\u62E9\u9700\u8981\u7684\u90E8\u5206\u5BFC\u5165",detecte_all_notebook_profile:"\u68C0\u6D4B\u5230\u6240\u6709\u5168\u5C40\u914D\u7F6E\uFF0C\u53EF\u4EE5\u9009\u62E9\u9700\u8981\u7684\u90E8\u5206\u5BFC\u5165",detecte_global_profile:e=>e?`\u68C0\u6D4B\u5230\u5168\u5C40\u914D\u7F6E ${e}\uFF0C\u5305\u542B\u6240\u6709\u6A21\u5757\uFF0C\u53EF\u4EE5\u9009\u62E9\u9700\u8981\u7684\u6A21\u5757\u914D\u7F6E\u5BFC\u5165`:"\u53EF\u4EE5\u9009\u62E9\u9700\u8981\u7684\u6A21\u5757\u914D\u7F6E\u5BFC\u5165",which_part_profile:"\u60F3\u8981\u5199\u5165\u54EA\u90E8\u5206\u7684\u914D\u7F6E?",which_module_profile_write:"\u60F3\u8981\u5199\u5165\u54EA\u4E2A\u6A21\u5757\u7684\u914D\u7F6E?",which_global_profile_read_into:"\u60F3\u8981\u8BFB\u53D6\u8FDB\u54EA\u4E00\u5957\u5168\u5C40\u914D\u7F6E\u91CC?",parse_failed:"\u89E3\u6790\u5931\u8D25\uFF0C\u53EF\u80FD\u88AB\u4FEE\u6539",all_modules:"\u6240\u6709\u6A21\u5757",no_children:"\u8BE5\u5361\u7247\u6CA1\u6709\u5B50\u5361\u7247",success:"\u8BFB\u53D6\u6210\u529F",fail:"\u8BFB\u53D6\u5931\u8D25",profile_reset:"\u914D\u7F6E\u5DF2\u91CD\u7F6E",profile_sync:"\u914D\u7F6E\u5DF2\u540C\u6B65",old_version:"\u8B66\u544A\uFF1A\u5BFC\u5165\u7684\u914D\u7F6E\u7248\u672C\u6BD4\u5F53\u524D\u63D2\u4EF6\u7248\u672C\u65B0\uFF0C\u53EF\u80FD\u4F1A\u51FA\u73B0\u95EE\u9898\uFF0C\u8BF7\u8C28\u614E\u5BFC\u5165",not_this_profile:`\u4E0D\u662F ${g.title} \u7684\u914D\u7F6E`,range:{all_profile:"\u6240\u6709\u914D\u7F6E",global_profile:"\u5168\u5C40\u914D\u7F6E",all_global_profile:"\u6240\u6709\u5168\u5C40\u914D\u7F6E",doc_profile:"\u6587\u6863\u914D\u7F6E",notebook_profile:"\u7B14\u8BB0\u672C\u914D\u7F6E"},$profile_select_items9:["\u6240\u6709\u914D\u7F6E","\u5168\u5C40\u914D\u7F6E 1","\u5168\u5C40\u914D\u7F6E 2","\u5168\u5C40\u914D\u7F6E 3","\u5168\u5C40\u914D\u7F6E 4","\u5168\u5C40\u914D\u7F6E 5","\u6240\u6709\u5168\u5C40\u914D\u7F6E","\u6587\u6863\u914D\u7F6E","\u7B14\u8BB0\u672C\u914D\u7F6E"],$global_profile_items5:["\u5168\u5C40\u914D\u7F6E 1","\u5168\u5C40\u914D\u7F6E 2","\u5168\u5C40\u914D\u7F6E 3","\u5168\u5C40\u914D\u7F6E 4","\u5168\u5C40\u914D\u7F6E 5"]},en:{note_title:`${g.title} Profile`,note_content:(e,t)=>`\u{1F6AB} Do Not Modify
Range: ${e}
${module?"Module: "+module+`
`:""}Version: ${g.version}
Time: ${t}`,one_module_global:(e,t)=>`Global profile ${e} was detected, including module ${t} only, and which global profile was written to?`,profile_management:`${g.title} Profile Management`,profile_sync:"Profile has been synced",which_part_profile:"Which part of the profile do you want to write?",which_global_profile_read_into:"Which global profile do you want to read into?",which_module_profile_write:"Which module do you want to write?",parse_failed:"Parse failed, maybe modified",detecte_doc_profile:"Detected document profile, reading will overwrite the current profile, continue?",detecte_notebook_profile:"Detected notebook profile, reading will overwrite the current profile, continue?",detecte_all_profile:"Detected all profile, you can choose one part you need to import",detecte_all_notebook_profile:"Detected all notebook profile, you can choose one part you need to import",all_modules:"All Modules",success:"Read successfully",profile_reset:"Profile has been reset",fail:"Read failed",old_version:"Warning: The imported profile version is newer than the current plugin version, which may cause problems. Please import it with caution.",not_this_profile:`Not ${g.title}'s profile`,detecte_global_profile:e=>e?`Detected global profile ${e}, including all modules, you can choose one module you need to import`:"You can choose one module you need to import",range:{all_profile:"All Profile",global_profile:"Global Profile",all_global_profile:"All Global Profile",doc_profile:"Doc Profile",notebook_profile:"Notebook Profile"},$profile_select_items9:["All Profile","Global Profile 1","Global Profile 2","Global Profile 3","Global Profile 4","Global Profile 5","All Global Profile","Doc Profile","Notebook Profile"],$global_profile_items5:["Global Profile 1","Global Profile 2","Global Profile 3","Global Profile 4","Global Profile 5"],no_children:"This card has no child card."}});function Fn(){NSUserDefaults.standardUserDefaults().removeObjectForKey(g.globalProfileKey),NSUserDefaults.standardUserDefaults().removeObjectForKey(g.docProfileKey),NSUserDefaults.standardUserDefaults().removeObjectForKey(g.notebookProfileKey)}async function Gn(e,t=!0){let{childNotes:o}=e;if(!(o!=null&&o.length))return;let r,n,i;if(t)n=M.range.all_profile,r=Bn(JSON.stringify({key:g.key,version:g.version,profiles:{allDocProfileTemp:self.allDocProfile,allGlobalProfileTemp:self.allGlobalProfile,allNotebookProfileTemp:self.allNotebookProfile}}));else{let{index:s}=await(0,O.select)(M.$profile_select_items9,M.profile_management,M.which_part_profile,!0);if(s===-1)return;let c=await(async()=>{switch(s){case 0:return{allDocProfileTemp:self.allDocProfile,allGlobalProfileTemp:self.allGlobalProfile,allNotebookProfileTemp:self.allNotebookProfile};case 1:case 2:case 3:case 4:case 5:{let u=[M.all_modules,...kt.name],{index:p}=await(0,O.select)(u,M.profile_management,M.which_module_profile_write);return i=u[p],p===0?{allGlobalProfileTemp:{[s-1]:self.allGlobalProfile[s-1]}}:{allGlobalProfileTemp:{[s-1]:{[kt.key[p-1]]:self.allGlobalProfile[s-1][kt.key[p-1]]}}}}case 6:return{allGlobalProfileTemp:self.allGlobalProfile};case 7:return{allDocProfileTemp:self.allDocProfile};default:return{allNotebookProfileTemp:self.allNotebookProfile}}})();n=M.$profile_select_items9[s],r=Bn(JSON.stringify({key:g.key,version:g.version,profiles:c}))}let l=r.length,a=Math.ceil(l/o.length);(0,O.undoGroupingWithRefresh)(()=>{e.noteTitle=M.note_title,e.excerptText=M.note_content(n,rt(new Date),i);for(let s=0,c=0;s<l;s+=a,c++)o[c].excerptText=r.slice(s,s+a),o[c].noteTitle=String(c+1)})}async function Um(e){var t,o,r;try{if(!O.MN.currentDocmd5||!O.MN.currnetNotebookId)return;if(!((t=e.childNotes)!=null&&t.length))throw M.no_children;async function n(c,u){let p=Object.keys(c),f=kt.key.filter(h=>p.includes(h)),d=f.map(h=>kt.name[kt.key.indexOf(h)]);if(f.length===1){let{index:h}=await(0,O.select)(M.$global_profile_items5,M.profile_management,M.one_module_global(u,kt.name[kt.key.indexOf(f[0])]),!0);return h===-1?void 0:{index:h,profile:{...self.allGlobalProfile[h],...Ce(2,c)}}}else{let{index:h}=await(0,O.select)([M.all_modules,...d],M.profile_management,M.detecte_global_profile(u)),{index:y}=await(0,O.select)(M.$global_profile_items5,M.profile_management,M.which_global_profile_read_into,!0);return y===-1?void 0:{index:y,profile:h===0?Ce(2,c):{...self.allGlobalProfile[y],...Ce(2,{[f[h-1]]:c[f[h-1]]})}}}}let i=e.childNotes.map(c=>({text:c.excerptText,title:c.noteTitle})).sort((c,u)=>Number(c.title)-Number(u.title)).reduce((c,u)=>(c+=u.text,c),""),l=(()=>{try{return JSON.parse(Ps(i))}catch{throw M.parse_failed}})();if(l.key!==void 0&&l.key!==g.key)throw M.not_this_profile;let a=(o=l.profiles)!=null?o:l;g.lastVersion=(r=l.version)!=null?r:"4.0.0",(0,Is.gt)(g.lastVersion,g.version)&&(0,O.showHUD)(M.old_version);let s=Object.keys(a);if(s.length===3){let{allDocProfileTemp:c,allGlobalProfileTemp:u,allNotebookProfileTemp:p}=a,{index:f}=await(0,O.select)(M.$profile_select_items9,M.profile_management,M.detecte_all_profile,!0);if(f===-1)return;switch(f){case 0:self.allGlobalProfile=Ce(1,u),self.allDocProfile=Ce(0,c),self.allNotebookProfile=Ce(3,p);break;case 1:case 2:case 3:case 4:case 5:{let d=await n(u[f-1]);if(d)self.allGlobalProfile[d.index]=d.profile;else return;break}case 6:self.allGlobalProfile=Ce(1,u);break;case 7:self.allDocProfile=Ce(0,c);break;case 8:self.allNotebookProfile=Ce(3,p);break}}else if(s.length===1){let c=s[0];if(c==="allDocProfileTemp")if(await(0,O.confirm)(M.profile_management,M.detecte_doc_profile))self.allDocProfile=Ce(0,a[c]);else return;else if(c==="allGlobalProfileTemp"){let u=a[c];if(Array.isArray(u)){let{index:p}=await(0,O.select)([M.range.all_global_profile,...M.$global_profile_items5],M.profile_management,M.detecte_all_notebook_profile,!0);if(p===-1)return;if(p===0)self.allGlobalProfile=Ce(1,u);else{let f=await n(u[p-1]);if(f)self.allGlobalProfile[f.index]=f.profile;else return}}else{let p=Object.keys(u)[0],f=await n(u[0],Number(p)+1);if(f)self.allGlobalProfile[f.index]=f.profile;else return}}else if(c==="allNotebookProfileTemp")if(await(0,O.confirm)(M.profile_management,M.detecte_notebook_profile))self.allNotebookProfile=Ce(3,a[c]);else return}else throw"";self.allGlobalProfile.forEach(c=>{c.additional.lastVision=g.version}),(0,O.setLocalDataByKey)(self.allNotebookProfile,g.notebookProfileKey),(0,O.setLocalDataByKey)(self.allGlobalProfile,g.globalProfileKey),(0,O.setLocalDataByKey)(self.allDocProfile,g.docProfileKey),Me({range:0,docmd5:O.MN.currentDocmd5,notebookid:O.MN.currnetNotebookId}),ut(),(0,O.showHUD)(M.success)}catch(n){O.MN.error(n),(0,O.showHUD)(`${M.fail}\uFF1A${n}`)}}async function Wn(e,t){if(!(!O.MN.currentDocmd5||!O.MN.currnetNotebookId))switch(t){case 0:Um(e.note);break;case 1:e.childNodes.length?(Ze({range:0,docmd5:O.MN.currentDocmd5,notebookid:O.MN.currnetNotebookId}),Gn(e.note,!1)):(0,O.showHUD)(M.no_children);break;case 2:Fn(),Me({range:0,docmd5:O.MN.currentDocmd5,notebookid:O.MN.currnetNotebookId}),(0,O.showHUD)(M.profile_reset);break;case 3:Me({range:0,docmd5:O.MN.currentDocmd5,notebookid:O.MN.currnetNotebookId}),(0,O.showHUD)(M.profile_sync);break}}var D=C(S());var Me=({range:e,notebookid:t,docmd5:o,profileNO:r})=>{var n;try{let i=s=>{Wo(self.globalProfile,self.allGlobalProfile[s]),D.MN.log("Read current global profile","profile")},l=s=>{var c,u,p,f;Wo(self.notebookProfile,(f=(p=(c=self.allNotebookProfile)==null?void 0:c[s])!=null?p:(u=self.allNotebookProfile)==null?void 0:u.default)!=null?f:io),D.MN.log("Read currect notebook profile","profile")},a=s=>{var c,u,p,f;Wo(self.docProfile,(f=(p=(c=self.allDocProfile)==null?void 0:c[s])!=null?p:(u=self.allDocProfile)==null?void 0:u.default)!=null?f:no),D.MN.log("Read currect doc profile","profile")};switch(e){case 0:{let s=(0,D.getLocalDataByKey)(g.globalProfileKey),c=(0,D.getLocalDataByKey)(g.docProfileKey),u=(0,D.getLocalDataByKey)(g.notebookProfileKey);s?(g.lastVersion=(n=s[0].additional.lastVision)!=null?n:"4.0.0",self.allGlobalProfile=Ce(1,s),ds(go,self.allGlobalProfile[0])&&(self.allGlobalProfile.forEach((p,f)=>{let d=de(go);Wo(d,self.allGlobalProfile[f]),self.allGlobalProfile[f]=d}),(0,D.setLocalDataByKey)(self.allGlobalProfile,g.globalProfileKey))):(D.MN.log("Initialize global profile","profile"),self.allGlobalProfile=Array(5).fill(de(go))),c?self.allDocProfile=Ce(0,c):(D.MN.log("Initialize doc profile","profile"),self.allDocProfile={[o]:de(no),default:de(no)}),u?self.allNotebookProfile=Ce(3,u):(D.MN.log("Initialize notebook profile","profile"),self.allNotebookProfile={[t]:de(io),default:de(io)}),self.allGlobalProfile.forEach(p=>{p.additional.lastVision=g.version}),g.lastVersion=g.version,l(t),a(o),i(self.notebookProfile.addon.profile[0]);break}case 3:{l(t),i(self.notebookProfile.addon.profile[0]);break}case 1:{a(o);break}case 2:{i(r);break}}Ts()}catch(i){D.MN.error(i)}},Ze=({range:e,notebookid:t,docmd5:o,profileNO:r})=>{let n=a=>{self.allDocProfile[a]=de(self.docProfile),(0,D.setLocalDataByKey)(self.allDocProfile,g.docProfileKey),D.MN.log("Write current doc profile","profile")},i=a=>{self.allGlobalProfile[a]=de(self.globalProfile),(0,D.setLocalDataByKey)(self.allGlobalProfile,g.globalProfileKey),D.MN.log("Write global profile","profile")},l=a=>{self.allNotebookProfile[a]=de(self.notebookProfile),(0,D.setLocalDataByKey)(self.allNotebookProfile,g.notebookProfileKey),D.MN.log("Write notebook profile","profile")};switch(e){case 0:{l(t),n(o),i(self.notebookProfile.addon.profile[0]);break}case 3:{l(t),i(self.notebookProfile.addon.profile[0]);break}case 1:{n(o);break}case 2:{i(r);break}}};async function Br(e,t,o){var r,n,i,l;try{if(!D.MN.currentDocmd5||!D.MN.currnetNotebookId)return;switch(t){case"quickSwitch":self.globalProfile.addon.quickSwitch=o;break;case"profile":let s=self.notebookProfile.addon.profile[0];self.notebookProfile.addon.profile=o,Ze({range:2,profileNO:s}),Me({range:2,profileNO:o[0]});break;default:((n=(r=self.globalProfile)==null?void 0:r[e])==null?void 0:n[t])!==void 0?(self.globalProfile[e][t]=o,self.notebookProfile.addon.profile[0]===4&&Object.entries(self.allGlobalProfile).forEach(([c,u])=>{var p;((p=u[e])==null?void 0:p[t])!==void 0&&(self.allGlobalProfile[c][e][t]=o)})):((l=(i=self.notebookProfile)==null?void 0:i[e])==null?void 0:l[t])!==void 0?(self.notebookProfile[e][t]=o,self.notebookProfile.addon.profile[0]===4&&("default"in self.allNotebookProfile||(self.allNotebookProfile.default=de(io)),Object.entries(self.allNotebookProfile).forEach(([c,u])=>{var p;((p=u[e])==null?void 0:p[t])!==void 0&&(self.allNotebookProfile[c][e][t]=o)}))):(self.docProfile[e][t]=o,self.notebookProfile.addon.profile[0]===4&&("default"in self.allDocProfile||(self.allDocProfile.default=de(no)),Object.entries(self.allDocProfile).forEach(([c,u])=>{var p;((p=u[e])==null?void 0:p[t])!==void 0&&(self.allDocProfile[c][e][t]=o)})))}let a=3;if(self.backupWaitTimes===void 0){D.MN.log("Save profile: start new timer","profile"),self.backupWaitTimes=0;let s=a;for(;s;)self.backupWaitTimes?(s=self.backupWaitTimes,self.backupWaitTimes=0):s--,D.MN.log(s,"profile"),await(0,D.delay)(1);self.backupWaitTimes=void 0,D.MN.log("Save profile completed","profile"),Ze({range:0,docmd5:D.MN.currentDocmd5,notebookid:D.MN.currnetNotebookId});let{backupID:c,autoBackup:u}=self.globalProfile.addon;if(c&&u){D.MN.log("Auto backup to card","profile");let p=D.MN.db.getNoteById(c.replace(D.MN.scheme+"://note/",""));p&&Gn(p)}}else self.backupWaitTimes=self.backupWaitTimes+1}catch(a){D.MN.error(String(a))}}function Ur(){let{cacheTitle:e,cacheComment:t,cacheTag:o}=self.notebookProfile.additional,r={cacheTitle:{},cacheComment:{},cacheTag:{}};Object.entries(e).forEach(([n,i])=>{D.MN.db.getNoteById(n)&&i!==void 0&&(r.cacheTitle[n]=i)}),Object.entries(t).forEach(([n,i])=>{D.MN.db.getNoteById(n)&&i!==void 0&&(r.cacheComment[n]=i)}),Object.entries(o).forEach(([n,i])=>{D.MN.db.getNoteById(n)&&i!==void 0&&(r.cacheTag[n]=i)}),self.notebookProfile.additional.cacheComment=r.cacheComment,self.notebookProfile.additional.cacheTag=r.cacheTag,self.notebookProfile.additional.cacheTitle=r.cacheTitle}var Ns=C(S());var Y=(0,Ns.i18n)({zh:{intro:`\u5F53\u524D\u7248\u672C\uFF1A${g.version}`,double_link:"\u53CC\u51FB\u6253\u5F00\u94FE\u63A5",use_markdown:{label:"\u4F7F\u7528 Markdown \u8BC4\u8BBA",help:"\u6240\u6709\u901A\u8FC7 OhMyMN \u751F\u6210\u7684\u8BC4\u8BBA\u5C06\u76F4\u63A5\u4F7F\u7528 Markdown     "},profile:{$option5:["\u914D\u7F6E 1","\u914D\u7F6E 2","\u914D\u7F6E 3","\u914D\u7F6E 4","\u521D\u59CB\u5316"],label:"\u9009\u62E9\u5168\u5C40\u914D\u7F6E",help:"\u3010\u4EC5\u5F53\u524D\u7B14\u8BB0\u672C\u3011\u4E0D\u540C\u573A\u666F\uFF0C\u4E0D\u540C\u914D\u7F6E\u3002"},quick_switch:{label:"\u6A21\u5757\u5FEB\u6377\u5F00\u5173"},panel_position:{$option6:["\u6587\u6863\u9760\u5185","\u6587\u6863\u8111\u56FE\u4E2D\u95F4","\u8111\u56FE\u9760\u5185","\u9760\u5DE6","\u5C45\u4E2D","\u9760\u53F3","\u624B\u52A8"],label:"\u9762\u677F\u663E\u793A\u4F4D\u7F6E"},panel_height:{$option3:["\u9AD8\u70B9","\u6807\u51C6","\u77EE\u70B9","\u624B\u52A8"],label:"\u9762\u677F\u663E\u793A\u9AD8\u5EA6"},panle_control:{$option2:["\u53CC\u51FB\u56FE\u6807\u6253\u5F00\u9762\u677F","\u52A8\u4F5C\u6267\u884C\u5B8C\u5173\u95ED\u9762\u677F"],label:"\u9762\u677F\u663E\u793A\u63A7\u5236"},drag_merge:{label:"\u62D6\u62FD\u5408\u5E76\u751F\u6210\u6807\u9898",help:"\u3010\u53EF\u4EE5\u751F\u6210\u6807\u9898\u7684\u6A21\u5757\u3011\u5982\u679C\u5361\u7247\u4E2D\u6709\u6458\u5F55\uFF0C\u4F7F\u7528\u624B\u578B\u5DE5\u5177\u62D6\u62FD\u9009\u533A\u5408\u5E76\u5230\u8BE5\u5361\u7247\u4E2D\u3002",$option2:["\u59CB\u7EC8\u4E0D\u751F\u6210\u6807\u9898","\u6EE1\u8DB3\u6761\u4EF6\u65F6\u751F\u6210\u6807\u9898","\u59CB\u7EC8\u8F6C\u6807\u9898"]},has_title_then:{$option3:["\u4E0D\u8F6C\u6807\u9898","\u5408\u5E76\u6807\u9898","\u8986\u76D6\u6807\u9898"],label:"> \u5DF2\u7ECF\u6709\u6807\u9898"},remove_excerpt:{$option2:["\u7ACB\u5373\u5220\u9664","\u7B49\u4F1A\u5220\u9664"],label:"> \u62D6\u5165\u7684\u6458\u5F55\u5C06"},lock_excerpt:{label:"\u9501\u5B9A\u6458\u5F55\u6587\u5B57"},auto_backup:{label:"\u81EA\u52A8\u5907\u4EFD\u914D\u7F6E"},backup_ID:{help:"\u8F93\u5165\u5907\u4EFD\u5361\u7247\u94FE\u63A5\uFF0C\u8BF7\u786E\u4FDD\u8BE5\u5361\u7247\u6709\u5B50\u5361\u7247\uFF0C\u5426\u5219\u65E0\u6CD5\u5199\u5165\u3002\u5B50\u5361\u7247\u8D8A\u591A\u8D8A\u597D\u3002",not_link:"\u4E0D\u662F\u5361\u7247\u94FE\u63A5",not_exit:"\u5361\u7247\u4E0D\u5B58\u5728",no_child:"\u5361\u7247\u6CA1\u6709\u5B50\u5361\u7247"}},en:{intro:`Current Version: ${g.version}`,double_link:"Double Click to Open Link",profile:{$option5:["Profile 1","Profile 2","Profile 3","Profile 4","Initialize"],label:"Select Global Profile",help:"[Only Current Notebook] Different Scenes, Different Profile."},quick_switch:{label:"Module Quick Switch"},panel_position:{$option6:["Document Inner Side","Document MindMap Middle","MindMap Inner Side","Left","Center","Right","Custom"],label:"Panel Position"},panel_height:{$option3:["Taller","Standard","Shorter","Custom"],label:"Panel Height"},panle_control:{$option2:["Double Click Icon to Open Panel","Close Panel After Action"],label:"Panel Control"},drag_merge:{label:"Drag Merge to Generate Title",help:"[Modules that can generate titles] If the card has an excerpt, use the hand tool to drag the selection area to merge into the card.",$option2:["Never Generate Title","Always Generate Title","Generate Title When Conditions Are Met"]},has_title_then:{$option3:["Not Turn to Title","Merge Title","Override Title"],label:"> Has Title"},remove_excerpt:{$option2:["Remove Immediately","Remove Later"],label:"> The Dragged Excerpt Will"},lock_excerpt:{label:"Lock Excerpt Text"},auto_backup:{label:"Auto Backup Profile"},use_markdown:{label:"Use Markdown Comment",help:"All comments generated by OhMyMN will use Markdown directly."},backup_ID:{help:"Enter the backup card link, please make sure that the card has subcards, otherwise it cannot be written. The more subcards, the better.        ",not_link:"Not a card url",not_exit:"Card does not exist",no_child:"Card has no subcards"}}});var Vn={name:g.title,key:"addon",link:g.forum,intro:Y.intro,settings:[{help:Y.profile.help,key:"profile",type:6,option:Y.profile.$option5,label:Y.profile.label},{label:Y.quick_switch.label,key:"quickSwitch",type:7,option:[]},{key:"panelPosition",type:6,option:Y.panel_position.$option6,label:Y.panel_position.label},{key:"panelHeight",type:6,option:Y.panel_height.$option3,label:Y.panel_height.label},{key:"panelControl",type:7,option:Y.panle_control.$option2,label:Y.panle_control.label},{key:"dragMerge",type:6,label:Y.drag_merge.label,option:Y.drag_merge.$option2,help:Y.drag_merge.help},{key:"hasTitleThen",type:6,label:Y.has_title_then.label,option:Y.has_title_then.$option3,bind:["dragMerge",[1,2]]},{key:"removeExcerpt",type:6,label:Y.remove_excerpt.label,option:Y.remove_excerpt.$option2,bind:["dragMerge",[1,2]]},{key:"doubleLink",type:1,label:Y.double_link},{key:"useMarkdown",type:1,label:Y.use_markdown.label,help:Y.use_markdown.help},{key:"autoBackup",type:1,label:Y.auto_backup.label},{key:"backupID",type:4,help:Y.backup_ID.help,bind:["autoBackup",!0],check:({input:e})=>{var r;let t=e.replace(Fr.MN.scheme+"://note/","");if(t===e)throw Y.backup_ID.not_link;let o=Fr.MN.db.getNoteById(t);if(!o)throw Y.backup_ID.not_exit;if(!((r=o.childNotes)!=null&&r.length))throw Y.backup_ID.no_child}}]};Fr.MN.isMN4||(Vn.settings=Vn.settings.filter(e=>e.key!=="useMarkdown"));var Es=Vn;var Rs=C(S());var As=C(S());var Vt=(0,As.i18n)({zh:{intro:"\u3010\u4EC5 iPad \u53EF\u7528\u3011\u4F7F\u7528\u624B\u52BF\u6765\u89E6\u53D1 MagicAction \u4E2D\u7684\u52A8\u4F5C\u3002\u8BE5\u529F\u80FD\u5B8C\u5168\u7531 OhMyMN \u63D0\u4F9B\uFF0C\u4E0E MN \u65E0\u5173\u3002\u70B9\u51FB\u67E5\u770B\u624B\u52BF\u76D1\u6D4B\u533A\u57DF\u53CA\u6CE8\u610F\u4E8B\u9879\u3002             ",single_bar:"\u5361\u7247\u5355\u9009\u5DE5\u5177\u680F",muilt_bar:"\u5361\u7247\u591A\u9009\u5DE5\u5177\u680F",selection_bar:"\u6587\u5B57\u9009\u62E9\u5DE5\u5177\u680F",action_not_work:"\u6A21\u5757\u672A\u542F\u7528\uFF0C\u8BE5\u52A8\u4F5C\u65E0\u6CD5\u6267\u884C",custom_shortcut:"\u81EA\u5B9A\u4E49\u6377\u5F84",only_mn:"\u4EC5\u652F\u6301 MarginNote \u63D2\u4EF6\u7684 URL Scheme\uFF0C\u4F46\u4E0D\u9650\u4E8E OhMyMN",show_y:{label:"\u663E\u793A Y \u8F74\u5750\u6807",help:"\u9488\u5BF9\u6587\u5B57\u9009\u62E9\u5DE5\u5177\u680F\u533A\u57DF\u624B\u52BF\u65E0\u6CD5\u8BC6\u522B\u7684\u95EE\u9898\uFF0C\u5F00\u542F\u540E\u4F1A\u663E\u793A\u6ED1\u52A8\u4F4D\u7F6E\u7684 Y \u8F74\u5750\u6807\uFF0C\u65B9\u4FBF\u81EA\u884C\u8C03\u6574\u3002     "},selection_bar_y:{help:"[\u4ECE\u5DE6\u5230\u53F3\u9009\u62E9\u65F6\u5728\u6587\u5B57\u9009\u62E9\u5DE5\u5177\u680F\u9876\u90E8\u6ED1\u52A8\u65F6\u7684 Y \u8F74\u5750\u6807, \u4ECE\u53F3\u5230\u5DE6\u9009\u62E9\u65F6\u5728\u6587\u5B57\u9009\u62E9\u5DE5\u5177\u680F\u9876\u90E8\u6ED1\u52A8\u65F6\u7684 Y \u8F74\u5750\u6807]\u3002\u70B9\u51FB\u67E5\u770B\u8BBE\u7F6E\u65B9\u6CD5\u3002                   ",enter_positive:"\u8BF7\u8F93\u5165\u6B63\u6574\u6570",input_array:"\u8BF7\u8F93\u5165\u6570\u7EC4\uFF0C\u6BD4\u5982 [0,70]",input_two_number:"\u6570\u7EC4\u5185\u5FC5\u987B\u6709\u4E24\u4E2A\u6570\u5B57\uFF0C\u6BD4\u5982 [0,70]",link:x("gesture","\u8C03\u6574\u6587\u5B57\u9009\u62E9\u5DE5\u5177\u680F\u8BC6\u522B\u533A\u57DF")}},en:{intro:"\u3010iPad only\u3011Trigger MagicAction by gesture. This feature is provided by OhMyMN, not MarginNote. Click to view the gesture detection area and precautions.",single_bar:"Card Selection Toolbar",muilt_bar:"Card Multi-Select Toolbar",selection_bar:"Text Selection Toolbar",action_not_work:"Module is not enabled, the action cannot be run",custom_shortcut:"Custom Shortcuts",only_mn:"Only support MarginNote addon's URL Scheme, but not limited to OhMyMN.",selection_bar_y:{help:"[Y axis coordinate when swiping in the top of text select toolbar when selecting from left to right, Y axis coordinate when swiping in the top of text select toolbar when selecting from right to left].",enter_positive:"Please enter a positive integer",input_array:"Please enter an array, such as [0,70]",input_two_number:"There must be two numbers in the array, such as [0,70]",link:x("gesture","adjust-the-text-selection-toolbar-recognition-area")},show_y:{label:"Show Y coordinate",help:"For the problem that the gesture in the text selection toolbar area cannot be recognized, the Y coordinate of the sliding position will be displayed after turning on, which is convenient for self-adjustment."}}});var Ms={name:"Gesture",key:"gesture",intro:Vt.intro,link:x("gesture"),settings:[...[[Vt.single_bar,"single"],[Vt.muilt_bar,"muilt"],[Vt.selection_bar,"selection"]].map(e=>[["\u2191","Up"],["\u2193","Down"],["\u2190","Left"],["\u2192","Right"]].map(t=>[{label:`${e[0]} ${t[0]}`,key:`${e[1]}BarSwipe${t[1]}`,type:6,option:[]},{key:`${e[1]}BarSwipe${t[1]}Shortcut`,type:4,bind:[`${e[1]}BarSwipe${t[1]}`,1],check({input:o}){if(!o.startsWith(Rs.MN.scheme+"://addon"))throw Vt.only_mn}}])).flat(1/0)]};var ie=C(S());var Os=C(S());var L=(0,Os.i18n)({zh:{intro:"\u6240\u6709\u52A8\u4F5C\u5747\u9700\u8981\u5148\u9009\u4E2D\u5361\u7247\u3002\u52A8\u4F5C\u6765\u81EA\u4E8E\u5404\u4E2A\u6A21\u5757\uFF0C\u9700\u8981\u542F\u7528\u5BF9\u5E94\u7684\u6A21\u5757\u3002\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u7684\u4F7F\u7528\u65B9\u6CD5\u548C\u6CE8\u610F\u4E8B\u9879\u3002",default_merge_text:{help:"\u5408\u5E76\u5361\u7247\u5185\u6587\u5B57\u65F6\u7684\u524D\u540E\u4FEE\u9970\uFF0C\u9ED8\u8BA4\u6DFB\u52A0\u5E8F\u53F7\u548C\u6362\u884C\uFF08$&\u4EE3\u8868\u6BCF\u4E00\u6BB5\uFF09\uFF0C\u70B9\u51FB\u67E5\u770B\u81EA\u5B9A\u4E49\u65B9\u6CD5\u3002                 ",error:"\u7F3A\u5C11 $&",link:x("magicaction4card","\u5408\u5E76\u5361\u7247\u5185\u6587\u5B57")},rename_title:{label:"\u91CD\u547D\u540D\u6807\u9898",help:`$& \u6307\u4EE3\u539F\u6807\u9898\u3002\u8F93\u5165 "%['1'] $&" \u53EF\u5FEB\u901F\u4E3A\u9009\u4E2D\u5361\u7247\u6807\u9898\u7F16\u53F7\u3002`},smart_selection:{label:"\u667A\u80FD\u9009\u62E9",help:"\u5E2E\u52A9\u4F60\u5FEB\u901F\u9009\u4E2D\u5B50\u5361\u7247\uFF0C\u540E\u4EE3\u5361\u7247\u3002"},filter_cards:{label:"\u7B5B\u9009\u5361\u7247",$option5:["\u6240\u6709","\u6807\u9898","\u6458\u5F55","\u8BC4\u8BBA","\u6807\u7B7E"]},switch_title:{label:"\u5207\u6362\u6458\u5F55\u6807\u9898",help:"\u5F53\u4E24\u8005\u90FD\u5B58\u5728\u65F6\u8BF7\u4F7F\u7528\u300C\u4EA4\u6362\u6807\u9898\u548C\u6458\u5F55\u300D\u3002",$option2:["\u5207\u6362\u4E3A\u4E0D\u5B58\u5728\u7684","\u4EA4\u6362\u6807\u9898\u548C\u6458\u5F55"],swap_title_excerpt:"\u4EA4\u6362\u6807\u9898\u548C\u6458\u5F55",swap_help:"\u68C0\u6D4B\u5230\u6240\u9009\u5361\u7247\u4E2D\u6709\u6807\u9898\u548C\u6458\u5F55\u540C\u65F6\u5B58\u5728\u7684\u60C5\u51B5\uFF0C\u8BF7\u9009\u62E9\u4EA4\u6362\u65B9\u5F0F",$both_option3:["\u6458\u5F55 \u21C4 \u6807\u9898","\u6458\u5F55 \u2192 \u6807\u9898","\u6458\u5F55 \u2190 \u6807\u9898"]},merge_text:{label:"\u5408\u5E76\u5361\u7247\u5185\u6587\u5B57",help:"\u4EC5\u652F\u6301\u5408\u5E76\u6587\u5B57\u6458\u5F55\u548C\u6587\u5B57\u8BC4\u8BBA\uFF0C\u4E0D\u5408\u5E76\u6807\u7B7E\u548C\u94FE\u63A5\uFF0C\u5176\u4F59\u5185\u5BB9\u4F1A\u5728\u5408\u5E76\u540E\u7F6E\u9876\u3002",is_excerpt_pic_text:"\u68C0\u6D4B\u5230\u5F53\u524D\u6458\u5F55\u4E3A\u56FE\u7247 OCR \u7684\u6587\u5B57\uFF0C\u5408\u5E76\u4E3A\u8BC4\u8BBA\u65E0\u6CD5\u5220\u9664\u8BE5\u6458\u5F55\uFF0C\u662F\u5426\u7EE7\u7EED\u5408\u5E76\u4E3A\u8BC4\u8BBA\uFF1F",$excerpt_pic_text_option2:["\u7EE7\u7EED","\u5408\u5E76\u4E3A\u6458\u5F55"],is_excerpt_pic:"\u68C0\u6D4B\u5230\u5F53\u524D\u6458\u5F55\u4E3A\u56FE\u7247\uFF0C\u5408\u5E76\u4E3A\u6458\u5F55\u540E\u4ECD\u65E7\u662F\u56FE\u7247\uFF0C\u662F\u5426\u7EE7\u7EED\u5408\u5E76\u4E3A\u6458\u5F55\uFF1F",$excerpt_pic_option2:["\u7EE7\u7EED","\u5408\u5E76\u4E3A\u8BC4\u8BBA"],$option2:["\u5408\u5E76\u4E3A\u6458\u5F55","\u5408\u5E76\u4E3A\u8BC4\u8BBA"]},merge_cards:{label:"\u5408\u5E76\u5361\u7247",$option2:["\u540C\u65F6\u5408\u5E76\u6807\u9898","\u4E0D\u5408\u5E76\u6807\u9898"]},manage_profile:{label:"\u914D\u7F6E\u7BA1\u7406",$option4:["\u8BFB\u53D6\u914D\u7F6E","\u5199\u5165\u914D\u7F6E","\u91CD\u7F6E\u914D\u7F6E","\u540C\u6B65\u5176\u4ED6\u7A97\u53E3\u7684\u914D\u7F6E"],help:"\u5199\u5165\u914D\u7F6E\u65F6\u8BF7\u786E\u4FDD\u8BE5\u5361\u7247\u81F3\u5C11\u6709\u4E00\u5F20\u5B50\u5361\u7247\u3002\u591A\u5F20\u5B50\u5361\u7247\u53EF\u4EE5\u4E00\u8D77\u5206\u62C5\u914D\u7F6E\uFF0C\u9632\u6B62\u5355\u5F20\u5361\u7247\u5B57\u6570\u8FC7\u591A\u3002"},is_selected:"\u60A8\u9700\u8981\u7684\u5361\u7247\u5DF2\u9009\u4E2D\uFF0C\u8BF7\u7EE7\u7EED\u64CD\u4F5C",none_card:"\u672A\u627E\u5230\u7B26\u5408\u7684\u5361\u7247",hierarchical_numbering:"\u8BF7\u786E\u4FDD\u9009\u4E2D\u7684\u6BCF\u5F20\u5361\u7247\u5747\u4E3A\u540C\u5C42\u7EA7\u4E14\u90FD\u6709\u5B50\u5361\u7247"},en:{intro:"All actions require the card to be selected first. The actions come from various modules and require the corresponding modules to be enabled. Click to view the specific usage method and precautions.",smart_selection:{label:"Smart Selector",help:"Help you quickly select the child card and descendant card."},default_merge_text:{help:"The front and rear decoration of the text in the card when merging, the default adds a serial number and a line break ($& represents each paragraph), click to view the custom method.                 ",error:"Missing $&",link:x("magicaction4card","merge-text")},switch_title:{help:"Use [Swap Title and Excerpt] when both are present\u300D",label:"Switch Excerpt / Title",$option2:["Switch to Non-Existent","Swap Title and Excerpt"],swap_title_excerpt:"Swap Title and Excerpt",swap_help:"It is detected that there are both title and excerpt in the selected card. Please select the swap method",$both_option3:["Excerpt \u21C4 Title","Excerpt \u2192 Title","Excerpt \u2190 Title"]},filter_cards:{label:"Filter Cards",$option5:["All","Title","Excerpt","Comment","Tag"]},merge_text:{label:"Merge Text",is_excerpt_pic_text:"The current excerpt is a picture OCR text. If you merge it as a comment, you cannot delete the excerpt. Do you want to continue to merge it as a comment?",$excerpt_pic_text_option2:["Continue","Merge as Comment"],help:"Only support merging text excerpt and text comment, not merging tags and link, other content will be pinned after merging",$excerpt_pic_option2:["Continue","Merge as Comment"],is_excerpt_pic:"The excerpt is a picture, continue to merge as excerpt?",$option2:["Merged as Excerpt","Merged as Comment"]},merge_cards:{label:"Merge Multiple Cards",$option2:["Merge Title","Not Merge Titles"]},manage_profile:{label:"Manage Profile",$option4:["Read Profile","Write Profile","Reset Profile","Sync Profile with Other Windows"],help:"Please make sure that the card has at least one child card when writing the profile. Multiple child cards can share the profile together to prevent a single card from having too many words."},rename_title:{help:`$& refers to the original title. Enter "%['1'] $&" to Quickly number the selected card title.`,label:"Rename Titles"},is_selected:"The card is selected, please continue",none_card:"No matching cards found",hierarchical_numbering:"Ensure that each selected card is at the same level and has child node"}});var ge=C(S()),vt=C(S());var Ws=C(S());function Fm(e,t={}){e.Formatters=t;function o(i,l){let a,s,c;return a=/^[\'\"](.*)[\'\"]$/g,s=/^[+-]?\d+$/g,c=/^[+-]?\d*\.\d+$/g,a.test(i)?i.replace(a,"$1"):s.test(i)?parseInt(i,10):c.test(i)?parseFloat(i):l(i)}function r(i,l,a){let s,c,u,p,f=[i];for(s=/^\s*([^\:]+)/g,c=/\:\s*([\'][^\']*[\']|[\"][^\"]*[\"]|[^\:]+)\s*/g,u=s.exec(l),p=u[1].trim();u=c.exec(l);)f.push(o(u[1].trim(),a));return e.Formatters.hasOwnProperty(p)?(l=e.Formatters[p],l.apply(l,f)):i}let n=e.Context.prototype.lookup;return e.Context.prototype.lookup=function(l){let a=l.split("|"),s=a.shift().trim();/^".+"$|^'.+'$/.test(s)?s=s.slice(1,-1):s=n.call(this,s);for(let c=0,u=a.length;c<u;++c)s=r(s,a[c],this.lookup.bind(this));return s},e}var Ds=Fm;var Ls=C(S());var Bs={escape:()=>(e,t)=>encodeURIComponent(t(e)),nohl:()=>(e,t)=>(0,Ls.removeHighlight)(t(e)),blod:()=>(e,t)=>t(e).replace(/\*\*(.+?)\*\*/g,"<b>$1</b>"),clozeSync:()=>(e,t)=>t(e).replace(/\*\*(.+?)\*\*/g,"{{c1::$1}}"),cloze:()=>(e,t)=>{let o=1;return t(e).replace(/\*\*(.+?)\*\*/g,(r,n)=>`{{c${o++}::${n}}}`)},lower:()=>(e,t)=>t(e).toLowerCase(),upper:()=>(e,t)=>t(e).toUpperCase(),join:()=>(e,t)=>{var l;if(((l=e.match(/{{.+}}/g))==null?void 0:l.length)!==1)return t(e);let[o,r,n]=e.trimStart().split(/({{.+?}})/,3),i=t(r).split(/; /);if(/\$\[.+\]/.test(o)){let a=ot(o,i.length,"\\$");return i.map((s,c)=>o.replace(/\$\[(.+)\]/,a[c])+s).join(n)}return i.map(a=>o+a).join(n)}},Us={upper:e=>e.toUpperCase(),lower:e=>e.toLowerCase(),escape:e=>encodeURIComponent(e),nohl:e=>e.replace(/\*\*(.+?)\*\*/g,"$1"),blod:e=>e.replace(/\*\*(.+?)\*\*/g,"<b>$1</b>"),clozeSync:e=>e.replace(/\*\*(.+?)\*\*/g," {{c1::$1}} "),cloze:e=>{let t=1;return e.replace(/\*\*(.+?)\*\*/g,(o,r)=>` {{c${t++}::${r}}} `)},join:(e,t,o)=>{let r=e.split("; ");if(!Array.isArray(r)||r.length<2)return e;if(/\$\[.+\]/.test(t!=null?t:"")){let n=ot(t,r.length,"\\$");r=r.map((i,l)=>t.replace(/\$\[(.+)\]/,n[l])+i)}else t&&(r=r.map(n=>n=t+n));return r.join(o!=null?o:"; ")},fmt:(e,t)=>{let o=new Date(e);return o instanceof Date?rt(o,t):e}};var Gm=Object.prototype.toString,Tt=Array.isArray||function(t){return Gm.call(t)==="[object Array]"};function jn(e){return typeof e=="function"}function Wm(e){return Tt(e)?"array":typeof e}function Kn(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Fs(e,t){return e!=null&&typeof e=="object"&&t in e}function Vm(e,t){return e!=null&&typeof e!="object"&&e.hasOwnProperty&&e.hasOwnProperty(t)}var Km=RegExp.prototype.test;function jm(e,t){return Km.call(e,t)}var qm=/\S/;function zm(e){return!jm(qm,e)}function Hm(e){return encodeURIComponent(e)}var Jm=/\s*/,Xm=/\s+/,Gs=/\s*=/,Zm=/\s*\}/,Ym=/#|\^|\/|>|\{|&|=|!/;function Qm(e,t){if(!e)return[];var o=!1,r=[],n=[],i=[],l=!1,a=!1,s="",c=0;function u(){if(l&&!a)for(;i.length;)delete n[i.pop()];else i=[];l=!1,a=!1}var p,f,d;function h(X){if(typeof X=="string"&&(X=X.split(Xm,2)),!Tt(X)||X.length!==2)throw new Error("Invalid tags: "+X);p=new RegExp(Kn(X[0])+"\\s*"),f=new RegExp("\\s*"+Kn(X[1])),d=new RegExp("\\s*"+Kn("}"+X[1]))}h(t||Ve.tags);for(var y=new Ko(e),k,N,P,re,b,m;!y.eos();){if(k=y.pos,P=y.scanUntil(p),P)for(var w=0,_=P.length;w<_;++w)re=P.charAt(w),zm(re)?(i.push(n.length),s+=re):(a=!0,o=!0,s+=" "),n.push(["text",re,k,k+1]),k+=1,re===`
`&&(u(),s="",c=0,o=!1);if(!y.scan(p))break;if(l=!0,N=y.scan(Ym)||"name",y.scan(Jm),N==="="?(P=y.scanUntil(Gs),y.scan(Gs),y.scanUntil(f)):N==="{"?(P=y.scanUntil(d),y.scan(Zm),y.scanUntil(f),N="&"):P=y.scanUntil(f),!y.scan(f))throw new Error("Unclosed tag at "+y.pos);if(N==">"?b=[N,P,k,y.pos,s,c,o]:b=[N,P,k,y.pos],c++,n.push(b),N==="#"||N==="^")r.push(b);else if(N==="/"){if(m=r.pop(),!m)throw new Error('Unopened section "'+P+'" at '+k);if(m[1]!==P)throw new Error('Unclosed section "'+m[1]+'" at '+k)}else N==="name"||N==="{"||N==="&"?a=!0:N==="="&&h(P)}if(u(),m=r.pop(),m)throw new Error('Unclosed section "'+m[1]+'" at '+y.pos);return th(eh(n))}function eh(e){for(var t=[],o,r,n=0,i=e.length;n<i;++n)o=e[n],o&&(o[0]==="text"&&r&&r[0]==="text"?(r[1]+=o[1],r[3]=o[3]):(t.push(o),r=o));return t}function th(e){for(var t=[],o=t,r=[],n,i,l=0,a=e.length;l<a;++l)switch(n=e[l],n[0]){case"#":case"^":o.push(n),r.push(n),o=n[4]=[];break;case"/":i=r.pop(),i[5]=n[2],o=r.length>0?r[r.length-1][4]:t;break;default:o.push(n)}return t}function Ko(e){this.string=e,this.tail=e,this.pos=0}Ko.prototype.eos=function(){return this.tail===""};Ko.prototype.scan=function(t){var o=this.tail.match(t);if(!o||o.index!==0)return"";var r=o[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};Ko.prototype.scanUntil=function(t){var o=this.tail.search(t),r;switch(o){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,o),this.tail=this.tail.substring(o)}return this.pos+=r.length,r};function yo(e,t){this.view=e,this.cache={".":this.view},this.parent=t}yo.prototype.push=function(t){return new yo(t,this)};yo.prototype.lookup=function(t){var o=this.cache,r;if(o.hasOwnProperty(t))r=o[t];else{for(var n=this,i,l,a,s=!1;n;){if(t.indexOf(".")>0)for(i=n.view,l=t.split("."),a=0;i!=null&&a<l.length;)a===l.length-1&&(s=Fs(i,l[a])||Vm(i,l[a])),i=i[l[a++]];else i=n.view[t],s=Fs(n.view,t);if(s){r=i;break}n=n.parent}o[t]=r}return jn(r)&&(r=r.call(this.view)),s?r:""};function Ee(){this.templateCache={_cache:{},set:function(t,o){this._cache[t]=o},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}Ee.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};Ee.prototype.parse=function(t,o){var r=this.templateCache,n=t+":"+(o||Ve.tags).join(":"),i=typeof r<"u",l=i?r.get(n):void 0;return l==null&&(l=Qm(t,o),i&&r.set(n,l)),l};Ee.prototype.render=function(t,o,r,n){var i=this.getConfigTags(n),l=this.parse(t,i),a=o instanceof yo?o:new yo(o,void 0);return this.renderTokens(l,a,r,t,n)};Ee.prototype.renderTokens=function(t,o,r,n,i){for(var l="",a,s,c,u=0,p=t.length;u<p;++u)c=void 0,a=t[u],s=a[0],s==="#"?c=this.renderSection(a,o,r,n,i):s==="^"?c=this.renderInverted(a,o,r,n,i):s===">"?c=this.renderPartial(a,o,r,i):s==="&"?c=this.escapedValue(a,o,i):s==="name"?c=this.unescapedValue(a,o):s==="text"&&(c=this.rawValue(a)),c&&(Tt(c)?c=c.join("; "):typeof c=="object"&&(c=JSON.stringify(c)),c&&(l+=c));return l};Ee.prototype.renderSection=function(t,o,r,n,i){var l=this,a="",s=o.lookup(t[1]);function c(f){return l.render(f,o,r,i)}if(!!s){if(Tt(s))for(var u=0,p=s.length;u<p;++u)a+=this.renderTokens(t[4],o.push(s[u]),r,n,i);else if(typeof s=="object"||typeof s=="string"||typeof s=="number")a+=this.renderTokens(t[4],o.push(s),r,n,i);else if(jn(s)){if(typeof n!="string")throw new Error("Cannot use higher-order sections without the original template");s=s.call(o.view,n.slice(t[3],t[5]),c),s!=null&&(a+=s)}else a+=this.renderTokens(t[4],o,r,n,i);return a}};Ee.prototype.renderInverted=function(t,o,r,n,i){var l=o.lookup(t[1]);if(!l||Tt(l)&&l.length===0)return this.renderTokens(t[4],o,r,n,i)};Ee.prototype.indentPartial=function(t,o,r){for(var n=o.replace(/[^ \t]/g,""),i=t.split(`
`),l=0;l<i.length;l++)i[l].length&&(l>0||!r)&&(i[l]=n+i[l]);return i.join(`
`)};Ee.prototype.renderPartial=function(t,o,r,n){if(!!r){var i=this.getConfigTags(n),l=jn(r)?r(t[1]):r[t[1]];if(l!=null){var a=t[6],s=t[5],c=t[4],u=l;s==0&&c&&(u=this.indentPartial(l,c,a));var p=this.parse(u,i);return this.renderTokens(p,o,r,u,n)}}};Ee.prototype.unescapedValue=function(t,o){var r=o.lookup(t[1]);if(r)return r};Ee.prototype.escapedValue=function(t,o,r){var n=this.getConfigEscape(r)||Ve.escape,i=o.lookup(t[1]);if(r!=null&&r.escape)return i;if(i!=null&&(Tt(i)?i=i.join("; "):typeof i=="object"?i=JSON.stringify(i):typeof i=="number"&&(i=String(i)),i))return n(i)};Ee.prototype.rawValue=function(t){return t[1]};Ee.prototype.getConfigTags=function(t){return Tt(t)?t:t&&typeof t=="object"?t.tags:void 0};Ee.prototype.getConfigEscape=function(t){if(t&&typeof t=="object"&&!Tt(t))return t.escape};var Ve={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){Vo.templateCache=e},get templateCache(){return Vo.templateCache}},Vo=new Ee;Ve.clearCache=function(){return Vo.clearCache()};Ve.parse=function(t,o){return Vo.parse(t,o)};function oh(e,t,o,r){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+Wm(e)+'" was given as the first argument for mustache#render(template, view, partials)');return Vo.render(e.replace(/{{\s*(.+?)\s*}}/g,"{{$1}}"),t,o,r)}Ve.render=oh;Ve.escape=Hm;Ve.Scanner=Ko;Ve.Context=yo;Ve.Writer=Ee;Ds(Ve);function rh(e){return Tt(e)?e=e.join("; "):typeof e=="object"?e=JSON.stringify(e):e=e.toString(),e}Ve.Formatters=Object.entries(Us).reduce((e,[t,o])=>(e[t]=function(r,...n){try{return o(rh(r),...n)}catch(i){return Ws.MN.error(i),r}},e),{});var Gr=Ve;var se=(e,t)=>{if(!e||Array.isArray(e)&&e.length===0)return;let o=t(e);if(!!o&&!(Array.isArray(o)&&o.length===0))return o},qn=()=>{var e;try{if(self.metadata.lastFetch&&Date.now()-self.metadata.lastFetch<100)self.metadata.lastFetch=Date.now();else{self.metadata.lastFetch=Date.now();let t=(e=(0,vt.getLocalDataByKey)("metadata_profile_doc"))==null?void 0:e[ge.MN.currentDocmd5];if(t===void 0)self.metadata.data=void 0;else{let{pageOffset:o,reference:r}=t.addon,{citeKey:n}=t.additional,i=JSON.parse(t.additional.data||"{}");self.metadata.data={pageOffset:o,citeKey:n,reference:r,metadata:i}}}}catch(t){ge.MN.error(t)}finally{return self.metadata.data}},zn=(e,t)=>{var n;let o=i=>t.includes(i),r=e.note;return{...Bs,titles:o("titles")&&se(r.noteTitle,i=>i.split(/\s*[;；]\s*/)),id:o("id")&&r.noteId,url:o("url")&&{pure:se(r.noteId,i=>`${ge.MN.scheme}://note/`+i),md:se(r.noteId,i=>{var l;return`[${(l=r.noteTitle)!=null?l:"MarginNote"}](${ge.MN.scheme}://note/${i}`}),html:se(r.noteId,i=>{var l;return`<a href="${ge.MN.scheme}://note/${i}" class="MNLink">${(l=r.noteTitle)!=null?l:"MarginNote"}</a>`})},page:o("page.")&&{start:r.startPage,end:r.endPage===r.startPage?void 0:r.endPage,real:o("page.")&&{start:se(r.startPage,i=>{var l,a;return i-Number((a=(l=qn())==null?void 0:l.pageOffset)!=null?a:0)}),end:se(r.endPage,i=>{var l,a;return i===r.startPage?void 0:i-Number((a=(l=qn())==null?void 0:l.pageOffset)!=null?a:0)})}},tags:o("tags")&&e.tags,allTextPic:o("allTextPic")&&{...e.allTextPic,text:e.allText},excerpts:o("excerpts.")&&{...e.excerptsTextPic,text:e.excerptsText},comments:o("comments.")&&{...e.commentsTextPic,text:e.commentsText},time:o("time.")&&{creat:se(r.createDate,rt),modify:se(r.modifiedDate,rt),now:rt(new Date)},date:o("date.")&&{create:se(r.createDate,rt),modify:se(r.modifiedDate,rt),now:rt(new Date)},doc:o("doc.")&&{md5:r.docMd5,title:se(r.docMd5,i=>{var l;return(l=ge.MN.db.getDocumentById(i))==null?void 0:l.docTitle}),url:o("url.")&&{pure:se(r.docMd5&&r.notebookId&&(0,vt.getDocURL)(r.docMd5,r.notebookId,r.startPage),i=>i),md:se(r.docMd5&&r.notebookId&&(0,vt.getDocURL)(r.docMd5,r.notebookId,r.startPage),i=>{var l,a;return`[${r.docMd5&&(a=(l=ge.MN.db.getDocumentById(r.docMd5))==null?void 0:l.docTitle)!=null?a:"MarginNote"}](${ge.MN.scheme}://note/${i}`}),html:se(r.docMd5&&r.notebookId&&(0,vt.getDocURL)(r.docMd5,r.notebookId,r.startPage),i=>{var l,a;return`<a href="${ge.MN.scheme}://note/${i}" class="MNDoc">${r.docMd5&&(a=(l=ge.MN.db.getDocumentById(r.docMd5))==null?void 0:l.docTitle)!=null?a:"MarginNote"}</a>`})},path:se(r.docMd5,i=>{var l;return(l=ge.MN.db.getDocumentById(i))==null?void 0:l.pathFile}),...(n=qn())!=null?n:{}},notebook:o("notebook.")&&{title:se(r.notebookId,i=>{var l;return(l=ge.MN.db.getNotebookById(i))==null?void 0:l.title}),id:r.notebookId,url:o("url.")&&{pure:se(r.notebookId,i=>`${ge.MN.scheme}://notebook/`+i),md:se(r.notebookId,i=>{var l;return`[${(l=se(r.notebookId,a=>{var s;return(s=ge.MN.db.getNotebookById(a))==null?void 0:s.title}))!=null?l:"MarginNote"}](${ge.MN.scheme}://notebook/${i}`}),html:se(r.notebookId,i=>{var l;return`<a href="${ge.MN.scheme}://notebook/${i}" class="MNNotebookUrl">${(l=se(r.notebookId,a=>{var s;return(s=ge.MN.db.getNotebookById(a))==null?void 0:s.title}))!=null?l:"MarginNote"}</a>`})}}}},me=(e,t)=>{if(!/{{.+}}/.test(t))return t;let o=r=>t.includes(r);try{return Gr.render(t,{...zn(e,t),parent:o("parent.")&&se(e.note.parentNote,r=>zn(new vt.NodeNote(r),t)),children:o("children")&&se(e.note.childNotes,r=>r.map(n=>zn(new vt.NodeNote(n),t)))}).trim()}catch(r){return ge.MN.error(r),t}};var Vs=C(S());function Hn(e,t){let o=F(e.replace(/^.*#(\[.+\]).*$/,"$1").replace(/'/g,'"')),r={connectionSymbol:".",maxLevel:999,onlyShowCurrentLayer:!1};if(Array.isArray(o[o.length-1])){let i=o.pop(),[l,a,s]=[i.find(c=>typeof c=="string"),i.find(c=>typeof c=="number"),i.find(c=>typeof c=="boolean")];l!==void 0&&(r.connectionSymbol=l),a!==void 0&&(r.maxLevel=a),s!==void 0&&(r.onlyShowCurrentLayer=s)}let n=o.length;if(n==0||o.some(i=>typeof i!="string"))throw"\u9664\u5F00 option \u5FC5\u987B\u8FD8\u6709\u5143\u7D20\uFF0C\u5E76\u4E14\u90FD\u5FC5\u987B\u662F string";return t.map(i=>{let l=i.length;return r.onlyShowCurrentLayer&&(i=i.slice(-1)),l<=r.maxLevel?i.map((a,s)=>bs(o[s>n-1?n-1:s],a)).join(r.connectionSymbol):""})}function Ks(e,t){e=/^\(.*\)$/.test(e)?e:`(/^.*$/gs, "${pe(e)}")`;let{newSubStr:o,regexp:r}=xe(e)[0];if(/#\[(.+)\]/.test(o))if(t.every(i=>{var l,a,s;return((l=t[0].parentNode)==null?void 0:l.nodeId)===((a=i.parentNode)==null?void 0:a.nodeId)&&((s=i==null?void 0:i.childNodes)==null?void 0:s.length)}))t.forEach(i=>{let{treeIndex:l,descendant:a}=i.descendantNodes,s=Hn(o,l).map(c=>o.replace(/#\[(.+)\]/,c));a.forEach((c,u)=>{var f;let p=(f=c.note.noteTitle)!=null?f:"";s[u]&&(c.title=p.replace(r,me(c,s[u])))})});else{(0,Vs.showHUD)(L.hierarchical_numbering,2);return}else if(/%\[(.+)\]/.test(o)){let n=ot(o,t.length).map(i=>o.replace(/%\[(.+)\]/,i));t.forEach((i,l)=>{var s;let a=(s=i.note.noteTitle)!=null?s:"";n[l]&&(i.title=a.replace(r,me(i,n[l])))})}else t.forEach(n=>{var l;let i=(l=n.note.noteTitle)!=null?l:"";n.title=i.replace(r,me(n,o))})}var js={name:"MagicAction for Card",key:"magicaction4card",intro:L.intro,link:x("magicaction4card"),settings:[{key:"smartSelection",type:1,label:L.smart_selection.label,help:L.smart_selection.help},{key:"defaultMergeText",type:4,help:L.default_merge_text.help,link:L.default_merge_text.link,check({input:e}){if(We(e),!e.includes("$&"))throw L.default_merge_text.error}}],actions4card:[{key:"manageProfile",type:2,label:L.manage_profile.label,option:L.manage_profile.$option4,help:L.manage_profile.help,method:()=>{}},{type:3,label:L.filter_cards.label,option:L.filter_cards.$option5,key:"filterCard",method({nodes:e,content:t,option:o}){if(!t)return(0,ie.showHUD)(L.none_card),[];let r=Ut(t),n=e.filter(i=>{var s;let l=(s=i.title)!=null?s:"",a=(()=>{switch(o){case 1:return l;case 4:return i.tags.join(" ");case 2:return i.excerptsText.join(`

`);case 3:return i.commentsText.join(`

`);default:return`${l}
${i.allText}`}})();return r.some(c=>c.every(u=>u.test(a)))});return n.length?(ie.HUDController.show(L.is_selected),n):((0,ie.showHUD)(L.none_card),[])},check({input:e}){Rn(e)}},{type:2,label:L.merge_cards.label,key:"mergeCard",option:L.merge_cards.$option2,method({option:e,nodes:t}){if(t.length==1)return;let{node:o}=t.slice(1).reduce((n,i)=>{let l=i.ancestorNodes.length;return l<n.level?{level:l,node:i}:n},{level:t[0].ancestorNodes.length,node:t[0]}),r=o.titles;(0,ie.undoGroupingWithRefresh)(()=>{for(let i of t)i!==o&&(r.push(...i.titles),o.note.merge(i.note));let n=o.note.comments.length;o.note.comments.reverse().forEach((i,l)=>{i.type=="TextNote"&&r.includes(i.text)&&o.note.removeCommentByIndex(n-l-1)}),e==0&&(o.titles=r),o.tidyupTags()})}},{type:3,label:L.rename_title.label,key:"renameTitle",help:L.rename_title.help,method({content:e,nodes:t}){(0,ie.undoGroupingWithRefresh)(()=>{Ks(e,t)})},check({input:e}){e=/^\(.+\)$/.test(e)?e:`(/^.*$/gs, "${pe(e)}")`;let{regexp:t,newSubStr:o}=xe(e)[0];"test".replace(t,o),/%\[.+\]/.test(o)&&ot(o,1),/#\[.+\]/.test(o)&&Hn(o,[[1,1,1]])}},{type:2,label:L.merge_text.label,key:"mergeText",option:L.merge_text.$option2,help:L.merge_text.help,method:({option:e,nodes:t})=>{let{defaultMergeText:o}=self.globalProfile.magicaction4card,[r,n]=F(`${pe(o)}`,!0).split("$&");(0,ie.undoGroupingWithRefresh)(()=>{for(let i of t){let l=(a=>{if(/%\[.+\]/.test(r)){let s=ot(r,a.length);return a.map((c,u)=>r.replace(/%\[(.+)\]/,s[u])+c).join(n)}return a.map(s=>r+s).join(n)})(i.excerptsCommentsText);i.removeCommentButLinkTag(a=>{var s,c;return a.type==="PaintNote"||a.type==="HtmlNote"||!!(a.type==="LinkNote"&&!i.isOCR&&((c=(s=ie.MN.db.getNoteById(a.noteid))==null?void 0:s.excerptPic)==null?void 0:c.paint))},async a=>{var s,c;switch(e){case 0:if(((s=a.note.excerptPic)==null?void 0:s.paint)&&a.isOCR===!1){let{index:u}=await(0,ie.select)(L.merge_text.$excerpt_pic_option2,L.merge_text.label,L.merge_text.is_excerpt_pic);if(u){self.globalProfile.addon.useMarkdown?a.appendMarkdownComments((0,ie.removeHighlight)(l)):a.appendTextComments((0,ie.removeHighlight)(l));return}}a.mainExcerptText=l;break;case 1:if(a.isOCR&&a.mainExcerptText){let{index:u}=await(0,ie.select)(L.merge_text.$excerpt_pic_text_option2,L.merge_text.label,L.merge_text.is_excerpt_pic_text);if(u){a.mainExcerptText=l;return}}(c=a.note.excerptPic)!=null&&c.paint||(a.mainExcerptText=""),self.globalProfile.addon.useMarkdown?a.appendMarkdownComments((0,ie.removeHighlight)(l)):a.appendTextComments((0,ie.removeHighlight)(l))}})}})}},{key:"switchTitle",type:2,label:L.switch_title.label,option:L.switch_title.$option2,help:L.switch_title.help,method:async({nodes:e,option:t})=>{if(t===0)(0,ie.undoGroupingWithRefresh)(()=>{var o,r;for(let n of e){let i=n.title,l=(0,ie.removeHighlight)(n.mainExcerptText);((o=n.note.excerptPic)==null?void 0:o.paint)&&!n.note.textFirst||(l===i?n.title="":i&&!l?(n.title="",n.mainExcerptText=i):l&&!i&&(n.title=l,(r=n.note.excerptPic)!=null&&r.paint?n.mainExcerptText=l:n.mainExcerptText=""))}});else{let o=e.map(n=>[n.title,(0,ie.removeHighlight)(n.mainExcerptText)]),r=o.find(([n,i])=>n&&i)?(await(0,ie.select)(L.switch_title.$both_option3,L.switch_title.swap_title_excerpt,L.switch_title.swap_help)).index:0;(0,ie.undoGroupingWithRefresh)(()=>{e.forEach((n,i)=>{var s,c,u;let[l,a]=o[i];if(!(((s=n.note.excerptPic)==null?void 0:s.paint)&&!n.note.textFirst))if(a===l)n.title="";else if(l&&!a)n.title="",n.mainExcerptText=l;else if(a&&!l)n.title=a,(c=n.note.excerptPic)!=null&&c.paint?n.mainExcerptText=a:n.mainExcerptText="";else switch(r){case 0:n.title=a,n.mainExcerptText=l;break;case 1:n.title=a,(u=n.note.excerptPic)!=null&&u.paint||(n.mainExcerptText="");break;case 2:n.title="",n.mainExcerptText=l}})})}}}]};var qs=C(S()),Ke=(0,qs.i18n)({zh:{intro:"\u6240\u6709\u52A8\u4F5C\u5747\u9700\u8981\u5728\u6587\u6863\u4E2D\u9009\u4E2D\u6587\u5B57\u6216\u6846\u9009\u9009\u533A\u3002\u52A8\u4F5C\u6765\u81EA\u4E8E\u5404\u4E2A\u6A21\u5757\uFF0C\u9700\u8981\u542F\u7528\u5BF9\u5E94\u7684\u6A21\u5757\u3002\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u7684\u4F7F\u7528\u65B9\u6CD5\u548C\u6CE8\u610F\u4E8B\u9879\u3002",pre_OCR:{label:"\u9884\u5148 OCR",help:"\u3010\u4EC5\u5F53\u524D\u6587\u6863\u3011\u4F7F\u7528 AutoOCR \u8FDB\u884C\u8F6C\u6587\u5B57\u6216\u77EB\u6B63\uFF0C\u8BF7\u786E\u4FDD\u4F60\u5DF2\u7ECF\u586B\u5165 OCR \u5BC6\u94A5\u3002"},pre_simplify:{label:"\u9884\u5148\u8F6C\u4E3A\u7B80\u4F53\u4E2D\u6587",help:"\u3010\u4EC5\u5F53\u524D\u6587\u6863\u3011\u4F7F\u7528 AutoSimplify \u8FDB\u884C\u7E41\u7B80\u8F6C\u6362\u3002"},pre_format:{label:"\u9884\u5148\u683C\u5F0F\u5316",help:"\u3010\u4EC5\u5F53\u524D\u6587\u6863\u3011\u4F7F\u7528 AutoFormat \u8FDB\u884C\u683C\u5F0F\u5316\u6392\u7248\u3002"},show_copy_content:{label:"\u663E\u793A\u590D\u5236\u7684\u5185\u5BB9"},copy_text:"\u590D\u5236\u9009\u4E2D\u6587\u5B57",note_options:{$option6:["\u590D\u5236","\u8BBE\u7F6E\u4E3A\u6807\u9898","\u5408\u5E76\u6807\u9898","\u5408\u5E76\u5230\u6458\u5F55","\u6DFB\u52A0\u4E3A\u6458\u5F55","\u6DFB\u52A0\u4E3A\u8BC4\u8BBA"],label:"\u5F39\u51FA\u66F4\u591A\u9009\u9879",help:"\u5982\u679C\u9009\u4E2D\u8FD9\u6BB5\u6587\u5B57\u4E4B\u524D\uFF0C\u4F60\u5DF2\u7ECF\u9009\u4E2D\u4E86\u4E00\u4E2A\u6458\u5F55\u3002\u6B64\u65F6\u6267\u884C\u67D0\u4E9B\u4F1A\u5C06\u7ED3\u679C\u590D\u5236\u5230\u526A\u8D34\u677F\u7684\u52A8\u4F5C\u65F6\u4F1A\u5F39\u51FA\u66F4\u591A\u9009\u9879\uFF0C\u65B9\u4FBF\u76F4\u63A5\u5199\u5165\u5361\u7247\u4E2D\u3002"}},en:{intro:"All actions require text to be selected or a selection area to be selected. Actions come from various modules and require the corresponding module to be enabled. Click to view specific usage and precautions.",copy_text:"Copy Selected Text",pre_OCR:{label:"Pre OCR",help:"[Only Current Document] Use AutoOCR to OCR. Please make sure you have filled in the OCR key."},pre_simplify:{label:"Pre Simplify",help:"[Only Current Document] Use AutoSimplify to convert to Simplified Chinese."},pre_format:{label:"Pre Format",help:"[Only Current Document] Use AutoFormat to format the text."},show_copy_content:{label:"Show Content of Copied"},note_options:{$option6:["Copy","Set as Title","Merge Title","Merge to Note","Add as Note","Add as Comment"],label:"Popup More Options",help:"If you have selected a note before selecting this text or area, some action which copied result will pop up more options to write directly into the card."}}});var zs={name:"MagicAction for Text",key:"magicaction4text",link:x("magicaction4text"),intro:Ke.intro,settings:[{key:"preOCR",type:1,label:Ke.pre_OCR.label,help:Ke.pre_OCR.help,bind:["quickSwitch",12]},{key:"preSimplify",type:1,label:Ke.pre_simplify.label,help:Ke.pre_simplify.help,bind:["quickSwitch",15]},{key:"preFormat",type:1,label:Ke.pre_format.label,help:Ke.pre_format.help,bind:["quickSwitch",5]},{key:"showCopyContent",type:1,label:Ke.show_copy_content.label},{key:"noteOptions",type:7,label:Ke.note_options.label,help:Ke.note_options.help,option:Ke.note_options.$option6}],actions4text:[{type:2,key:"copyText",label:Ke.copy_text,method({text:e}){return e}}]};var Hs=C(S());var ye=(0,Hs.i18n)({zh:{intro:`\u5C06\u6458\u5F55\u62C6\u5206\u4E3A\u6807\u9898\uFF08\u88AB\u5B9A\u4E49\u9879\uFF09\u548C\u6458\u5F55\uFF08\u5B9A\u4E49\u9879\uFF09\u4E24\u90E8\u5206\u3002
\u5B9A\u4E49 = \u88AB\u5B9A\u4E49\u9879 + \u5B9A\u4E49\u8054\u9879 + \u5B9A\u4E49\u9879\u3002   `,on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",to_title_link:"\u522B\u540D\u8F6C\u4E3A\u591A\u4E2A\u6807\u9898",preset:{label:"\u9009\u62E9\u9700\u8981\u7684\u9884\u8BBE",$option9:["\u81EA\u5B9A\u4E49\u63D0\u53D6\u6807\u9898","\u81EA\u5B9A\u4E49\u5B9A\u4E49\u8054\u9879","xxx : yyy","xxx \u2014\u2014 yyy","xxx \uFF0C\u662F(\u6307) yyy","xxx \u662F(\u6307)\uFF0Cyyy","xxx \u662F\u6307 yyy","yyy\uFF0C___\u79F0(\u4E4B)\u4E3A xxx","yyy(\u88AB)\u79F0(\u4E4B)\u4E3A xxx"]},title_link_split:{label:"\u9009\u62E9\u522B\u540D\u5206\u8BCD",$option3:["\u81EA\u5B9A\u4E49","\u9ED8\u8BA4","\u6807\u70B9\u7B26\u53F7"]},extract_title:{label:"\u63D0\u53D6\u6807\u9898",$option2:["\u4F7F\u7528 AutoDef \u4E2D\u7684\u8BBE\u7F6E","\u786E\u5B9A"]},split_excerpt:{label:"\u62C6\u5206\u6458\u5F55",$option2:["\u4F7F\u7528 AutoDef \u4E2D\u7684\u8BBE\u7F6E","\u786E\u5B9A"],help:"\u5C06\u6458\u5F55\u62C6\u5206\u4E3A\u6807\u9898\uFF08\u88AB\u5B9A\u4E49\u9879\uFF09\u548C\u6458\u5F55\uFF08\u5B9A\u4E49\u9879\uFF09\u4E24\u90E8\u5206\u3002"},custom_title_split:{link:x("anotherautodef","\u81EA\u5B9A\u4E49\u522B\u540D\u5206\u8BCD"),help:"\u81EA\u5B9A\u4E49\u522B\u540D\u5206\u8BCD\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u683C\u5F0F\u3002"},custom_def_link:{link:x("anotherautodef","\u81EA\u5B9A\u4E49\u5B9A\u4E49\u8054\u9879"),help:"\u81EA\u5B9A\u4E49\u5B9A\u4E49\u8054\u9879\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u683C\u5F0F\u3002"},custom_extract_title:{link:x("anotherautodef","\u81EA\u5B9A\u4E49\u63D0\u53D6\u6807\u9898"),help:"\u81EA\u5B9A\u4E49\u63D0\u53D6\u6807\u9898\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u683C\u5F0F\u3002"}},en:{intro:`Split the excerpt into two parts: title (definiendum) and excerpt (definiens).
Definition = Definiendum + Connective + Definiens.                                          `,on:"Auto Run When Excerpting",to_title_link:"Convert Alias To Muilt Titles",title_link_split:{$option3:["Custom","Default","Punctuation"],label:"Select Alias Separator"},preset:{$option9:["Custom Titles Extraction","Custom Definition Connective","xxx : yyy","xxx \u2014\u2014 yyy","xxx \uFF0C\u662F(\u6307) yyy","xxx \u662F(\u6307)\uFF0Cyyy","xxx \u662F\u6307 yyy","yyy\uFF0C___\u79F0(\u4E4B)\u4E3A xxx","yyy(\u88AB)\u79F0(\u4E4B)\u4E3A xxx"],label:"Select Presets"},extract_title:{label:"Extract Title",$option2:["Use AutoDef Settings","Confirm"]},split_excerpt:{label:"Split Excerpt Text",$option2:["Use AutoDef Settings","Confirm"],help:"Split the excerpt into title (definiendum) and excerpt (definiens) parts."},custom_title_split:{link:x("anotherautodef","custom-alias-separator"),help:"Customize alias separator, click for specific format."},custom_def_link:{link:x("anotherautodef","custom-definition-connective"),help:"Customize definition connective, click for the specific format."},custom_extract_title:{link:x("anotherautodef","custom-titles-extraction"),help:"Customize titles extraction, click for specific format."}}});function Wr(e){if(!self.globalProfile.anotherautodef.toTitleLink)return[e];let t=[],{titleLinkSplit:o}=self.globalProfile.anotherautodef,{customTitleSplit:r}=self.tempProfile.regArray;o.includes(0)&&r&&t.push(...r),o.includes(1)&&t.push([/或者?|[简又]?称(?:之?为)?/g]),o.includes(2)&&t.push([/[、。,，‘’“”"『』()（）【】「」《》«»\/\[\]]/g]);let n=t.reduce((i,l)=>{if(!l.length)return i;let a=l[0],s=e.match(a);return s&&l.slice(1).every(c=>c.test(s[0]))?i.replace(wt.add(a,"g"),"orogxng"):i},e).split("orogxng").reduce((i,l)=>(l=l.trim(),l&&i.push(l),i),[]);return n.length>1?_t(n):[e]}function Jn(e,t,o){if(!t)return;let{preset:r}=self.globalProfile.anotherautodef;if(o===void 0&&r.includes(0)&&(o=self.tempProfile.replaceParam.customExtractTitle),!(o!=null&&o.length))return;let n=o.reduce((i,l)=>{let{newSubStr:a}=l,{regexp:s}=l;return s=wt.add(s,"g"),s.test(t)&&i.push(...t.match(s).map(c=>c.replace(s,me(e,a)))),i},[]);if(n.length)return{title:_t(n.map(i=>Wr(i)).flat()),text:t}}function nh(e,t){if(!!e){if(t===void 0){let{customDefLink:o}=self.tempProfile.regArray;t=o}if(!!(t!=null&&t.length))for(let o of t){if(!o.length)continue;let r=!1,n=o[0];n.sticky&&(n=wt.remove(n,"y"),r=!0);let i=e.match(n);if((i==null?void 0:i.length)&&o.slice(1).every(l=>l.test(i[0]))){let[l,a]=e.split(n).filter(s=>s);return r&&([l,a]=[a,l]),{title:Wr(l),text:a}}}}}function Xn(e,t){if(!e)return;let{preset:o}=self.globalProfile.anotherautodef;for(let r of o)switch(r){case 1:{let n=nh(e,t);if(n)return n;break}case 2:case 3:case 4:case 5:case 6:{let n=[/[：:]/,/[一—]{2}/,/[,，]\s*(?:通常|一般)*是指?/,/(?:通常|一般)*是指?\s*[,，]/,/(?:通常|一般)*是指/][r-2];if(n.test(e)){let[i,l]=e.split(n);return{title:Wr(i),text:l}}break}case 7:case 8:{let n=[/[,，].*称之?为/,/(?:通常|一般)?被?称之?为/][r-7];if(n.test(e)){let[i,l]=e.split(n);return{title:Wr(l),text:i}}break}}}var Js=C(S()),Xs={name:"Another AutoDef",key:"anotherautodef",intro:ye.intro,link:x("anotherautotitle"),settings:[{key:"on",type:1,label:ye.on,auto:{generateTitles({node:e,text:t}){let o=Jn(e,t);if(o!=null&&o.title.length)return o;let r=Xn(t);if(r!=null&&r.title.length)return r}}},{key:"preset",type:7,option:ye.preset.$option9,label:ye.preset.label},{key:"customExtractTitle",type:4,help:ye.custom_extract_title.help,link:ye.custom_extract_title.link,bind:["preset",0],check({input:e}){st(e)}},{key:"customDefLink",type:4,help:ye.custom_def_link.help,link:ye.custom_def_link.link,bind:["preset",1],check({input:e}){Uo(e)}},{key:"toTitleLink",type:1,label:ye.to_title_link,bind:["preset",[0,1,2,3,4,5,6,7,8]]},{type:7,key:"titleLinkSplit",label:ye.title_link_split.label,option:ye.title_link_split.$option3,bind:[["toTitleLink",!0],["preset",[0,1,2,3,4,5,6,7,8]]]},{key:"customTitleSplit",type:4,help:ye.custom_title_split.help,link:ye.custom_title_split.link,bind:[["toTitleLink",!0],["titleLinkSplit",0],["preset",[0,1,2,3,4,5,6,7,8]]],check({input:e}){Uo(e)}}],actions4card:[{type:3,label:ye.extract_title.label,option:ye.extract_title.$option2,key:"extractTitle",method:({nodes:e,content:t,option:o})=>{let r;if(o!=0)if(t)r=xe(t);else return;(0,Js.undoGroupingWithRefresh)(()=>{e.forEach(n=>{if(!n.note.excerptPic||n.isOCR){let i=[];n.notes.forEach(l=>{let a=l.excerptText;if(a){let s=Jn(n,a,r);s!=null&&s.title.length&&i.push(...s.title)}}),n.appendTitles(...i)}})})},check({input:e}){Ct(e)}},{type:3,label:ye.split_excerpt.label,key:"splitExcerpt",option:ye.split_excerpt.$option2,help:ye.split_excerpt.help,method:({nodes:e,content:t,option:o})=>{let r;if(o!=0)if(t)r=Ut(t);else return;e.forEach(n=>{var i;if(!((i=n.note.excerptPic)!=null&&i.paint)||n.isOCR){let l=[];n.notes.forEach(a=>{let s=a.excerptText;if(s){let c=Xn(s,r);c!=null&&c.title.length&&(l.push(...c.title),n.mainExcerptText=c.text)}}),n.titles=l}})}}]};var Ys=C(S());var Zs=C(S());var it=(0,Zs.i18n)({zh:{intro:"\u81EA\u52A8\u5C06\u6458\u5F55\u8F6C\u4E3A\u6807\u9898\u3002",on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",preset:{label:"\u9009\u62E9\u9700\u8981\u7684\u9884\u8BBE",$option3:["\u81EA\u5B9A\u4E49","\u5B57\u6570","\u4E0D\u542B\u6709\u70B9\u53F7"]},word_count:{help:"[\u7C7B\u4E2D\u6587\u5B57\u6570, \u7C7B\u82F1\u6587\u5355\u8BCD\u6570]\uFF0C\u6CA1\u8D85\u8FC7\u5C31\u81EA\u52A8\u8BBE\u7F6E\u4E3A\u6807\u9898\u3002",enter_positive:"\u8BF7\u8F93\u5165\u6B63\u6574\u6570",input_array:"\u8BF7\u8F93\u5165\u6570\u7EC4\uFF0C\u6BD4\u5982 [10,5]",input_three_number:"\u6570\u7EC4\u5185\u5FC5\u987B\u6709\u4E24\u4E2A\u6570\u5B57\uFF0C\u6BD4\u5982 [10,5]"},custom_be_title:{help:"\u81EA\u5B9A\u4E49\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u683C\u5F0F\u3002",link:x("anotherautotitle","\u81EA\u5B9A\u4E49")}},en:{intro:"Automatically convert the excerpt to the title.",on:"Auto Run When Excerpting",preset:{label:"Select Presets",$option3:["Custom","Word Count","Not Contain Dot Symbols"]},word_count:{help:"[Chinese words, English words], if not exceeded, then set the excerpt text as the title",enter_positive:"Please enter a positive integer",input_array:"Please enter an array, for example [10,5]",input_three_number:"There must be two numbers in the array\uFF0Cfor example [10,5]"},custom_be_title:{help:"Customize. Click for specific formats",link:x("anotherautotitle","custom")}}});function ih(e){let{preset:t,wordCount:o}=self.globalProfile.anotherautotitle;self.excerptStatus.isModify&&(e=(0,Ys.removeHighlight)(e));let r=(()=>{for(let n of t)switch(n){case 0:let{customBeTitle:i}=self.tempProfile.regArray;if(!i)continue;if(i.some(c=>c.every(u=>u.test(e))))return e;break;case 1:if(!o)continue;let[l,a]=F(o);if(Ft(e)<=(ct(e)?a:l))return e;break;case 2:if(!/[。.、？?！!，,；;：:]/.test(e))return e}})();if(r)return{title:[r],text:""}}var Qs={name:"Another AutoTitle",key:"anotherautotitle",intro:it.intro,link:x("anotherautotitle"),settings:[{key:"on",type:1,label:it.on,auto:{generateTitles:{index:999,method({text:e}){return ih(e)}}}},{key:"preset",type:7,option:it.preset.$option3,label:it.preset.label},{key:"customBeTitle",type:4,help:it.custom_be_title.help,bind:["preset",0],link:it.custom_be_title.link,check({input:e}){Uo(e)}},{key:"wordCount",type:4,bind:["preset",1],help:it.word_count.help,check({input:e}){if(e=F(e),!Array.isArray(e))throw it.word_count.input_array;if(e.length!==2)throw it.word_count.input_three_number;if(e.some(t=>!Number.isInteger(t)))throw it.word_count.enter_positive}}]};var oc=C(S());var ec=C(S());var Pt=(0,ec.i18n)({zh:{intro:"\u81EA\u52A8\u4ECE\u6458\u5F55\u4E2D\u63D0\u53D6\u8BC4\u8BBA\u6216\u8005\u5728\u7279\u5B9A\u65F6\u5019\u81EA\u52A8\u6DFB\u52A0\u8BC4\u8BBA\u3002",on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",preset:{label:"\u9009\u62E9\u9700\u8981\u7684\u9884\u8BBE",$option:["\u81EA\u5B9A\u4E49"]},add_comment:{label:"\u6DFB\u52A0\u8BC4\u8BBA",$option2:["\u4F7F\u7528 AutoComment \u7684\u8BBE\u7F6E","\u786E\u5B9A"]},custom_comment:{help:"\u81EA\u5B9A\u4E49\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u683C\u5F0F\u3002",link:x("autocomment")}},en:{intro:"Automatically extract comments from excerpts or add comments at a specific time.",on:"Auto Run When Excerpting",preset:{label:"Select Presets",$option:["Custom"]},add_comment:{$option2:["Use AutoComment Settings","Confirm"],label:"Add Comment"},custom_comment:{help:"Customize. Click for specific formats.",link:x("autocomment")}}});function tc(e,t){if(!t)return;let{preset:o}=self.globalProfile.autocomment,{customComment:r}=self.tempProfile.replaceParam,n=[];return o.includes(0)&&(r==null?void 0:r.length)&&r.forEach(({newSubStr:i,regexp:l})=>{l=wt.add(l,"g"),l.test(t)&&n.push(...t.match(l).map(a=>a.replace(l,me(e,i))))}),n}var rc={name:"AutoComment",key:"autocomment",intro:Pt.intro,link:x("autocomment"),settings:[{key:"on",type:1,label:Pt.on,auto:{generateComments({node:e,text:t}){return tc(e,t)}}},{key:"preset",type:7,option:Pt.preset.$option,label:Pt.preset.label},{key:"customComment",type:4,help:Pt.custom_comment.help,bind:["preset",0],link:Pt.custom_comment.link,check({input:e}){st(e)}}],actions4card:[{type:3,label:Pt.add_comment.label,key:"addComment",option:Pt.add_comment.$option2,method({nodes:e,option:t,content:o}){(0,oc.undoGroupingWithRefresh)(()=>{if(t==0)e.forEach(r=>{var l;let n=r.excerptsText.join(`
`);((l=r.note.excerptPic)==null?void 0:l.paint)&&r.isOCR===!1&&(n="@picture");let i=tc(r,n);i!=null&&i.length&&(self.globalProfile.addon.useMarkdown?r.appendMarkdownComments(...i):r.appendTextComments(...i))});else if(o)if(/^\(.+\)$/.test(o)){let r=xe(o);e.forEach(n=>{var a;let i=n.excerptsText.join(`
`);((a=n.note.excerptPic)==null?void 0:a.paint)&&n.isOCR===!1&&(i="@picture");let l=Bo(i,r.map(s=>({...s,newSubStr:me(n,s.newSubStr)})));self.globalProfile.addon.useMarkdown?n.appendMarkdownComments(...l):n.appendTextComments(...l)})}else e.forEach(r=>{self.globalProfile.addon.useMarkdown?r.appendMarkdownComments(me(r,F(`${pe(o)}`,!0))):r.appendTextComments(me(r,F(`${pe(o)}`,!0)))})})},check({input:e}){/^\(.+\)$/.test(e)?Ct(e):We(e)}}]};var lo=C(S());var nc=C(S());var K=(0,nc.i18n)({zh:{intro:"\u8865\u5168\u5355\u8BCD\u8BCD\u5F62\uFF0C\u53EA\u652F\u6301\u52A8\u8BCD\u548C\u540D\u8BCD\u3002\u987A\u4FBF\u63D0\u4F9B\u8BCD\u4E49\u8865\u5145\u548C\u4E0A\u4E0B\u6587\u6458\u5F55\u3002",on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",loading:"\u6B63\u5728\u5236\u5361...",custom:"\u81EA\u5B9A\u4E49",complete_word:{label:"\u8865\u5168\u5355\u8BCD\u8BCD\u5F62"},select_meaning:{label:"\u52A8\u6001\u9009\u62E9\u91CA\u4E49",$option2:["\u4E2D\u6587","\u82F1\u6587"]},maybe_other_word:"\u68C0\u6D4B\u5230\u5F53\u524D\u5355\u8BCD\u65E2\u53EF\u80FD\u662F\u5176\u4ED6\u5355\u8BCD\u7684\u53D8\u5F62\uFF0C\u4E5F\u53EF\u80FD\u5C31\u662F\u539F\u5F62\uFF0C\u8BF7\u9009\u62E9\u5355\u8BCD\u539F\u5F62",select_lemma:"\u52A8\u6001\u9009\u62E9\u5355\u8BCD\u539F\u5F62",gen_word_card:{label:"\u82F1\u6587\u5355\u8BCD\u5236\u5361",$option2:["\u8FFD\u52A0","\u66FF\u6362"]},custom_fill:"\u81EA\u5B9A\u4E49\u5355\u8BCD\u586B\u5145\u4FE1\u606F\uFF08\u4E8C\uFF09",custom_fill_front:{help:"\u81EA\u5B9A\u4E49\u5355\u8BCD\u586B\u5145\u4FE1\u606F\uFF08\u4E00\uFF09\uFF0C\u70B9\u51FB\u67E5\u770B\u652F\u6301\u53D8\u91CF\uFF0C\u5F53\u524D\u8F93\u5165\u680F\u4E0D\u5141\u8BB8\u4F7F\u7528 {{zh}} \u548C {{en}}\u3002",link:x("autocomplete"),error:"\u5F53\u524D\u8F93\u5165\u680F\u4E0D\u5141\u8BB8\u4F7F\u7528 {{zh}} \u6216 {{en}}"},auto_context:{help:"\u76EE\u524D\u4E0D\u652F\u6301 OCR Pro\uFF0C\u5FC5\u987B PDF \u81EA\u5E26\u6587\u5B57\u5C42\u3002     ",label:"\u81EA\u52A8\u6458\u5F55\u4E0A\u4E0B\u6587"},collins:{label:"\u67EF\u6797\u65AF\u661F\u7EA7\u7B5B\u9009",$option6:["\u65E0","\u2B50","\u2B50\u2B50","\u2B50\u2B50\u2B50","\u2B50\u2B50\u2B50\u2B50","\u2B50\u2B50\u2B50\u2B50\u2B50"],help:"\u661F\u8D8A\u591A\u4EE3\u8868\u8D8A\u5E38\u7528\uFF0C\u4F46\u4E5F\u8D8A\u7B80\u5355\uFF0C\u6CA1\u6709\u9009\u4E2D\u7684\u661F\u7EA7\u5355\u8BCD\u4F1A\u88AB\u6392\u9664\uFF0C\u4E0D\u4F1A\u89E6\u53D1\u3002"},fill_word_info:{label:"\u586B\u5145\u5355\u8BCD\u4FE1\u606F",$option3:["\u4E0D\u586B\u5145","\u81EA\u5B9A\u4E49","\u4E2D\u6587\u91CA\u4E49"]},data_source:{label:"\u6570\u636E\u6765\u6E90",$option2:["\u5728\u7EBF API","\u672C\u5730\u6570\u636E\u5E93"],help:"\u5728\u56FD\u5916\u7684\u7528\u6237\u8BF7\u9009\u62E9\u672C\u5730\u6570\u636E\u5E93\u3002\u53EF\u4EE5\u5728 OhMyMN \u7684 QQ \u9891\u9053\u4E2D\u4E0B\u8F7D\u3002"},not_find_word:"\u67E5\u8BE2\u4E0D\u5230\u8BE5\u5355\u8BCD",forbid:"\u4E3A\u51CF\u5C0F\u670D\u52A1\u5668\u538B\u529B\uFF0C\u7981\u6B62\u540C\u65F6\u5904\u7406\u8D85\u8FC7 5 \u5F20\u5361\u7247\u3002\u5982\u679C\u9700\u8981\u5927\u91CF\u5236\u5361\uFF0C\u8BF7\u4F7F\u7528\u672C\u5730\u6570\u636E\u5E93\u3002",choose_meaning:"\u9009\u62E9\u5728\u6587\u4E2D\u7684\u91CA\u4E49",not_find_db:{message:"\u6CA1\u6709\u627E\u5230 AutoComplete \u6570\u636E\u5E93\u3002\u8BF7\u4E0B\u8F7D\u5E76\u5BFC\u5165\u540D\u4E3A AutoCompleteData.zip \u6216\u8005 AutoCompleteData.online.zip \u7684\u6587\u4EF6\u3002",$options2:["\u7ACB\u5373\u4E0B\u8F7D","\u5BFC\u5165\u6570\u636E\u5E93"],wrong_file:"\u6587\u4EF6\u4E0D\u7B26\u5408\u8981\u6C42\uFF0C\u8BF7\u4E0D\u8981\u5BFC\u5165\u9519\u8BEF\u6587\u4EF6\u6216\u8005\u4FEE\u6539\u6587\u4EF6\u540D!",wait:"\u6B63\u5728\u5BFC\u5165\u6570\u636E\u5E93\uFF0C\u8BF7\u7A0D\u540E..."}},en:{intro:"Complete word form. Only support verbs and nouns.",on:"Auto Run When Excerpting",custom_fill:"Custom excerption filling template, click for support variables",custom_fill_front:{help:"Custom excerption filling template, click for support variables.",link:x("autocomplete"),error:"The input bar is not allowed to use {{zh}} or {{en}}"},custom:"Custom",complete_word:{label:"Complete Word Form"},loading:"Loading...",select_lemma:"Dynamic Basic Form Selection",maybe_other_word:"The word may be the basic form or the inflected form, choose you want.",select_meaning:{label:"Dynamic Interpretation Selection",$option2:["Chinese","English"]},gen_word_card:{label:"Generate Word Card",$option2:["Append","Replace"]},auto_context:{label:"Auto Excert Context",help:"Currently not support OCR Pro, only PDF with text layer."},collins:{label:"Collins Star Filtering",$option6:["None","\u2B50","\u2B50\u2B50","\u2B50\u2B50\u2B50","\u2B50\u2B50\u2B50\u2B50","\u2B50\u2B50\u2B50\u2B50\u2B50"],help:"The more stars, the more common, but also the simpler, the words without the selected star level will be excluded, and will not trigger."},fill_word_info:{label:"Fill in Word Info",$option3:["Not Fill","Custom","Chinese Meaning"]},data_source:{label:"Data Source",$option2:["Online API","Local Database"],help:"For users outside of China, please choose local database. You can download it in Github Release."},not_find_word:"No matching words found",forbid:"To reduce server pressure, it is forbidden to process more than 5 cards at the same time. If you need to make a lot of word cards, please use the local database.",choose_meaning:"Select the meanings in the text.",not_find_db:{message:"AutoComplete database not found. Please download and import the file named AutoCompleteData.zip or AutoCompleteData.online.zip .",$options2:["Download Now","Import Database"],wrong_file:"The file does not meet the requirements. Please do not import the wrong file or modify the file name!",wait:"Importing database, please wait..."}}});var z=C(S());var lc=C(S());var Q="\u2E80-\u2EFF\u2F00-\u2FDF\u3040-\u309F\u30A0-\u30FA\u30FC-\u30FF\u3100-\u312F\u3200-\u32FF\u3400-\u4DBF\u4E00-\u9FFF\uF900-\uFAFF",lh=new RegExp(`([${Q}])[ ]*([\\:]+|\\.)[ ]*([${Q}])`,"g"),ah=new RegExp(`([${Q}])[ ]*([~\\!;,\\?]+)[ ]*`,"g"),sh=new RegExp(`([\\.]{2,}|\u2026)([${Q}])`,"g"),ch=new RegExp(`([${Q}])\\:([A-Z0-9\\(\\)])`,"g"),uh=new RegExp(`([${Q}])([\`"\u05F4])`,"g"),ph=new RegExp(`([\`"\u05F4])([${Q}])`,"g"),fh=/([`"\u05f4]+)[ ]*(.+?)[ ]*([`"\u05f4]+)/g,dh=new RegExp(`([${Q}])('[^s])`,"g"),mh=new RegExp(`(')([${Q}])`,"g"),hh=new RegExp(`([A-Za-z0-9${Q}])( )('s)`,"g"),gh=new RegExp(`([${Q}])(#)([${Q}]+)(#)([${Q}])`,"g"),yh=new RegExp(`([${Q}])(#([^ ]))`,"g"),bh=new RegExp(`(([^ ])#)([${Q}])`,"g"),xh=new RegExp(`([${Q}])([\\+\\-\\*\\/=&\\|<>])([A-Za-z0-9])`,"g"),wh=new RegExp(`([A-Za-z0-9])([\\+\\-\\*\\/=&\\|<>])([${Q}])`,"g"),_h=/([/]) ([a-z\-_\./]+)/g,Ch=/([/\.])([A-Za-z\-_\./]+) ([/])/g,Sh=new RegExp(`([${Q}])([\\(\\[\\{<>\u201C])`,"g"),kh=new RegExp(`([\\)\\]\\}<>\u201D])([${Q}])`,"g"),Th=/([\(\[\{<\u201c]+)[ ]*(.+?)[ ]*([\)\]\}>\u201d]+)/,vh=new RegExp(`([A-Za-z0-9${Q}])[ ]*([\u201C])([A-Za-z0-9${Q}\\-_ ]+)([\u201D])`,"g"),Ph=new RegExp(`([\u201C])([A-Za-z0-9${Q}\\-_ ]+)([\u201D])[ ]*([A-Za-z0-9${Q}])`,"g"),$h=/([A-Za-z0-9])([\(\[\{])/g,Ih=/([\)\]\}])([A-Za-z0-9])/g,Nh=new RegExp(`([${Q}])([A-Za-z\u0370-\u03FF0-9@\\$%\\^&\\*\\-\\+\\\\=\\|/\xA1-\xFF\u2150-\u218F\u2700\u2014\u27BF])`,"g"),Eh=new RegExp(`([A-Za-z\u0370-\u03FF0-9~\\$%\\^&\\*\\-\\+\\\\=\\|/!;:,\\.\\?\xA1-\xFF\u2150-\u218F\u2700\u2014\u27BF])([${Q}])`,"g"),Ah=/(%)([A-Za-z])/g,Rh=/([ ]*)([\u00b7\u2022\u2027])([ ]*)/g,Mh=new RegExp(`([${Q}]) ([${Q}])`,"g"),Zn=class{constructor(){_i(this,"version")}convertToFullwidth(t){return t.replace(/~/g,"\uFF5E").replace(/!/g,"\uFF01").replace(/;/g,"\uFF1B").replace(/:/g,"\uFF1A").replace(/,/g,"\uFF0C").replace(/\./g,"\u3002").replace(/\?/g,"\uFF1F")}toFullwidth(t){let o=t,r=this;return o=o.replace(lh,(n,i,l,a)=>{let s=r.convertToFullwidth(l);return`${i}${s}${a}`}),o=o.replace(ah,(n,i,l)=>{let a=r.convertToFullwidth(l);return`${i}${a}`}),o}spacing(t){let o=t;return o=o.replace(sh,"$1 $2"),o=o.replace(ch,"$1\uFF1A$2"),o=o.replace(uh,"$1 $2"),o=o.replace(ph,"$1 $2"),o=o.replace(fh,"$1$2$3"),o=o.replace(dh,"$1 $2"),o=o.replace(mh,"$1 $2"),o=o.replace(hh,"$1's"),o=o.replace(gh,"$1 $2$3$4 $5"),o=o.replace(yh,"$1 $2"),o=o.replace(bh,"$1 $3"),o=o.replace(xh,"$1 $2 $3"),o=o.replace(wh,"$1 $2 $3"),o=o.replace(_h,"$1$2"),o=o.replace(Ch,"$1$2$3"),o=o.replace(Sh,"$1 $2"),o=o.replace(kh,"$1 $2"),o=o.replace(Th,"$1$2$3"),o=o.replace(vh,"$1 $2$3$4"),o=o.replace(Ph,"$1$2$3 $4"),o=o.replace($h,"$1 $2"),o=o.replace(Ih,"$1 $2"),o=o.replace(Nh,"$1 $2"),o=o.replace(Eh,"$1 $2"),o=o.replace(Ah,"$1 $2"),o=o.replace(Rh,"\u30FB"),o=o.replace(Mh,"$1$2"),o}},bo=new Zn;async function ac(e,t,o){let r=Object.entries(e).map(l=>l[1].map(a=>`${l[0]}. ${a}`)).flat().slice(0,9),{buttonIndex:n,inputContent:i}=await(0,z.popup)({title:o,message:t,buttons:[...r.map((l,a)=>`(${a+1}) ${l}`),K.custom],multiLine:!0,canCancel:!0,type:lc.UIAlertViewStyle.PlainTextInput});if(n<r.length)return r[n];if(i)return F(i,!0).replace(/\s*\[\s*([a-z]+)\s*\]\s*/,(l,a)=>a==="all"?Object.entries(e).map(s=>`${s[0]}. ${s[1].join("; ")}`).join(`
`):a in e?`${a}. ${e[a].join("; ")}`:"").replace(/\s*\[([0-9\-]+)\]\s*/,(l,a)=>{let s=Array.from({length:r.length},(c,u)=>u+1).join(", ").match(new RegExp(`[${a}]`,"g"));return s!=null&&s.length?`
`+Object.entries(s.reduce((c,u)=>{var d;let[p,f]=r[Number(u)-1].split(/^(\w+)\.\s*/).filter(h=>h);return c[p]=[...(d=c[p])!=null?d:[],f],c},{})).map(c=>`${c[0]}. ${c[1].join("; ")}`).join(`
`)+`
`:""}).trim()}async function Oh(e,t=!1){let r=bo.spacing(bo.toFullwidth(e)).split(`
`).reduce((n,i)=>(/人名|\[.+\]/.test(i)||n.push(i.replace(/^a\.\s*/gm,"adj. ")),n),[]);if(t){let n={};if(r.forEach(i=>{var s,c;let[l,a]=i.split(/^(\w+)\.\s*/).filter(u=>u);a?/[；;]/.test(a)?n[l]=[...(s=n[l])!=null?s:[],...a.split(/\s*[；;]\s*/).map(u=>u)]:n[l]=[...(c=n[l])!=null?c:[],...a.split(/\s*[,，]\s*/).map(u=>u)]:n.un=[i]}),Object.values(n).flat().length>1)return await ac(n,K.choose_meaning,g.title)}return r.join(`
`)}async function Dh(e,t=!1){let o=e.split(`
`).map(r=>r.replace(/^a\.\s*/gm,"adj. ").replace(/^[rs]\.\s*/gm,"adv. "));if(t){let r={};if(o.forEach(n=>{var a,s;let[i,l]=n.split(/^(\w+)\.\s*/).filter(c=>c);l?/[；;]/.test(l)?r[i]=[...(a=r[i])!=null?a:[],...l.split(/\s*[；;]\s*/).map(c=>c)]:r[i]=[...(s=r[i])!=null?s:[],...l.split(/\s*[,，]\s*/).map(c=>c)]:r.un=[n]}),Object.values(r).flat().length>1)return await ac(r,K.choose_meaning,g.title)}return o.join(`
`)}async function Yn(e){function t(o){let r={};return Object.entries(o).forEach(([n,i])=>{(0,z.isNSNull)(i)||!i?r[n]=void 0:Number.isNaN(Number(i))?r[n]=i:r[n]=Number(i)}),r}{if(!g.dataAutoComplete)if((0,z.isfileExists)(`${g.path}/AutoCompleteData.db`))g.dataAutoComplete=SQLiteDatabase.databaseWithPath(`${g.path}/AutoCompleteData.db`),g.dataAutoComplete.open();else{let{index:n}=await(0,z.select)(K.not_find_db.$options2,void 0,K.not_find_db.message,!0);switch(n){case 0:throw(0,z.openURL)("https://github.com/ourongxing/ohmymn/releases/tag/database"),"";case 1:{let i=await(0,z.openFile)("com.pkware.zip-archive");if(i)if(i.endsWith("AutoCompleteData.zip")||i.endsWith("AutoCompleteData.online.zip"))if(z.HUDController.show(K.not_find_db.wait),await(0,z.delay)(.1),(0,z.copyFile)(i,`${g.path}/AutoCompleteData.zip`),ZipArchive.unzipFileAtPathToDestination(`${g.path}/AutoCompleteData.zip`,g.path),z.HUDController.hidden(),(0,z.isfileExists)(`${g.path}/AutoCompleteData.db`))g.dataAutoComplete=SQLiteDatabase.databaseWithPath(`${g.path}/AutoCompleteData.db`),g.dataAutoComplete.open();else throw K.not_find_db.wrong_file;else throw K.not_find_db.wrong_file}break;default:throw""}}let o=g.dataAutoComplete.executeQueryWithArgumentsInArray(`SELECT * FROM stardict WHERE word = '${e}'`,[]),r;for(;o.next();)r=o.resultDictionary();if(o.close(),!r)throw"";return t(r)}}function Lh(e){return[["zk","\u4E2D\u8003"],["gk","\u9AD8\u8003"],["cet4","\u56DB\u7EA7"],["cet6","\u516D\u7EA7"],["ky","\u8003\u7814"],["gre","GRE"],["toefl","\u6258\u798F"],["ielts","\u96C5\u601D"]].reduce((o,r)=>o.replace(r[0],r[1]),e).split(/\x20+/).filter(o=>o)}function Bh(e){return"\u2B50".repeat(e)}function ic(e,t){if(e)if(t){let o=t(e);if(o)return o}else return e}async function Uh(e){let{customFill:t,customFillFront:o,fillWordInfo:r,selectMeanings:n}=self.globalProfile.autocomplete;if(r[0]===0)return["",""];let i=r[0]===1?F(`"${pe(o)}"`):"",l=r[0]===1?F(`"${pe(t)}"`):"{{zh}}",a=async(s,c=[])=>{let u,p;/{{\s*zh\s*}}/.test(s)&&e.translation&&(p=await Oh(e.translation,c.includes(0))),/{{\s*en\s*}}/.test(s)&&e.definition&&(u=await Dh(e.definition,c.includes(1)));let f={word:e.word,phonetic:e.phonetic,tags:ic(e.tag,d=>Lh(d).join("/")),collins:ic(e.collins,d=>Bh(d)),en:u,zh:p};return Gr.render(s,f).trim()};return[await a(i),await a(l,n)]}function Fh(e,t){return t?Object.entries(sc(t)).reduce((o,r)=>{let[n,i]=r;return n!=="current"&&n!=="lemma"&&!o.includes(i)&&o.push(i),o},[e]):[e]}function sc(e){let t={};return e.split("/").forEach(o=>{let[r,n]=o.split(":");switch(r){case"s":t.s=n;break;case"d":t.done=n;break;case"p":t.did=n;break;case"i":t.doing=n;break;case"3":t.does=n;break;case"r":t.er=n;break;case"t":t.est=n;break;case"0":t.lemma=n;break;case"1":t.current=n;break}}),t}function Gh(e,t){var o;try{let r=(o=z.MN.db.getDocumentById(e.docMd5))==null?void 0:o.textContentsForPageNo(e.startPage),[n,i,l,a]=F(`[${e.startPos},${e.endPos}]`),s=i<a?i:a,c=n<l?n:l;if(r!=null&&r.length){let u=r.reduce((k,N)=>{let{y:P}=(0,z.CGRectValue2CGRect)(N[0].rect),re=P-s;if(re<50&&re>-50){let b=0,m=N.reduce((w,_)=>{if(w+=String.fromCharCode(Number(_.char)),b!==1&&re<5&&re>-5){let{x:X}=(0,z.CGRectValue2CGRect)(_.rect);X-c<5&&X-c>-5?(b=1,w+="orogxng"):b=2}return w},"");if(m=m.replace(Mr,".$1."),b===1){let w=m.indexOf("orogxng");m=m.replace("orogxng","");let _=m.match(new RegExp(t,"g"));if(!(_!=null&&_.length))throw"";_.length===1?m=m.replace(t,"orogxng"):m=m.replace(new RegExp(t,"g"),(X,at)=>w-at>-5&&w-at<5?"orogxng":X)}/[ \-]$/.test(m)||(m+=" "),k.length&&!/-$/.test(k[k.length-1].text)&&/^(?:\s+|[A-Z]\w*|[^A-Za-z-])/.test(m)&&(k[k.length-1].text=k[k.length-1].text.trim()+"..."),m&&k.push({text:m,flag:b,des:re,index:k.length})}return k},[]),p=u.filter(k=>k.flag!==0);if(p.length>1){let k=p.findIndex(N=>N.flag===1);k===0?u=u.slice(0,p[k+1].index):k===p.length-1?u=u.slice(p[k-1].index):u=u.slice(p[k-1].index,p[k+1].index)}let f=u.map(k=>k.text).join(""),[d,h]=f.split(/\s*orogxng\s*/);d=d.replace(/^.*(?:[?!。？！…;；]|\.(?!\d))\s*(.*)$|^\s*(.*)$/,"$1$2"),h=h.replace(/^(\s*.*?(?:[?!。？！…;；]|\.(?!\d))).*$|^(.*)\s*$/,"$1$2");let y=[d,/\W$/.test(d)?"":" ",t,/^\W/.test(d)?"":" ",h].join("").replace(/^\.+/,"").replace(/^[\[【(]?(?:\d+|[A-Za-z])[\]】)]/,"");if(!/^\w+$/.test(y))return y}}catch{return}}async function Wh(e){let t=await Yn(e),{exchange:o}=t;if(o){let r=sc(o),{lemma:n,current:i}=r;if(n&&i)if(Object.keys(r).length>2&&self.globalProfile.autocomplete.selectLemma){let{index:l}=await(0,z.select)([e,n],g.title,K.maybe_other_word);if(l)return await Yn(n)}else return e=n,await Yn(n)}return t}async function Vr(e,t,o=!1){var r;try{let n=e.replace(new RegExp(`^[^${St}a-zA-Z]*(\\w+)[^${St}a-zA-Z]*$`,"g"),"$1");if(!/^\w[a-z]+$/.test(n))return;let i=n.toLowerCase(),l=await Wh(i),{collins:a,autoContext:s}=self.globalProfile.autocomplete;if(l.collins&&!a.includes(Number(l.collins))||!l.collins&&!a.includes(0))return;let c=Fh(l.word,l.exchange);if(o){let u=s&&(r=Gh(t,n))!=null?r:"";return{title:c,comments:[...await Uh(l)],text:u}}else return{title:c,comments:[],text:""}}catch(n){z.MN.error(n),n&&(0,z.showHUD)(String(n),2);return}}var cc={name:"AutoComplete",key:"autocomplete",intro:K.intro,link:x("autocomplete"),settings:[{key:"on",type:1,label:K.on,auto:{generateTitles:{index:-999,method({text:e,note:t}){return Vr(e,t,!0)}}}},{key:"collins",type:7,option:K.collins.$option6,label:K.collins.label,help:K.collins.help},{key:"fillWordInfo",type:6,option:K.fill_word_info.$option3,label:K.fill_word_info.label},{key:"customFillFront",type:4,help:K.custom_fill_front.help,bind:["fillWordInfo",1],link:K.custom_fill_front.link,check({input:e}){if(We(e),/{{\s*(?:zh|en)\s*}}/.test(e))throw K.custom_fill_front.error}},{key:"customFill",type:4,help:K.custom_fill,bind:["fillWordInfo",1],check({input:e}){We(e)}},{key:"selectMeanings",type:7,option:K.select_meaning.$option2,label:K.select_meaning.label,bind:[[["fillWordInfo",1],["fillWordInfo",2]]]},{key:"selectLemma",type:1,label:K.select_lemma},{key:"autoContext",type:1,label:K.auto_context.label,help:K.auto_context.help}],actions4card:[{key:"completeWord",type:2,label:K.complete_word.label,method:async({nodes:e,option:t})=>{if(t===-1)return;let o=n=>{try{let i=n.titles[0];return i?Vr(i,n.note):void 0}catch{return}},r=await Promise.all(e.map(n=>o(n)));(0,lo.undoGroupingWithRefresh)(()=>{e.forEach((n,i)=>{let l=r==null?void 0:r[i];l!=null&&l.title.length&&(n.titles=l.title)})}),lo.HUDController.hidden()}},{key:"genWordCard",type:2,label:K.gen_word_card.label,option:K.gen_word_card.$option2,method:async({nodes:e,option:t})=>{if(t===-1)return;let o=n=>{try{let i=n.titles[0];return i?Vr(i,n.note,!0):void 0}catch{return}},r=await(async()=>{let{selectLemma:n}=self.globalProfile.autocomplete,i=[...self.globalProfile.autocomplete.selectMeanings];e.length>1&&(self.globalProfile.autocomplete.selectLemma=!1,self.globalProfile.autocomplete.selectMeanings=[]),self.globalProfile.autocomplete.selectLemma===!1&&self.globalProfile.autocomplete.selectMeanings.length===0&&lo.HUDController.show(K.loading);let l=await Promise.all(e.map(a=>o(a)));return e.length>1&&(self.globalProfile.autocomplete.selectLemma=n,self.globalProfile.autocomplete.selectMeanings=i),l})();(0,lo.undoGroupingWithRefresh)(()=>{e.forEach((n,i)=>{let l=r==null?void 0:r[i];if(l){let{title:a,comments:s,text:c}=l;c&&(n.mainExcerptText=c),n.removeCommentButLinkTag(u=>u.type==="PaintNote"||t!==1||u.type==="HtmlNote",u=>{self.globalProfile.addon.useMarkdown?u.appendMarkdownComments(...s):u.appendTextComments(...s)})}})}),lo.HUDController.hidden()}}]};var pc=C(S());var uc=C(S());var $t=(0,uc.i18n)({zh:{intro:"\u9488\u5BF9\u6709\u5E8F\u53F7\u7684\u6458\u5F55\uFF0C\u81EA\u52A8\u6DFB\u52A0\u6362\u884C\u3002\u6240\u6709\u9884\u8BBE\u5747\u5FC5\u987B\u5339\u914D\u5230\u4E24\u4E2A\u53CA\u4EE5\u4E0A\uFF0C\u5305\u62EC\u81EA\u5B9A\u4E49\u3002",on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",preset:{label:"\u9009\u62E9\u9700\u8981\u7684\u9884\u8BBE",$option4:["\u81EA\u5B9A\u4E49","ABCD...","\u4E00\u4E8C\u4E09\u56DB...","1234..."]},list_selected:{label:"\u6DFB\u52A0\u6362\u884C",$option2:["\u4F7F\u7528 AutoList \u7684\u8BBE\u7F6E","\u786E\u5B9A"]},custom_list:{help:"\u81EA\u5B9A\u4E49\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u683C\u5F0F\u3002",link:x("autolist")}},en:{intro:"For text with serial number, auto add line breaks. All presets need to meet a minimum of two serial numbers.",on:"Auto Run When Excerpting",custom_list:{help:"Customize. Click for specific formats",link:x("autolist")},preset:{label:"Select Presets",$option4:["Custom","ABCD...","\u4E00\u4E8C\u4E09\u56DB...","1234..."]},list_selected:{label:"Add Line Breaks",$option2:["Use AutoList Settings","Confirm"]}}});function Qn(e){var o,r,n;let{preset:t}=self.globalProfile.autolist;if(t.includes(0)){let{customList:i}=self.tempProfile.replaceParam;if(i)for(let l of i){l.regexp=wt.add(l.regexp,"g");let a=(o=e.match(l.regexp))==null?void 0:o.length;if(a&&a>1)return ei(e.replace(l.regexp,l.newSubStr).replace(/\n{2,}/g,`
`).trim(),l.fnKey)}}return(n=(r=(i=>{var l,a;for(let s of t.filter(c=>c!==0))switch(s){case 1:let c=Or(i)?[/\s*([(（【\[]\s*[A-Za-z]\s*[)）\]】])/g,`
$1`]:[/\s*([A-Za-z]\s*[.、，,])|\s*([(（【\[]\s*[A-Za-z]\s*[)）\]】])/g,`
$1$2`],u=(l=i.match(c[0]))==null?void 0:l.length;if(u&&u>1)return i.replace(c[0],c[1]);break;default:{let f=[[new RegExp(`s*([\u5176\u7B2C]?[${Ne.chinese_number}]{1,2}[.\u3001\uFF0C,])|s*([\u5176\u7B2C][${Ne.chinese_number}]{1,2})`,"g"),`
$1$2`],[/\s*([0-9]{1,2}\s*[.、，,]\D)|\s*([(（【\[]\s*[0-9]{1,2}\s*[)）\]】])/g,`
$1$2`]][s-2],d=(a=i.match(f[0]))==null?void 0:a.length;if(d&&d>1)return i.replace(f[0],f[1]);break}}})(e))==null?void 0:r.replace(/\n{2,}/g,`
`).trim())!=null?n:e}function ei(e,t){if(t<=0)return e;switch(t){case 0:return e;case 2:case 3:{let o=[Ne.capital_letter,Ne.lowercase_letter][t-2],r=0;return e.replace(/^/gm,n=>`${o[r++]}. ${n}`)}case 4:case 5:{let o=[Ne.chinese_capital_number,Ne.chinese_number][t-4],r=0;return e.replace(/^/gm,n=>`${o[r++]}\u3001${n}`)}case 6:case 7:{let o=[Ne.hollow_circle_number,Ne.solid_circle_number][t-6],r=0;return e.replace(/^/gm,n=>`${o[r++]} ${n}`)}default:{let o=1;return e.replace(/^/gm,r=>`${o++}. ${r}`)}}}var fc={name:"AutoList",key:"autolist",intro:$t.intro,link:x("autolist"),settings:[{key:"on",type:1,label:$t.on,auto:{modifyExcerptText:{index:2,method({text:e}){return Qn(e)}}}},{key:"preset",type:7,option:$t.preset.$option4,label:$t.preset.label},{key:"customList",type:4,help:$t.custom_list.help,bind:["preset",0],link:$t.custom_list.link,check({input:e}){st(e)}}],actions4card:[{type:3,label:$t.list_selected.label,key:"listCard",option:$t.list_selected.$option2,method({nodes:e,content:t,option:o}){(0,pc.undoGroupingWithRefresh)(()=>{if(o==0)e.forEach(r=>{r.notes.forEach(n=>{let i=n.excerptText;i&&(n.excerptText=Qn(i))})});else if(t){let r=xe(t),{regexp:n,fnKey:i,newSubStr:l}=r[0];e.forEach(a=>{a.notes.forEach(s=>{let c=s.excerptText;c&&(s.excerptText=ei(c.replace(n,l).replace(/\n{2,}/g,`
`).trim(),i))})})}})},check({input:e}){Ct(e)}}]};var jr=C(S());var dc=C(S());var j=(0,dc.i18n)({zh:{intro:"\u4F7F\u7528\u767E\u5EA6 OCR \u670D\u52A1\u5728\u6458\u5F55\u65F6\u8FDB\u884C\u5C0F\u8BED\u79CD\u7684\u5728\u7EBF\u77EB\u6B63\u3002      ",on:{label:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",help:"\u3010\u4EC5\u5F53\u524D\u6587\u6863\u3011"},lang:{$option21:["\u81EA\u52A8\u68C0\u6D4B","\u4E2D\u82F1\u6587\u6DF7\u5408","\u82F1\u6587","\u65E5\u8BED","\u97E9\u8BED","\u6CD5\u8BED","\u897F\u73ED\u7259\u8BED","\u8461\u8404\u7259\u8BED","\u5FB7\u8BED","\u610F\u5927\u5229\u8BED","\u4FC4\u8BED","\u4E39\u9EA6\u8BED","\u8377\u5170\u8BED","\u9A6C\u6765\u8BED","\u745E\u5178\u8BED","\u5370\u5C3C\u8BED","\u6CE2\u5170\u8BED","\u7F57\u9A6C\u5C3C\u4E9A\u8BED","\u571F\u8033\u5176\u8BED","\u5E0C\u814A\u8BED","\u5308\u7259\u5229\u8BED"],help:"\u3010\u4EC5\u5F53\u524D\u6587\u6863\u3011",label:"\u8BC6\u522B\u8BED\u8A00"},formula_ocr:{label:"\u516C\u5F0F\u8BC6\u522B",$option3:["Pure Latex","$ Latex $","$$ Latex $$"],help:'"Markdown" \u63D2\u4EF6\u8BF7\u9009\u62E9 Pure Latex'},formula_ocr_providers:{label:"\u516C\u5F0F\u8BC6\u522B\u63D0\u4F9B\u5546",$option2:["\u767E\u5EA6","Mathpix"],help:"\u516C\u5F0F\u8BC6\u522B\u4E0D\u652F\u6301\u6458\u5F55\u65F6\u81EA\u52A8\u8BC6\u522B\uFF0C\u53EA\u80FD\u5728 MagicAtion for Text \u4E2D\u624B\u52A8\u8FDB\u884C\u516C\u5F0F\u8BC6\u522B\u3002"},markdown:{label:"\u4F7F\u7528\u7684 Markdown \u63D2\u4EF6",help:"\u7528\u4E8E\u663E\u793A\u516C\u5F0F\uFF0C\u63A8\u8350\u4F7F\u7528 Milkdown \u3002",$option3:["Markdown","myMarkDown","Milkdown"]},baidu_api_key:{help:"\u767E\u5EA6 Api Key\uFF0C\u70B9\u51FB\u67E5\u770B\u5982\u4F55\u83B7\u53D6\u3002",link:x("autoocr","\u767E\u5EA6-ocr")},baidu_secret_key:"\u767E\u5EA6 Secret Key",mathpix_app_key:{help:"Mathpix App Key\uFF0C\u70B9\u51FB\u67E5\u770B\u5982\u4F55\u83B7\u53D6\u3002",link:x("autoocr","mathpix")},$show_key2:["\u70B9\u51FB\u67E5\u770B\u5BC6\u94A5\uFF0C\u4E0D\u8981\u8BA9\u5176\u4ED6\u4EBA\u770B\u5230","\u70B9\u51FB\u9690\u85CF\u5BC6\u94A5\uFF0C\u4E0D\u8981\u8BA9\u5176\u4ED6\u4EBA\u770B\u5230"],text_ocr:"\u6587\u5B57\u8BC6\u522B",hand_writting_ocr:"\u624B\u5199\u8BC6\u522B",qr_code_ocr:"\u4E8C\u7EF4\u7801\u8BC6\u522B",sure:"\u786E\u5B9A",detect_link:"\u7ED3\u679C\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F\u4E0A\uFF0C\u4F46\u68C0\u6D4B\u5230\u8BC6\u522B\u7ED3\u679C\u4E2D\u542B\u6709\u94FE\u63A5\uFF0C\u662F\u5426\u76F4\u63A5\u5728\u6D4F\u89C8\u5668\u4E2D\u6253\u5F00\uFF1F",baidu_token_error:"\u767E\u5EA6 OCR Api Key \u6216 Secret Key \u8F93\u5165\u9519\u8BEF\uFF01",no_mathpix_key:"\u6CA1\u6709\u8F93\u5165 Mathpix key\uFF01",mathpix_key_error:"Mathpix key \u8F93\u5165\u9519\u8BEF\uFF01",success_clipboard:"\u7ED3\u679C\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F\u4E0A\uFF0C\u5FEB\u53BB\u7C98\u8D34\u5427\uFF01",no_baidu_api_key:"\u6CA1\u6709\u8BBE\u7F6E\u767E\u5EA6 OCR Api Key",no_baidu_secret_key:"\u6CA1\u6709\u8BBE\u7F6E\u767E\u5EA6 OCR Secret Key"},en:{intro:"Use the Baidu OCR service to correct the online small language when excerpting.      ",on:{label:"Auto Run When Excerpting",help:"[Only Current Document]"},lang:{help:"[Only Current Document]",label:"Language",$option21:["Auto","Chinese+English","English","Japanese","Korean","French","Spanish","Portuguese","German","Italian","Russian","Danish","Dutch","Malay","Swedish","Indonesian","Polish","Romanian","Turkish","Greek","Hungarian"]},formula_ocr_providers:{label:"Formula OCR Providers",$option2:["Baidu","Mathpix"],help:"Formula OCR is not supported in auto mode, only in MagicAtion for Text."},markdown:{label:"Markdown Addon Used",help:"For displaying formulas, Milkdown is recommended",$option3:["Markdown","myMarkDown","Milkdown"]},formula_ocr:{label:"Formula OCR",help:'For "Markdown" Addon, please choose Pure Latex',$option3:["Pure Latex","$ Latex $","$$ Latex $$"]},baidu_api_key:{link:x("autoocr","baidu-ocr"),help:"Baidu Api Key, click to see how to get it."},baidu_secret_key:"Baidu Secret Key",mathpix_app_key:{link:x("autoocr","mathpix"),help:"Mathpix App Key, click to see how to get it."},$show_key2:["Click to show secret key","Click to hide secret key"],text_ocr:"Text OCR",hand_writting_ocr:"Handwritting OCR",qr_code_ocr:"QRCode OCR",sure:"Confirm",detect_link:"The result has been copied to the clipboard, but a link is detected in the recognition result, is it opened directly?",baidu_token_error:"Api Key or Secret Key is wrong!",no_mathpix_key:"No Mathpix key\uFF01",mathpix_key_error:"Mathpix key is wrong!",success_clipboard:"The results have been copied to the clipboard, go ahead and paste them!",no_baidu_api_key:"No Baidu OCR Api Key",no_baidu_secret_key:"No Baidu OCR Secret Key"}});var It=C(S());async function Kr(){let{lastGetToken:e,baiduToken:t}=self.globalProfile.additional.autoocr,{baiduApiKey:o,baiduSecretKey:r}=self.globalProfile.autoocr;if(t&&Date.now()-e<2592e6)return t;if(!o)throw j.no_baidu_api_key;if(!r)throw j.no_baidu_secret_key;let n=await(0,It.fetch)(`https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id=${o}&client_secret=${r}`).then(i=>i.json());if(!n.access_token)throw j.baidu_token_error;return self.globalProfile.additional.autoocr={lastGetToken:Date.now(),baiduToken:n.access_token},n.access_token}async function mc(e){let{mathpixAppKey:t}=self.globalProfile.autoocr;if(!t)throw j.no_mathpix_key;let o=await(0,It.fetch)("https://api.mathpix.com/v3/latex",{method:"POST",headers:{app_key:t},json:{src:"data:image/jpg;base64,"+e,formats:["latex_styled"],ocr:["math","text"]}}).then(r=>r.json());if(o.error)throw`Mathpix: ${o.error}`;return o.latex_styled}async function hc(e){let t=await Kr(),o=await(0,It.fetch)(`https://aip.baidubce.com/rest/2.0/ocr/v1/qrcode?access_token=${t}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},form:{image:e}}).then(r=>r.json());if(o.error_code&&o.error_msg)throw`${o.error_code}: ${o.error_msg}`;return o.codes_result.map(r=>r.text).join("")}async function gc(e){let t=await Kr(),o=await(0,It.fetch)(`https://aip.baidubce.com/rest/2.0/ocr/v1/formula?access_token=${t}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},form:{image:e}}).then(r=>r.json());if(o.error_code&&o.error_msg)throw`Baidu OCR\uFF1A${o.error_code} ${o.error_msg}`;return o.words_result.map(r=>r.words).join("")}async function yc(e){let t=await Kr(),o=await(0,It.fetch)(`https://aip.baidubce.com/rest/2.0/ocr/v1/handwriting?access_token=${t}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},form:{image:e}}).then(r=>r.json());if(o.error_code&&o.error_msg)throw`${o.error_code}: ${o.error_msg}`;return o.words_result.map(r=>r.words).join("")}async function jo(e){try{let t=["auto_detect","CHN_ENG","ENG","JAP","KOR","FRE","SPA","POR","GER","ITA","RUS","DAN","DUT","MAL","SWE","IND","POL","ROM","TUR","GRE","HUN"],o=await Kr(),r=await(0,It.fetch)(`https://aip.baidubce.com/rest/2.0/ocr/v1/accurate_basic?access_token=${o}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},form:{image:e,language_type:t[self.globalProfile.autoocr.lang[0]]}}).then(n=>n.json());if(r.error_code&&r.error_msg)throw`${r.error_code}: ${r.error_msg}`;return r.words_result.map(n=>/[.。;；·?？！!]$/.test(n.words)?n.words+`
`:n.words).join("")}catch(t){(0,It.showHUD)(String(t))}}var bc={name:"AutoOCR",key:"autoocr",intro:j.intro,link:x("autoocr"),settings:[{key:"on",type:1,label:j.on.label,help:j.on.help,auto:{customOCR:{index:1,method({imgBase64:e}){return jo(e)}}}},{key:"lang",label:j.lang.label,type:6,option:j.lang.$option21,help:j.lang.help},{key:"formulaOCRProviders",type:6,option:j.formula_ocr_providers.$option2,label:j.formula_ocr_providers.label,help:j.formula_ocr_providers.help},{key:"markdown",type:6,option:j.markdown.$option3,label:j.markdown.label,help:j.markdown.help},{key:"showKey",type:8,label:j.$show_key2},{key:"baiduApiKey",type:4,help:j.baidu_api_key.help,link:j.baidu_api_key.link,bind:["showKey",!0]},{key:"baiduSecretKey",type:4,help:j.baidu_secret_key,bind:["showKey",!0]},{key:"mathpixAppKey",type:4,help:j.mathpix_app_key.help,link:j.mathpix_app_key.link,bind:[["showKey",!0],["formulaOCRProviders",1]]}],actions4text:[{type:2,key:"formulaOCR",label:j.formula_ocr.label,option:j.formula_ocr.$option3,help:j.formula_ocr.help,method:async({imgBase64:e,option:t})=>{try{let o=(self.globalProfile.autoocr.formulaOCRProviders[0]===0?await gc(e):await mc(e)).trim();return[o,`$${o}$`,`$$
${o}
$$`][t]}catch(o){(0,jr.showHUD)(String(o),2)}}},{type:2,key:"textOCR",label:j.text_ocr,method:async({imgBase64:e})=>await jo(e)},{type:2,key:"handWrittingOCR",label:j.hand_writting_ocr,method:async({imgBase64:e})=>{try{return await yc(e)}catch(t){(0,jr.showHUD)(String(t),2)}}},{type:2,key:"QRCodeOCR",label:j.qr_code_ocr,method:async({imgBase64:e})=>{try{return await hc(e)}catch(t){(0,jr.showHUD)(String(t),2)}}}]};var _c=C(S());var xc=C(S());var Nt=(0,xc.i18n)({zh:{intro:"\u81EA\u52A8\u66FF\u6362\u6458\u5F55\u4E2D\u7684\u6587\u5B57\u3002",on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",preset:{label:"\u9009\u62E9\u9700\u8981\u7684\u9884\u8BBE",$option1:["\u81EA\u5B9A\u4E49"]},replace_selected:{label:"\u66FF\u6362\u6458\u5F55\u5185\u5BB9",$option2:["\u4F7F\u7528 AutoReplace \u7684\u8BBE\u7F6E","\u786E\u5B9A"]},custom_replace:{link:x("autoreplace","\u81EA\u5B9A\u4E49"),help:"\u81EA\u5B9A\u4E49\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u683C\u5F0F\u3002"}},en:{intro:"Automatically replace errors in excerpts. ",on:"Auto Run When Excerpting",preset:{label:"Select Presets",$option1:["Custom"]},replace_selected:{$option2:["Use AutoReplace Settings","Confirm"],label:"Replace Excerpt Text"},custom_replace:{link:x("autoreplace","custom"),help:"Customize. Click for specific formats"}}});function wc(e,t){let{preset:o}=self.globalProfile.autoreplace;for(let r of o)switch(r){case 0:let{customReplace:n}=self.tempProfile.replaceParam;if(!(n!=null&&n.length))continue;t=n.reduce((i,l)=>i.replace(l.regexp,me(e,l.newSubStr)),t)}return t}var Cc={name:"AutoReplace",key:"autoreplace",intro:Nt.intro,link:x("autoreplace"),settings:[{key:"on",type:1,label:Nt.on,auto:{modifyExcerptText:{index:999,method({node:e,text:t}){return wc(e,t)}}}},{key:"preset",type:7,option:Nt.preset.$option1,label:Nt.preset.label},{key:"customReplace",type:4,help:Nt.custom_replace.help,bind:["preset",0],link:Nt.custom_replace.link}],actions4card:[{type:3,label:Nt.replace_selected.label,key:"replaceCard",option:Nt.replace_selected.$option2,method:({content:e,nodes:t,option:o})=>{(0,_c.undoGroupingWithRefresh)(()=>{if(o==0)t.forEach(r=>{r.notes.forEach(n=>{let i=n.excerptText;i&&(n.excerptText=wc(r,i))})});else if(e){e=/^\(.*\)$/.test(e)?e:`(/^.*$/gs, "${pe(e)}")`;let r=xe(e);t.forEach(n=>{n.notes.forEach(i=>{let l=i.excerptText;l&&(i.excerptText=r.reduce((a,s)=>a.replace(s.regexp,me(n,s.newSubStr)),l))})})}})}}]};var Sc=C(S());var Oe=(0,Sc.i18n)({zh:{intro:"\u4F18\u5316\u6458\u5F55\u548C\u6807\u9898\u7684\u6392\u7248\u4E0E\u683C\u5F0F\u3002",on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",custom_format:{help:"\u81EA\u5B9A\u4E49\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u683C\u5F0F\u3002",link:x("autoformat")},preset:{label:"\u9009\u62E9\u9700\u8981\u7684\u9884\u8BBE",$option5:["\u81EA\u5B9A\u4E49","\u534A\u89D2\u8F6C\u5168\u89D2","\u4E2D\u82F1\u6587\u52A0\u7A7A\u683C","\u53BB\u9664\u4E2D\u6587\u95F4\u7A7A\u683C","\u53BB\u9664\u91CD\u590D\u7A7A\u683C"]},format_selected:{label:"\u4F18\u5316\u6392\u7248\u683C\u5F0F",$option3:["\u6807\u9898\u548C\u6458\u5F55","\u4EC5\u6807\u9898","\u4EC5\u6458\u5F55"]},remove_space:{label:"\u5220\u9664\u6240\u6709\u7A7A\u683C",help:"\u3010\u4EC5\u5F53\u524D\u6587\u6863\u3011\u5982\u679C\u6587\u6863\u4E2D\u6709\u5927\u91CF\u5355\u8BCD\uFF0C\u8BF7\u8C28\u614E\u4F7F\u7528\u3002"},format_title:{help:"\u6D89\u53CA\u5230\u9996\u5B57\u6BCD\u5927\u5199\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u89C4\u8303\u3002",label:"\u82F1\u6587\u6807\u9898\u89C4\u8303\u5316",link:x("autoformat")}},en:{intro:"Optimize the layout and format of excerpts and titles.",on:"Auto Run When Excerpting",remove_space:{label:"Remove All Spaces",help:"[Only Current Document] If there are a lot of words in the document, please use it with caution."},custom_format:{help:"Customize. Click for specific formats.",link:x("autoformat")},preset:{label:"Select Presets",$option5:["Custom","Half Width To Full Width","Add Space Between Chinese & English","Remove Spaces Between Chinese","Remove Repeated Spaces"]},format_selected:{label:"Format Excerpt Text",$option3:["All","Only Title","Only Excerpt Text"]},format_title:{label:"Normalize English Title",link:x("autoformat"),help:"Click for  specific specifications"}}});var kc=e=>{let t=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|v.?|vs.?|via)$/i,o=/([A-Za-z0-9\u00C0-\u00FF])/,r=/([ :–—-])/;return e.split(r).map(function(n,i,l){return n.search(t)>-1&&i!==0&&i!==l.length-1&&l[i-3]!==":"&&l[i+1]!==":"&&(l[i+1]!=="-"||l[i-1]==="-"&&l[i+1]==="-")?n.toLowerCase():n.substr(1).search(/[A-Z]|\../)>-1||l[i+1]===":"&&l[i+2]!==""?n:n.replace(o,function(a){return a.toUpperCase()})}).join("")};function ti(e){return e.map(t=>Or(t)?kc(t):t)}function xo(e){let{preset:t}=self.globalProfile.autoformat,{removeSpace:o}=self.docProfile.autoformat;e=e.replace(/\*\*(.+?)\*\*/g,(r,n)=>ct(n)?`placehder${n}placehder`:`\u5360\u554A\u4F4D\u7B26${n}\u5360\u554A\u4F4D\u7B26`),o&&(e=e.replace(/\x20/g,""));for(let r of t)if(!(r!==0&&ct(e)))switch(r){case 0:let{customFormat:n}=self.tempProfile.replaceParam;if(!n)continue;n.forEach(i=>{let{regexp:l,newSubStr:a,fnKey:s}=i;(s===0&&Mn(e)||s===1&&ct(e)||s>=2)&&(e=e.replace(l,a))});break;case 1:e=bo.toFullwidth(e);break;case 2:e=bo.spacing(e);break;case 3:e=e.replace(new RegExp(`([${St}]) +([${St}])`,"g"),"$1$2");break;case 4:e=e.replace(/\x20{2,}/g," ");break}return e.replace(/占啊位符/g,"**").replace(/placehder/g,"**")}var Tc=C(S()),vc={name:"AutoFormat",key:"autoformat",intro:Oe.intro,link:x("autoformat"),settings:[{key:"on",type:1,label:Oe.on,auto:{modifyExcerptText:{index:1,method({text:e}){return xo(e)}},modifyTitles({titles:e}){let{formatTitle:t}=self.globalProfile.autoformat;return t?ti(e):e}}},{key:"preset",type:7,option:Oe.preset.$option5,label:Oe.preset.label},{key:"customFormat",type:4,help:Oe.custom_format.help,bind:["preset",0],link:Oe.custom_format.link,check({input:e}){st(e)}},{key:"removeSpace",type:1,label:Oe.remove_space.label,help:Oe.remove_space.help},{key:"formatTitle",type:1,label:Oe.format_title.label,help:Oe.format_title.help,link:Oe.format_title.link}],actions4card:[{key:"formatCard",type:2,label:Oe.format_selected.label,option:Oe.format_selected.$option3,method:({nodes:e,option:t})=>{(0,Tc.undoGroupingWithRefresh)(()=>{e.forEach(o=>{let r=o.title;if(r&&(t===1||t===0)){let n=xo(r);self.globalProfile.autoformat.formatTitle&&(n=ti(n.split(/\s*[;；]\s*/)).join("; ")),o.title=n}(t===2||t===0)&&o.notes.forEach(n=>{let i=n.excerptText;i&&(n.excerptText=xo(i))})})})}}]};var Pc=C(S()),te=(0,Pc.i18n)({zh:{intro:"\u81EA\u52A8\u4FEE\u6539\u6458\u5F55\u989C\u8272\u548C\u6837\u5F0F\u3002",area:"\u9762\u79EF",on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",change_style:{lable:"\u4FEE\u6539\u6458\u5F55\u6837\u5F0F",$option4:["\u4F7F\u7528 AutoStyle \u7684\u8BBE\u7F6E","\u7EBF\u6846+\u586B\u5145","\u586B\u5145","\u7EBF\u6846"]},change_color:{label:"\u4FEE\u6539\u6458\u5F55\u989C\u8272",help:"\u8F93\u5165\u989C\u8272\u7D22\u5F15\uFF0C\u4E5F\u5C31\u662F\u987A\u5E8F\uFF0C1 \u5230 16\u3002",out_of_range:"\u4E0D\u518D\u8303\u56F4\u5185\uFF081,16\uFF09",$option2:["\u4F7F\u7528 AutoStyle \u7684\u8BBE\u7F6E","\u786E\u5B9A"]},preset:{label:"\u9009\u62E9\u9700\u8981\u7684\u9884\u8BBE",$option4:["\u6837\u5F0F\u7531\u5B57\u6570\u6216\u9762\u79EF\u51B3\u5B9A","\u989C\u8272\u8DDF\u968F\u5361\u7247","\u989C\u8272\u8DDF\u968F\u7B2C\u4E00\u4E2A\u5144\u5F1F\u5361\u7247","\u989C\u8272\u8DDF\u968F\u7236\u5361\u7247"]},$style4:["\u65E0","\u7EBF\u6846+\u586B\u5145","\u586B\u5145","\u7EBF\u6846"],$color17:["\u65E0","\u6D45\u9EC4","\u6D45\u7EFF","\u6D45\u84DD","\u6D45\u7EA2","\u9EC4","\u7EFF","\u84DD","\u7EA2","\u6A58","\u6DF1\u7EFF","\u6DF1\u84DD","\u6DF1\u7EA2","\u767D","\u6D45\u7070","\u6DF1\u7070","\u7D2B"],word_count_area:{help:"[\u7C7B\u4E2D\u6587\u5B57\u6570, \u7C7B\u82F1\u6587\u5355\u8BCD\u6570, \u9009\u533A\u9762\u79EF]\uFF0C\u8D85\u8FC7\u5219\u5C06\u6458\u5F55\u6837\u5F0F\u8BBE\u7F6E\u4E3A\u7EBF\u6846\uFF0C\u5426\u5219\u9ED8\u8BA4\u3002",input_array:"\u8BF7\u8F93\u5165\u6570\u7EC4\uFF0C\u6BD4\u5982 [10,5,100]",input_three_number:"\u6570\u7EC4\u5185\u5FC5\u987B\u6709\u4E09\u4E2A\u6570\u5B57\uFF0C\u6BD4\u5982 [10,5,100]"},show_area:"\u663E\u793A\u6458\u5F55\u9762\u79EF",default_text_excerpt_color:"\u6587\u672C\u6458\u5F55\u9ED8\u8BA4\u989C\u8272",default_pic_excerpt_color:"\u9009\u533A\u6458\u5F55\u9ED8\u8BA4\u989C\u8272",default_text_excerpt_style:"\u6587\u672C\u6458\u5F55\u9ED8\u8BA4\u6837\u5F0F",default_pic_excerpt_style:"\u9009\u533A\u6458\u5F55\u9ED8\u8BA4\u6837\u5F0F",enter_positive:"\u8BF7\u8F93\u5165\u6B63\u6574\u6570"},en:{intro:"Auto modify excerpt colors and styles.",on:"Auto Run When Excerpting",area:"Aera",change_style:{lable:"Modify Excerpt Style",$option4:["Use AutoStyle Settings","Outline+Fill","Fill","Outline"]},change_color:{label:"Modify Excerpt Color",help:"Enter the color index, 1 to 16",$option2:["Use AutoStyle Settings","Confirm"],out_of_range:"Out of range\uFF081,16\uFF09"},preset:{label:"Select Presets",$option4:["Style is determined by word count or area","Color follow card","Color follows frist child node","Color follows parent node"]},$style4:["None","Wireframe+Fill","Fill","Wireframe"],$color17:["None","Light Yellow","Light Green","Light Blue","light red","Yellow","Green","Blue","Red","Orange","Dark Green","Dark Blue","Dark Red","White","Light Grey","Dark Grey","Purple"],word_count_area:{help:`[Chinese words, English words, Selected area size], if it exceeds, set the excerpt style to wireframe, otherwise the default.
`,input_array:"Please enter an array, for example [10,5,100]",input_three_number:"There must be three numbers in the array\uFF0Cfor example [10,5,100]"},enter_positive:"Please enter a positive integer",show_area:"Show Excerpt Area",default_text_excerpt_color:"Default Text Excerpt Color",default_pic_excerpt_color:"Default Pic Excerpt Color",default_text_excerpt_style:"Default Text Excerpt Style",default_pic_excerpt_style:"Default Pic Excerpt Style"}});var $c=C(S()),Kt=C(S());function Vh(e){let{width:t,height:o}=(0,Kt.CGSizeValue2CGSize)(e.excerptPic.size);return Math.floor(t*o/1e3)}function qr(e,t=!1){var h,y,k;let{preset:o,showArea:r,wordCountArea:n,defaultPicExcerptColor:i,defaultPicExcerptStyle:l,defaultTextExcerptColor:a,defaultTextExcerptStyle:s}=self.globalProfile.autostyle,c=e.excerptPic?i[0]!==0?i[0]-1:void 0:a[0]!==0?a[0]-1:void 0,u=e.excerptPic?l[0]!==0?l[0]-1:void 0:s[0]!==0?s[0]-1:void 0,p={color:c,style:u};if(o.includes(0)&&n){let[N,P,re]=F(n);if((h=e.excerptPic)!=null&&h.size){let b=Vh(e);b>re&&(p.style=2),r&&(0,Kt.showHUD)(te.area+": "+b)}else if(e.excerptText){let b=(0,Kt.removeHighlight)(e.excerptText);Ft(b)>(ct(b)?P:N)&&(p.style=2)}}let d=new $c.NodeNote(e,t?Kt.MN.currnetNotebookId:void 0).note;for(let N of o)switch(N){case 1:if(d.noteId!==e.noteId)return p.color=d.colorIndex,p;break;case 2:let P=(k=(y=d.parentNote)==null?void 0:y.childNotes)==null?void 0:k.length;if(P&&P>1)return p.color=d.parentNote.childNotes[0].colorIndex,p;break;case 3:if(d.parentNote)return p.color=d.parentNote.colorIndex,p}return p}var oi=C(S()),Ic=te.$color17.map((e,t)=>t?Ne.hollow_circle_number[t-1]+" "+e:e),Nc={name:"AutoStyle",key:"autostyle",intro:te.intro,link:x("autostyle"),settings:[{key:"on",type:1,label:te.on,auto:{modifyStyle({note:e}){return qr(e,!0)}}},{key:"preset",type:7,option:te.preset.$option4,label:te.preset.label},{key:"showArea",type:1,bind:["preset",0],label:te.show_area},{key:"wordCountArea",type:4,bind:["preset",0],help:te.word_count_area.help,check({input:e}){if(e=F(e),!Array.isArray(e))throw te.word_count_area.input_array;if(e.length!==3)throw te.word_count_area.input_three_number;if(e.some(t=>!Number.isInteger(t)))throw te.enter_positive}},{key:"defaultTextExcerptColor",type:6,label:te.default_text_excerpt_color,option:Ic},{key:"defaultTextExcerptStyle",type:6,label:te.default_text_excerpt_style,option:te.$style4},{key:"defaultPicExcerptColor",type:6,label:te.default_pic_excerpt_color,option:Ic},{key:"defaultPicExcerptStyle",type:6,label:te.default_pic_excerpt_style,option:te.$style4}],actions4card:[{type:3,label:te.change_color.label,key:"changeColor",option:te.change_color.$option2,help:te.change_color.help,method({content:e,nodes:t,option:o}){(0,oi.undoGroupingWithRefresh)(()=>{if(o===0)for(let r of t)r.notes.forEach(n=>{let{color:i}=qr(n);i!==void 0&&(n.colorIndex=i!==-1?i:12)});else if(e){let r=Number(e)-1;for(let n of t)n.notes.forEach(i=>{i.colorIndex=r})}})},check({input:e}){let t=Number(e);if(!Number.isInteger(t))throw te.enter_positive;if(t>16||t<1)throw te.change_color.out_of_range}},{type:2,label:te.change_style.lable,key:"changeStyle",option:te.change_style.$option4,method({option:e,nodes:t}){(0,oi.undoGroupingWithRefresh)(()=>{if(e===0)for(let o of t)o.notes.forEach(r=>{let{style:n}=qr(r);n!==void 0&&(r.fillIndex=n)});else{let o=e-1;for(let r of t)r.notes.forEach(n=>{n.fillIndex=o})}})}}]};var Rc=C(S());var Ec=C(S());var pt=(0,Ec.i18n)({zh:{intro:"\u81EA\u52A8\u4ECE\u6458\u5F55\u4E2D\u63D0\u53D6\u6807\u7B7E\u6216\u8005\u5728\u7279\u5B9A\u65F6\u5019\u81EA\u52A8\u6DFB\u52A0\u6807\u7B7E\u3002",link:x("autotag"),on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",preset:{label:"\u9009\u62E9\u9700\u8981\u7684\u9884\u8BBE",$option1:["\u81EA\u5B9A\u4E49"]},add_tag:{label:"\u6DFB\u52A0\u6807\u7B7E",$option2:["\u4F7F\u7528 AutoTag \u7684\u8BBE\u7F6E","\u786E\u5B9A"]},custom_tag:{link:x("autotag","\u81EA\u5B9A\u4E49"),help:"\u81EA\u5B9A\u4E49\uFF0C\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u683C\u5F0F\u3002"}},en:{intro:"Extract tags from excerpts or add tags at specific times Automatically.",link:x("autotag"),on:"Auto Run When Excerpting",preset:{label:"Select Presets",$option1:["Custom"]},add_tag:{label:"Add Tags",$option2:["Use AutoTag Settings","Confirm"]},custom_tag:{link:x("autotag","custom"),help:"Customize. Click for specific formats"}}});function qo(...e){return e.map(t=>t.replace(/#/g," ").replace(/\p{P}+/gu,"_").split(/\s+/)).flat().filter(t=>t)}function Ac(e,t){if(!t)return;let{customTag:o}=self.tempProfile.replaceParam,{preset:r}=self.globalProfile.autotag;if(r.includes(0)&&o)return qo(...Bo(t,o.map(n=>({...n,newSubStr:me(e,n.newSubStr)}))))}var Mc={name:"AutoTag",key:"autotag",intro:pt.intro,link:pt.link,settings:[{key:"on",type:1,label:pt.on,auto:{generateTags({node:e,text:t}){return Ac(e,t)}}},{key:"preset",type:7,option:pt.preset.$option1,label:pt.preset.label},{key:"customTag",type:4,help:pt.custom_tag.help,bind:["preset",0],link:pt.custom_tag.link,check({input:e}){st(e)}}],actions4card:[{type:3,label:pt.add_tag.label,key:"addTag",option:pt.add_tag.$option2,method({nodes:e,option:t,content:o}){(0,Rc.undoGroupingWithRefresh)(()=>{if(t==0)e.forEach(r=>{var l;let n=r.excerptsText.join(`
`);((l=r.note.excerptPic)==null?void 0:l.paint)&&r.isOCR===!1&&(n="@picture");let i=Ac(r,n);i!=null&&i.length&&r.appendTags(...i)});else if(o)if(/^\(.+\)$/.test(o)){let r=xe(o);e.forEach(n=>{var a;let i=n.excerptsText.join(`
`);((a=n.note.excerptPic)==null?void 0:a.paint)&&n.isOCR===!1&&(i="@picture");let l=Bo(i,r.map(s=>({...s,newSubStr:me(n,s.newSubStr)})));n.appendTags(...qo(...l))})}else e.forEach(r=>{r.appendTags(...qo(me(r,F(`${pe(o)}`,!0))))})})},check({input:e}){/^\(.+\)$/.test(e)?Ct(e):We(e)}}]};var Oc=C(S());var V=(0,Oc.i18n)({zh:{intro:"\u6458\u5F55\u65F6\u81EA\u52A8\u7FFB\u8BD1\uFF0C\u4F5C\u4E3A\u8BC4\u8BBA\u6DFB\u52A0\u8FDB\u53BB\u3002",on:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",preset:{label:"\u9009\u62E9\u9700\u8981\u7684\u9884\u8BBE",$option1:["\u81EA\u5B9A\u4E49"]},word_count:"[\u7C7B\u4E2D\u6587\u5B57\u6570\uFF0C\u7C7B\u82F1\u6587\u5355\u8BCD\u6570]\uFF0C\u8D85\u8FC7\u624D\u4F1A\u7FFB\u8BD1\u3002      ",translate_providers:{$option2:["\u767E\u5EA6\u7FFB\u8BD1","\u5F69\u4E91\u5C0F\u8BD1"],label:"\u7FFB\u8BD1\u63D0\u4F9B\u5546"},caiyun_from_lang:{label:"\u8F93\u5165\u8BED\u8A00",$option4:["\u81EA\u52A8\u68C0\u6D4B","\u7B80\u4F53\u4E2D\u6587","\u82F1\u6587","\u65E5\u6587"]},caiyun_to_lang:{label:"\u8F93\u51FA\u8BED\u8A00",$option3:["\u7B80\u4F53\u4E2D\u6587","\u82F1\u6587","\u65E5\u6587"]},no_result:"\u6CA1\u6709\u83B7\u53D6\u5230\u7ED3\u679C",baidu_from_lang:{label:"\u8F93\u5165\u8BED\u8A00",$option29:["\u81EA\u52A8\u68C0\u6D4B","\u7B80\u4F53\u4E2D\u6587","\u82F1\u8BED","\u7CA4\u8BED","\u6587\u8A00\u6587","\u65E5\u8BED","\u97E9\u8BED","\u6CD5\u8BED","\u897F\u73ED\u7259\u8BED","\u6CF0\u8BED","\u963F\u62C9\u4F2F\u8BED","\u4FC4\u8BED","\u8461\u8404\u7259\u8BED","\u5FB7\u8BED","\u610F\u5927\u5229\u8BED","\u5E0C\u814A\u8BED","\u8377\u5170\u8BED","\u6CE2\u5170\u8BED","\u4FDD\u52A0\u5229\u4E9A\u8BED","\u7231\u6C99\u5C3C\u4E9A\u8BED","\u4E39\u9EA6\u8BED","\u82AC\u5170\u8BED","\u6377\u514B\u8BED","\u7F57\u9A6C\u5C3C\u4E9A\u8BED","\u65AF\u6D1B\u6587\u5C3C\u4E9A\u8BED","\u745E\u5178\u8BED","\u5308\u7259\u5229\u8BED","\u7E41\u4F53\u4E2D\u6587","\u8D8A\u5357\u8BED"]},baidu_to_lang:{label:"\u8F93\u51FA\u8BED\u8A00",$option28:["\u7B80\u4F53\u4E2D\u6587","\u82F1\u8BED","\u7CA4\u8BED","\u6587\u8A00\u6587","\u65E5\u8BED","\u97E9\u8BED","\u6CD5\u8BED","\u897F\u73ED\u7259\u8BED","\u6CF0\u8BED","\u963F\u62C9\u4F2F\u8BED","\u4FC4\u8BED","\u8461\u8404\u7259\u8BED","\u5FB7\u8BED","\u610F\u5927\u5229\u8BED","\u5E0C\u814A\u8BED","\u8377\u5170\u8BED","\u6CE2\u5170\u8BED","\u4FDD\u52A0\u5229\u4E9A\u8BED","\u7231\u6C99\u5C3C\u4E9A\u8BED","\u4E39\u9EA6\u8BED","\u82AC\u5170\u8BED","\u6377\u514B\u8BED","\u7F57\u9A6C\u5C3C\u4E9A\u8BED","\u65AF\u6D1B\u6587\u5C3C\u4E9A\u8BED","\u745E\u5178\u8BED","\u5308\u7259\u5229\u8BED","\u7E41\u4F53\u4E2D\u6587","\u8D8A\u5357\u8BED"]},baidu_thesaurus:{label:"\u81EA\u5B9A\u4E49\u672F\u8BED\u5E93",help:"\u767E\u5EA6\u7FFB\u8BD1\u9AD8\u7EA7\u7248\u53EF\u7528\uFF0C\u4EC5\u652F\u6301\u4E2D\u82F1\u4E92\u8BD1\uFF0C\u70B9\u51FB\u65B0\u5EFA\u81EA\u5B9A\u4E49\u672F\u8BED\u3002",link:"https://fanyi-api.baidu.com/manage/term"},$show_key2:["\u70B9\u51FB\u67E5\u770B\u5BC6\u94A5\uFF0C\u4E0D\u8981\u8BA9\u5176\u4ED6\u4EBA\u770B\u5230","\u70B9\u51FB\u9690\u85CF\u5BC6\u94A5\uFF0C\u4E0D\u8981\u8BA9\u5176\u4ED6\u4EBA\u770B\u5230"],baidu_app_id:{help:"\u767E\u5EA6 App ID\uFF0C\u70B9\u51FB\u67E5\u770B\u5982\u4F55\u83B7\u53D6\u3002",link:x("autotranslate","\u767E\u5EA6\u7FFB\u8BD1")},baidu_secret_key:"\u767E\u5EA6\u5BC6\u94A5",caiyun_token:{help:"\u5F69\u4E91\u5C0F\u8BD1 Token\uFF0C\u70B9\u51FB\u67E5\u770B\u5982\u4F55\u83B7\u53D6\u3002",link:x("autotranslate","\u5F69\u4E91\u5C0F\u8BD1")},translate_card:{label:"\u7FFB\u8BD1\u6458\u5F55\u5185\u5BB9",help:"\u4F1A\u7FFB\u8BD1\u5361\u7247\u4E2D\u6240\u6709\u7684\u6458\u5F55\uFF0C\u6CE8\u610F\u4E0D\u8981\u540C\u65F6\u7FFB\u8BD1\u592A\u591A\u5185\u5BB9\u3002"},loading:"\u6B63\u5728\u7FFB\u8BD1...",translate_text:"\u7FFB\u8BD1\u9009\u4E2D\u6587\u5B57",no_baidu_app_id:"\u6CA1\u6709\u8BBE\u7F6E\u767E\u5EA6\u7FFB\u8BD1\u7684 App ID",no_baidu_secret_key:"\u6CA1\u6709\u8BBE\u7F6E\u767E\u5EA6\u7FFB\u8BD1\u7684\u5BC6\u94A5",no_caiyun_token:"\u6CA1\u6709\u8BBE\u7F6E\u5F69\u4E91\u5C0F\u8BD1\u7684 Token"},en:{intro:"Translate selected text or card content.",on:"Auto Run When Excerpting",preset:{label:"Select Preset",$option1:["Custom"]},word_count:"[Chinese words, English words], if exceeded, then translate.",translate_providers:{$option2:["Baidu Translate","LingoCloud Translate"],label:"Translate Providers"},caiyun_from_lang:{label:"Input Language",$option4:["Auto Detect","Simplified Chinese","English","Japanese"]},caiyun_to_lang:{label:"Output Language",$option3:["Simplified Chinese","English","Japanese"]},no_result:"No Result",baidu_from_lang:{label:"Input Language",$option29:["Auto Detect","Simplified Chinese","English","Cantonese","Classical Chinese","Japanese","Korean","French","Spanish","Thai","Arabic","Russian","Portuguese","German","Italian","Greek","Dutch","Polish","Bulgarian","Estonian","Danish","Finnish","Czech","Romanian","Slovenian","Swedish","Hungarian","Traditional Chinese","Vietnamese"]},translate_card:{label:"Translate Excerpt Text",help:"Translate all excerpts in the card, note that too many translations at the same time may cause the translation to fail."},baidu_to_lang:{label:"Output Language",$option28:["Simplified Chinese","English","Cantonese","Classical Chinese","Japanese","Korean","French","Spanish","Thai","Arabic","Russian","Portuguese","German","Italian","Greek","Dutch","Polish","Bulgarian","Estonian","Danish","Finnish","Czech","Romanian","Slovenian","Swedish","Hungarian","Traditional Chinese","Vietnamese"]},baidu_thesaurus:{label:"Custom Thesaurus",help:"Only available in Baidu Translate Pro, only supports Chinese-English translation, click to create a custom thesaurus.",link:"https://fanyi-api.baidu.com/manage/term"},$show_key2:["Click to show secret key","Click to hide secret key"],baidu_app_id:{help:"Baidu Translate App ID, click to view how to get it.",link:x("autotranslate","baidu-translate")},baidu_secret_key:"Baidu Fanyi Secret Key",caiyun_token:{help:"LingoCloud Translate Token, click to view how to get it.",link:x("autotranslate","lingocloud-translate")},translate_text:"Translate Selected Text",loading:"Translating...",no_baidu_app_id:"No Baidu Fanyi App ID",no_baidu_secret_key:"No Baidu Fanyi Secret Key",no_caiyun_token:"No Caiyun Translate Token"}});var zo=C(S());var Kh=function(e){function t(A,E){return A<<E|A>>>32-E}function o(A,E){var U,Z,fe,_e,ue;return fe=A&2147483648,_e=E&2147483648,U=A&1073741824,Z=E&1073741824,ue=(A&1073741823)+(E&1073741823),U&Z?ue^2147483648^fe^_e:U|Z?ue&1073741824?ue^3221225472^fe^_e:ue^1073741824^fe^_e:ue^fe^_e}function r(A,E,U){return A&E|~A&U}function n(A,E,U){return A&U|E&~U}function i(A,E,U){return A^E^U}function l(A,E,U){return E^(A|~U)}function a(A,E,U,Z,fe,_e,ue){return A=o(A,o(o(r(E,U,Z),fe),ue)),o(t(A,_e),E)}function s(A,E,U,Z,fe,_e,ue){return A=o(A,o(o(n(E,U,Z),fe),ue)),o(t(A,_e),E)}function c(A,E,U,Z,fe,_e,ue){return A=o(A,o(o(i(E,U,Z),fe),ue)),o(t(A,_e),E)}function u(A,E,U,Z,fe,_e,ue){return A=o(A,o(o(l(E,U,Z),fe),ue)),o(t(A,_e),E)}function p(A){for(var E,U=A.length,Z=U+8,fe=(Z-Z%64)/64,_e=(fe+1)*16,ue=Array(_e-1),gr=0,yt=0;yt<U;)E=(yt-yt%4)/4,gr=yt%4*8,ue[E]=ue[E]|A.charCodeAt(yt)<<gr,yt++;return E=(yt-yt%4)/4,gr=yt%4*8,ue[E]=ue[E]|128<<gr,ue[_e-2]=U<<3,ue[_e-1]=U>>>29,ue}function f(A){var E="",U="",Z,fe;for(fe=0;fe<=3;fe++)Z=A>>>fe*8&255,U="0"+Z.toString(16),E=E+U.substr(U.length-2,2);return E}function d(A){A=A.replace(/\r\n/g,`
`);for(var E="",U=0;U<A.length;U++){var Z=A.charCodeAt(U);Z<128?E+=String.fromCharCode(Z):Z>127&&Z<2048?(E+=String.fromCharCode(Z>>6|192),E+=String.fromCharCode(Z&63|128)):(E+=String.fromCharCode(Z>>12|224),E+=String.fromCharCode(Z>>6&63|128),E+=String.fromCharCode(Z&63|128))}return E}var h=[],y,k,N,P,re,b,m,w,_,X=7,at=12,or=17,rr=22,nr=5,ir=9,lr=14,ar=20,sr=4,cr=11,ur=16,pr=23,fr=6,dr=10,mr=15,hr=21;for(e=d(e),h=p(e),b=1732584193,m=4023233417,w=2562383102,_=271733878,y=0;y<h.length;y+=16)k=b,N=m,P=w,re=_,b=a(b,m,w,_,h[y+0],X,3614090360),_=a(_,b,m,w,h[y+1],at,3905402710),w=a(w,_,b,m,h[y+2],or,606105819),m=a(m,w,_,b,h[y+3],rr,3250441966),b=a(b,m,w,_,h[y+4],X,4118548399),_=a(_,b,m,w,h[y+5],at,1200080426),w=a(w,_,b,m,h[y+6],or,2821735955),m=a(m,w,_,b,h[y+7],rr,4249261313),b=a(b,m,w,_,h[y+8],X,1770035416),_=a(_,b,m,w,h[y+9],at,2336552879),w=a(w,_,b,m,h[y+10],or,4294925233),m=a(m,w,_,b,h[y+11],rr,2304563134),b=a(b,m,w,_,h[y+12],X,1804603682),_=a(_,b,m,w,h[y+13],at,4254626195),w=a(w,_,b,m,h[y+14],or,2792965006),m=a(m,w,_,b,h[y+15],rr,1236535329),b=s(b,m,w,_,h[y+1],nr,4129170786),_=s(_,b,m,w,h[y+6],ir,3225465664),w=s(w,_,b,m,h[y+11],lr,643717713),m=s(m,w,_,b,h[y+0],ar,3921069994),b=s(b,m,w,_,h[y+5],nr,3593408605),_=s(_,b,m,w,h[y+10],ir,38016083),w=s(w,_,b,m,h[y+15],lr,3634488961),m=s(m,w,_,b,h[y+4],ar,3889429448),b=s(b,m,w,_,h[y+9],nr,568446438),_=s(_,b,m,w,h[y+14],ir,3275163606),w=s(w,_,b,m,h[y+3],lr,4107603335),m=s(m,w,_,b,h[y+8],ar,1163531501),b=s(b,m,w,_,h[y+13],nr,2850285829),_=s(_,b,m,w,h[y+2],ir,4243563512),w=s(w,_,b,m,h[y+7],lr,1735328473),m=s(m,w,_,b,h[y+12],ar,2368359562),b=c(b,m,w,_,h[y+5],sr,4294588738),_=c(_,b,m,w,h[y+8],cr,2272392833),w=c(w,_,b,m,h[y+11],ur,1839030562),m=c(m,w,_,b,h[y+14],pr,4259657740),b=c(b,m,w,_,h[y+1],sr,2763975236),_=c(_,b,m,w,h[y+4],cr,1272893353),w=c(w,_,b,m,h[y+7],ur,4139469664),m=c(m,w,_,b,h[y+10],pr,3200236656),b=c(b,m,w,_,h[y+13],sr,681279174),_=c(_,b,m,w,h[y+0],cr,3936430074),w=c(w,_,b,m,h[y+3],ur,3572445317),m=c(m,w,_,b,h[y+6],pr,76029189),b=c(b,m,w,_,h[y+9],sr,3654602809),_=c(_,b,m,w,h[y+12],cr,3873151461),w=c(w,_,b,m,h[y+15],ur,530742520),m=c(m,w,_,b,h[y+2],pr,3299628645),b=u(b,m,w,_,h[y+0],fr,4096336452),_=u(_,b,m,w,h[y+7],dr,1126891415),w=u(w,_,b,m,h[y+14],mr,2878612391),m=u(m,w,_,b,h[y+5],hr,4237533241),b=u(b,m,w,_,h[y+12],fr,1700485571),_=u(_,b,m,w,h[y+3],dr,2399980690),w=u(w,_,b,m,h[y+10],mr,4293915773),m=u(m,w,_,b,h[y+1],hr,2240044497),b=u(b,m,w,_,h[y+8],fr,1873313359),_=u(_,b,m,w,h[y+15],dr,4264355552),w=u(w,_,b,m,h[y+6],mr,2734768916),m=u(m,w,_,b,h[y+13],hr,1309151649),b=u(b,m,w,_,h[y+4],fr,4149444226),_=u(_,b,m,w,h[y+11],dr,3174756917),w=u(w,_,b,m,h[y+2],mr,718787259),m=u(m,w,_,b,h[y+9],hr,3951481745),b=o(b,k),m=o(m,N),w=o(w,P),_=o(_,re);var Mu=f(b)+f(m)+f(w)+f(_);return Mu.toLowerCase()},Dc=Kh;function qh(e,t,o,r){return Dc(t+e+r+o)}async function zr(e,t,o){let{baiduAppID:r,baiduSecretKey:n,baiduThesaurus:i}=self.globalProfile.autotranslate;if(!r)throw V.no_baidu_app_id;if(!n)throw V.no_baidu_secret_key;if([1,3,4,5,6,27].includes(t)&&!Fo.CJK(e))return"";if(t===11&&!Fo.Cyrillic(e))return"";if([2,7,8,12,13,14,15,16,17].includes(t)&&!Fo.Latin(e))return"";let l=["auto","zh","en","yue","wyw","jp","kor","fra","spa","th","ara","ru","pt","de","it","el","nl","pl","bul","est","dan","fin","cs","rom","slo","swe","hu","cht","vie"],a=l.slice(1),s=Date.now();e=e.replace(/\n/g,"");let c=qh(e,r,n,s),u=await(0,zo.fetch)("https://fanyi-api.baidu.com/api/trans/vip/translate",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},form:{sign:c,salt:s,q:e,appid:r,from:l[t],to:a[o],action:i?1:0}}).then(p=>p.json());if(u.error_code&&u.error_msg)throw`${u.error_code}: ${u.error_msg}`;return u.trans_result.map(p=>p.dst).join(`
`)}async function Hr(e,t,o){let{caiyunToken:r}=self.globalProfile.autotranslate;if(r){if([1,3].includes(t)&&!Fo.CJK(e))return"";if(t===2&&!/\w+/.test(e))return""}else throw V.no_caiyun_token;let n=["auto","zh","en","ja"],i=n.slice(1),l=await(0,zo.fetch)("http://api.interpreter.caiyunai.com/v1/translator",{method:"POST",headers:{"X-Authorization":`token ${r}`},json:{source:[e],trans_type:`${n[t]}2${i[o]}`,request_id:"ohmymn",detect:!0}}).then(a=>a.json());if(!l.target.length)throw V.no_result;return l.target.join(`
`)}async function Lc(e){try{let{translateProviders:t,wordCount:o,baiduFromLang:r,baiduToLang:n,caiyunFromLang:i,caiyunToLang:l}=self.globalProfile.autotranslate;if(o){let[s,c]=F(o);if(Ft(e)<=(ct(e)?c:s))return}return[t[0]===0?await zr(e,r[0],n[0]):await Hr(e,i[0],l[0])]}catch(t){(0,zo.showHUD)(String(t),2);return}}var jt=C(S()),Bc={name:"AutoTranslate",key:"autotranslate",intro:V.intro,link:x("autotranslate"),settings:[{key:"on",type:1,label:V.on,auto:{generateComments:{index:-1,method({text:e}){return Lc(e)}}}},{key:"wordCount",type:4,help:V.word_count},{key:"translateProviders",type:6,option:V.translate_providers.$option2,label:V.translate_providers.label},{key:"caiyunFromLang",type:6,label:V.caiyun_from_lang.label,option:V.caiyun_from_lang.$option4,bind:["translateProviders",1]},{key:"caiyunToLang",type:6,label:V.caiyun_to_lang.label,option:V.caiyun_to_lang.$option3,bind:["translateProviders",1]},{key:"baiduFromLang",type:6,label:V.baidu_from_lang.label,option:V.baidu_from_lang.$option29,bind:["translateProviders",0]},{key:"baiduToLang",type:6,label:V.baidu_to_lang.label,option:V.baidu_to_lang.$option28,bind:["translateProviders",0]},{key:"baiduThesaurus",type:1,label:V.baidu_thesaurus.label,help:V.baidu_thesaurus.help,link:V.baidu_thesaurus.link,bind:["translateProviders",0]},{key:"showKey",type:8,label:V.$show_key2},{key:"baiduAppID",type:4,help:V.baidu_app_id.help,link:V.baidu_app_id.link,bind:[["showKey",!0],["translateProviders",0]]},{key:"baiduSecretKey",type:4,help:V.baidu_secret_key,bind:[["showKey",!0],["translateProviders",0]]},{key:"caiyunToken",type:4,help:V.caiyun_token.help,link:V.caiyun_token.link,bind:[["showKey",!0],["translateProviders",1]]}],actions4card:[{key:"translateCard",type:2,label:V.translate_card.label,help:V.translate_card.help,method:async({nodes:e})=>{try{let a=function(c){try{return c?o[0]===0?zr(c,r[0],n[0]):Hr(c,i[0],l[0]):""}catch{return""}};var t=a;let{translateProviders:o,baiduFromLang:r,baiduToLang:n,caiyunFromLang:i,caiyunToLang:l}=self.globalProfile.autotranslate,s=[];jt.HUDController.show(V.loading);for(let c of e)s.push(await Promise.all(c.notes.map(u=>a(u.excerptText))));(0,jt.undoGroupingWithRefresh)(()=>{e.forEach((c,u)=>{let p=s[u];p.length&&c.removeCommentButLinkTag(()=>!0,f=>{self.globalProfile.addon.useMarkdown?f.appendMarkdownComments(...p):f.appendTextComments(...p)})})}),jt.HUDController.hidden()}catch(o){(0,jt.showHUD)(String(o),2)}}}],actions4text:[{key:"translateText",type:2,label:V.translate_text,method:async({text:e})=>{try{let{translateProviders:t,baiduFromLang:o,baiduToLang:r,caiyunFromLang:n,caiyunToLang:i}=self.globalProfile.autotranslate;return t[0]===0?await zr(e,o[0],r[0]):await Hr(e,n[0],i[0])}catch(t){(0,jt.showHUD)(String(t),2)}}}]};var Jo=C(S());var Uc=C(S());var q=(0,Uc.i18n)({zh:{intro:"\u641C\u7D22\u548C\u590D\u5236\u4F60\u60F3\u8981\u7684\u3002",which_partof_card:{label:"\u9ED8\u8BA4\u641C\u7D22\u5361\u7247\u5185\u5BB9",$option4:["\u52A8\u6001\u9009\u62E9","\u4F18\u5148\u6807\u9898","\u4F18\u5148\u6458\u5F55","\u81EA\u5B9A\u4E49"],help:"\u82E5\u4F18\u5148\u7684\u5185\u5BB9\u4E3A\u7A7A\uFF0C\u5219\u6309\u7167\u6807\u9898 > \u6458\u5F55 > \u81EA\u5B9A\u4E49\u7684\u987A\u5E8F\u9012\u63A8\u3002\u9009\u4E2D\u591A\u5F20\u5361\u7247\u65F6\u9012\u63A8\u65E0\u6548\u3002"},multiple_titles:{label:"> \u5982\u679C\u6709\u591A\u4E2A\u6807\u9898",$option3:["\u52A8\u6001\u9009\u62E9","\u6240\u6709\u6807\u9898","\u7B2C\u4E00\u4E2A"]},multiple_excerpts:{label:"> \u5982\u679C\u6709\u591A\u4E2A\u6458\u5F55",$option3:["\u52A8\u6001\u9009\u62E9","\u6240\u6709\u6458\u5F55","\u7B2C\u4E00\u4E2A"]},muiltple_cards:{$option3:["\u6807\u9898","\u6458\u5F55","\u81EA\u5B9A\u4E49"]},show_search_engine:{help:"\u70B9\u51FB\u67E5\u770B\u5982\u4F55\u81EA\u5B9A\u4E49 URL\u3002",$label2:["\u70B9\u51FB\u5C55\u5F00\u6240\u6709\u641C\u7D22\u5F15\u64CE","\u70B9\u51FB\u6536\u8D77\u6240\u6709\u641C\u7D22\u5F15\u64CE"],link:x("copysearch","\u641C\u7D22-url")},modify_symbols:{help:"\u9009\u4E2D\u591A\u5F20\u5361\u7247\u65F6\uFF0C\u4E3A\u6BCF\u5F20\u5361\u7247\u7684\u5185\u5BB9\u6DFB\u52A0\u524D\u540E\u4FEE\u9970\uFF0C\u9ED8\u8BA4\u6DFB\u52A0\u5E8F\u53F7\u548C\u6362\u884C\uFF08$&\u4EE3\u8868\u6BCF\u4E00\u6BB5\uFF09\uFF0C\u70B9\u51FB\u67E5\u770B\u81EA\u5B9A\u4E49\u65B9\u6CD5\u3002",link:x("copysearch","\u591A\u5F20\u5361\u7247")},$search_engine7:["\u4E2D\u6587","\u82F1\u6587","\u8BCD\u5178","\u7FFB\u8BD1","\u5B66\u672F","\u95EE\u9898","\u5176\u4ED6"],custom_copy:{link:x("copysearch","\u81EA\u5B9A\u4E49"),help:"\u81EA\u5B9A\u4E49\u590D\u5236\u7684\u5185\u5BB9\uFF0C\u70B9\u51FB\u67E5\u770B\u652F\u6301\u54EA\u4E9B\u53D8\u91CF\u3002"},custom_search:{link:x("copysearch","\u81EA\u5B9A\u4E49"),help:"\u81EA\u5B9A\u4E49\u641C\u7D22\u7684\u5185\u5BB9\uFF0C\u70B9\u51FB\u67E5\u770B\u652F\u6301\u54EA\u4E9B\u53D8\u91CF\u3002"},search_card_info:"\u641C\u7D22\u5361\u7247\u5185\u5BB9",copy_card_info:"\u590D\u5236\u5361\u7247\u5185\u5BB9",search_text:"\u641C\u7D22\u9009\u4E2D\u6587\u5B57",not_get_title:"\u6CA1\u6709\u83B7\u53D6\u5230\u6807\u9898",not_get_excerpt:"\u6CA1\u6709\u83B7\u53D6\u5230\u6458\u5F55\uFF0C\u4F60\u770B\u5230\u7684\u53EF\u80FD\u662F\u8BC4\u8BBA",choose_search_engine:"\u672C\u6B21\u4F7F\u7528\u54EA\u4E00\u4E2A\u641C\u7D22\u5F15\u64CE",copy_seccess:"\u590D\u5236\u6210\u529F\uFF0C\u5FEB\u53BB\u7C98\u8D34\u5427",one_card_search:"\u9ED8\u8BA4\u641C\u7D22\u7B2C\u4E00\u5F20\u5361\u7247\u7684\u5185\u5BB9\uFF0C\u8BF7\u4E0D\u8981\u9009\u62E9\u591A\u5F20\u5361\u7247",no_search_engine_url:"\u6CA1\u6709\u586B\u5199\u6B64\u641C\u7D22\u5F15\u64CE\u7684 URL",no_keyword:"\u7F3A\u5C11 {{keyword}}",choose_you_want:"\u8BF7\u9009\u62E9\u4E00\u4E2A\u4F60\u60F3\u8981\u7684"},en:{intro:"Copy and search for what you want.",which_partof_card:{label:"Default Content To Search",$option4:["Dynamic Selection","Title First","Excerpt First","Custom"],help:"If the first content is empty, it will get the content in the order of Title > Excerpt > Custom. Not valid when multiple cards are selected"},multiple_titles:{label:"> If Multiple Titles",$option3:["All","First","Dynamic Selection"]},multiple_excerpts:{label:"> If Multiple Excerpts",$option3:["All","First","Dynamic Selection"]},muiltple_cards:{$option3:["Title","Excerpt","Custom"]},search_card_info:"Search Card Content",copy_card_info:"Copy Card Content",search_text:"Search Selected Text",$search_engine7:["Chinese","English","Dict","Translation","Academic","Question","Other"],show_search_engine:{help:"Click to see how to customize the URL",$label2:["Show All Search Engines","Hide All Search Engines"],link:x("copysearch","search-url")},modify_symbols:{help:"Add prefix and suffix to the content of each card when multiple cards are selected, and add a number and a newline by default ($& represents each paragraph). Click to see how to customize it.",link:x("copysearch","multiple-cards")},custom_copy:{link:x("copysearch","custom"),help:"Customize what you copy, click to see which variables are supported"},custom_search:{link:x("copysearch","custom"),help:"Customize what you search, click to see which variables are supported"},not_get_title:"No title found",not_get_excerpt:"No excerpt text found. What you see may be comments",choose_search_engine:"Which search engine to use this time",copy_seccess:"Copy successfully, go ahead and paste",one_card_search:"Default search the content of the first card, please do not select more than one card",no_search_engine_url:"No URL of this search engine",no_keyword:"Missing {{keyword}}",choose_you_want:"Choose one you want"}});var ft=C(S());async function Ho(e,t,o=!1){let{multipleTitles:r,multipleExcerpts:n}=self.globalProfile.copysearch;if(e.length!==0)switch(t==="title"?r[0]:n[0]){case 1:{let i=e.join(t==="title"?"; ":`
`);return o?[i]:e.join(i)}case 2:return o?[e[0]]:e[0];default:return o?e:e.length===1?e[0]:(await(0,ft.select)(e,g.title,q.choose_you_want)).value}}function Fc(e,t){let{customContent:o,customSearchContent:r}=self.globalProfile.copysearch,n=t==="copy"?o:r;if(!n)return;let i=F(`${pe(n)}`,!0);return me(e,i)}async function ri(e,t,o){var l,a,s,c,u;let r=e.titles,n=e.excerptsText.map(p=>(0,ft.removeHighlight)(p)),i=Fc(e,o);switch(t){case 1:{let p=(a=(l=await Ho(r,"title"))!=null?l:await Ho(n,"excerpt"))!=null?a:i;if(p)return p;break}case 2:{let p=(s=await Ho(n,"excerpt"))!=null?s:i;if(p)return p;break}case 3:{let p=i;if(p)return p;break}default:{let p=[...(c=await Ho(r,"title",!0))!=null?c:[],...(u=await Ho(n,"excerpt",!0))!=null?u:[]];return i&&p.push(i),p.length===1?p[0]:(await(0,ft.select)(p,g.title,q.choose_you_want)).value}}}function ni(e,t,o){switch(t){case 0:{let{multipleTitles:r}=self.globalProfile.copysearch;return e.reduce((n,i)=>{let l=i.titles;return l.length&&(r[0]===2?n.push(...l):n.push(...l)),n},[])}case 1:{let{multipleTitles:r}=self.globalProfile.copysearch;return e.reduce((n,i)=>{let l=i.excerptsText.map(a=>(0,ft.removeHighlight)(a));return l.length&&(r[0]===2?n.push(l[0]):n.push(l.join(`
`))),n},[])}default:return e.reduce((r,n)=>{let i=Fc(n,o);return i&&r.push(i),r},[])}}async function Jr(e,t){let{searchAcademic:o,searchChineseText:r,searchEnglishText:n,searchOtherText:i,searchQuestion:l,searchTranslation:a,searchWord:s}=self.globalProfile.copysearch,c=[r,n,s,a,o,l,i][t];c?(0,ft.openURL)(c.replace("{{keyword}}",encodeURIComponent(e))):(0,ft.showHUD)(q.no_search_engine_url,2)}var Gc={name:"CopySearch",key:"copysearch",intro:q.intro,link:x("copysearch"),settings:[{label:q.which_partof_card.label,key:"whichPartofCard",type:6,option:q.which_partof_card.$option4,help:q.which_partof_card.help},{label:q.multiple_titles.label,key:"multipleTitles",type:6,option:q.multiple_titles.$option3},{label:q.multiple_excerpts.label,key:"multipleExcerpts",type:6,option:q.multiple_excerpts.$option3},{key:"modifySymbols",type:4,help:q.modify_symbols.help,link:q.modify_symbols.link,check({input:e}){if(We(e),!e.includes("$&"))throw"\u7F3A\u5C11 $&"}},{help:q.custom_copy.help,type:4,key:"customContent",link:q.custom_copy.link,check({input:e}){We(e)}},{help:q.custom_search.help,type:4,key:"customSearchContent",link:q.custom_search.link,check({input:e}){We(e)}},{label:q.show_search_engine.$label2,key:"showSearchEngine",type:8},...["searchChineseText","searchEnglishText","searchWord","searchTranslation","searchAcademic","searchQuestion","searchOtherText"].map((e,t)=>({type:4,help:q.$search_engine7[t],key:e,bind:["showSearchEngine",!0],check({input:o}){if(!o.includes("{{keyword}}"))throw q.no_keyword}}))],actions4card:[{type:2,key:"searchCardInfo",label:q.search_card_info,option:q.$search_engine7,async method({nodes:e,option:t}){if(e.length==1){let{whichPartofCard:o}=self.globalProfile.copysearch,r=await ri(e[0],o[0],"search");r&&Jr(r,t)}else{let{modifySymbols:o,whichPartofCard:r}=self.globalProfile.copysearch,n=r[0],[i,l]=F(`${pe(o)}`,!0).split("$&");if(r[0]===0){let{index:s}=await(0,Jo.select)(q.muiltple_cards.$option3,g.title,q.choose_you_want);n=s}else n-=1;let a=ni(e,n,"search");a!=null&&a.length&&Jr((s=>{if(/%\[.+\]/.test(i)){let c=ot(i,s.length);return s.map((u,p)=>i.replace(/%\[(.+)\]/,c[p])+u).join(l)}return s.map(c=>i+c).join(l)})(a),t)}}},{type:2,key:"copyCardInfo",label:q.copy_card_info,option:q.which_partof_card.$option4,async method({nodes:e,option:t}){if(e.length==1){let o=await ri(e[0],t,"copy");(0,Jo.copy)(o)}else{let{modifySymbols:o}=self.globalProfile.copysearch,[r,n]=F(`${pe(o)}`,!0).split("$&"),i=ni(e,t,"copy");(0,Jo.copy)((l=>{if(/%\[.+\]/.test(r)){let a=ot(r,l.length);return l.map((s,c)=>r.replace(/%\[(.+)\]/,a[c])+s).join(n)}return l.map(a=>r+a).join(n)})(i))}}}],actions4text:[{type:2,key:"searchText",label:q.search_text,option:q.$search_engine7,method({text:e,option:t}){e&&Jr(e,t)}}]};var Vc=C(S());var _o=C(S());var Xr=class{constructor(t){this.cache={};this.dict=t}getDictionary(t,o={}){let{reverse:r}=o,n=r?`R_${t}`:t;return this.cache[n]||(this.cache[n]=this.dict[t].reduce((l,a)=>{let s=o.reverse?1:0;return l[a[s]]=a[1-s],l},{}))}translate(t,o){let r=Object.keys(o).reduce((i,l)=>Math.max(i,l.length),0),n=[];for(let i=0,{length:l}=t;i<l;i++){let a;for(let s=r;s>0;s--){let c=t.substr(i,s);if(Object.hasOwnProperty.call(o,c)){i+=s-1,n.push(o[c]),a=1;break}}!a&&n.push(t[i])}return n.join("")}convertChain(t,o){return o.reduce((r,n)=>{let i=n.slice();return i.splice(0,0,{}),this.translate(r,Object.assign.apply(null,i))},t)}traditionalToSimplified(t){return this.convertChain(t,[[this.getDictionary("TSPhrases"),this.getDictionary("TSCharacters")]])}hongKongToSimplified(t){return this.convertChain(t,[[this.getDictionary("HKVariantsRevPhrases"),this.getDictionary("HKVariants",{reverse:!0})],[this.getDictionary("TSPhrases"),this.getDictionary("TSCharacters")]])}taiwanToSimplified(t){return this.convertChain(t,[[this.getDictionary("TWVariantsRevPhrases"),this.getDictionary("TWVariants",{reverse:!0})],[this.getDictionary("TSPhrases"),this.getDictionary("TSCharacters")]])}taiwanToSimplifiedWithPhrases(t){return this.convertChain(t,[[this.getDictionary("TWVariantsRevPhrases"),this.getDictionary("TWVariants",{reverse:!0})],[this.getDictionary("TWPhrasesIT",{reverse:!0}),this.getDictionary("TWPhrasesName",{reverse:!0}),this.getDictionary("TWPhrasesOther",{reverse:!0})],[this.getDictionary("TSPhrases"),this.getDictionary("TSCharacters")]])}};var Wc=C(S());var Ye=(0,Wc.i18n)({zh:{intro:"\u81EA\u52A8\u5C06\u6458\u5F55\u8F6C\u6362\u4E3A\u7B80\u4F53\u4E2D\u6587\u3002",on:{label:"\u6458\u5F55\u65F6\u81EA\u52A8\u6267\u884C",help:"\u3010\u4EC5\u5F53\u524D\u6587\u6863\u3011"},variant:{label:"\u5F02\u4F53\u5B57\u8F6C\u6362",$option3:["\u4E2D\u56FD\u5927\u9646","\u4E2D\u56FD\u53F0\u6E7E","\u4E2D\u56FD\u9999\u6E2F"]},taiwan_idiom:{label:"\u53F0\u6E7E\u7279\u6B8A\u7528\u8BCD\u8F6C\u6362"},custom_simplify:{help:"\u81EA\u5B9A\u4E49\u8F6C\u6362\uFF0C\u70B9\u51FB\u67E5\u770B\u81EA\u5B9A\u4E49\u65B9\u6CD5\u3002",link:x("autosimplify","\u81EA\u5B9A\u4E49")},simplify_card:{label:"\u8F6C\u6362\u4E3A\u7B80\u4F53\u4E2D\u6587",$option3:["\u6458\u5F55\u548C\u6807\u9898","\u4EC5\u6458\u5F55","\u4EC5\u6807\u9898"]},simplify_text:"\u8F6C\u6362\u4E3A\u7B80\u4F53\u4E2D\u6587"},en:{intro:"Automatically convert the excerpt to Simplified Chinese.",on:{label:"Auto Run When Excerpting",help:"[Only Current Document]"},variant:{label:"Variant Conversion",$option3:["Mainland China","Taiwan China","Hong Kong China"]},taiwan_idiom:{label:"Taiwan Special Word Conversion"},custom_simplify:{help:"Custom conversion, click to get how to customize.",link:x("autosimplify","custom")},simplify_card:{label:"Convert to Simplified Chinese",$option3:["Excerpt and Title","Only Excerpt","Only Title"]},simplify_text:"Convert to Simplified Chinese"}});function wo(e){var t;try{if(!g.dataAutoSimplify){if(!(0,_o.isfileExists)(g.path+"/AutoSimplifyData.json"))throw"AutoSimplifyData.json not found";g.dataAutoSimplify=new Xr((0,_o.readJSON)(g.path+"/AutoSimplifyData.json"))}let{taiwanIdiom:o,variant:r}=self.globalProfile.autosimplify,n=(()=>r[0]===1?o?g.dataAutoSimplify.taiwanToSimplifiedWithPhrases(e):g.dataAutoSimplify.taiwanToSimplified(e):r[0]===2?g.dataAutoSimplify.hongKongToSimplified(e):g.dataAutoSimplify.traditionalToSimplified(e))(),{customSimplify:i}=self.tempProfile.replaceParam;return(t=i==null?void 0:i.reduce((l,a)=>l.replace(a.regexp,a.newSubStr),n))!=null?t:n}catch(o){return Vc.MN.error(o),e}}var Kc={name:"AutoSimplify",key:"autosimplify",intro:Ye.intro,link:x("autosimplify"),settings:[{key:"on",type:1,label:Ye.on.label,help:Ye.on.help,auto:{modifyExcerptText:{index:0,method({text:e}){return wo(e)}}}},{key:"variant",type:6,label:Ye.variant.label,option:Ye.variant.$option3},{key:"taiwanIdiom",type:1,label:Ye.taiwan_idiom.label,bind:["variant",1]},{key:"customSimplify",type:4,help:Ye.custom_simplify.help,link:Ye.custom_simplify.link}],actions4card:[{type:2,label:Ye.simplify_card.label,key:"simplifyCard",option:Ye.simplify_card.$option3,method:({nodes:e,option:t})=>{(0,_o.undoGroupingWithRefresh)(()=>{e.forEach(o=>{(t==0||t==1)&&o.notes.forEach(r=>{let n=r.excerptText;n&&(r.excerptText=wo(n))}),(t==0||t==2)&&o.title&&(o.title=wo(o.title))})})}}],actions4text:[{type:2,label:Ye.simplify_card.label,key:"simplifyText",method:({text:e})=>wo(e)}]};var jc=C(S());var Se=(0,jc.i18n)({zh:{intro:"\u901A\u8FC7 URL Scheme \u6765\u89E6\u53D1 MagicAction \u4E2D\u7684\u52A8\u4F5C\uFF0C\u4F60\u53EF\u4EE5\u8BBE\u7F6E\u5FEB\u6377\u952E\u6765\u6253\u5F00 URL\u3002\u8BE5\u529F\u80FD\u5B8C\u5168\u7531 OhMyMN \u63D0\u4F9B\uFF0C\u4E0E MN \u65E0\u5173\u3002\u70B9\u51FB\u67E5\u770B\u8BBE\u7F6E\u65B9\u6CD5\u53CA\u6CE8\u610F\u4E8B\u9879\u3002",shortcut_pro:{help:"\u7528\u4E8E\u540C\u65F6\u89E6\u53D1\u591A\u4E2A\u52A8\u4F5C\u5E76\u4F20\u5165\u8F93\u5165\u503C\uFF0C\u70B9\u51FB\u521B\u5EFA\u81EA\u5B9A\u4E49\u6377\u5F84\u3002",label:"\u81EA\u5B9A\u4E49\u6377\u5F84",link:x("shortcut","\u81EA\u5B9A\u4E49\u6377\u5F84")},pro:"\u8BF7\u6253\u5F00\u81EA\u5B9A\u4E49\u6377\u5F84\u529F\u80FD",card_shortcut:"\u5361\u7247\u52A8\u4F5C\u6377\u5F84",action_not_work:"\u6A21\u5757\u672A\u542F\u7528\uFF0C\u8BE5\u52A8\u4F5C\u65E0\u6CD5\u6267\u884C",text_shortcut:"\u6587\u5B57\u52A8\u4F5C\u6377\u5F84",shortcut_range:"shortcut \u53C2\u6570\u8BF7\u4F20\u5165\u8303\u56F4\u5185\u7684\u6574\u6570",no_action:"\u5FC5\u987B\u4F20\u5165 action \u53C2\u6570",action_not_exist:"action \u4E0D\u5B58\u5728",option_interger:"option \u53C2\u6570\u8BF7\u4F20\u5165\u6574\u6570",info_error:"\u9519\u8BEF\u7684 actions \u53C2\u6570",type_not_exist:"type \u53C2\u6570\u4E0D\u6B63\u786E\uFF0C\u5FC5\u987B\u662F card \u6216 text"},en:{intro:"Trigger the action in MagicAction by URL Scheme, you can set a shortcut to open the URL. This feature is provided by OhMyMN, not MN. Click to view the setup method and precautions.         ",shortcut_pro:{help:"Used to trigger multiple actions at the same time and pass in input values. Click to create a custom shortcut.",label:"Custom Shortcuts",link:x("shortcut","custom-shortcuts")},pro:"Please open the custom shortcut feature",card_shortcut:"Card Action Shortcut",text_shortcut:"Text Action Shortcut",action_not_work:"Module is not enabled, the action cannot be executed",shortcut_range:"The shortcut parameter should be an integer within the range",no_action:"The action parameter must be passed in",action_not_exist:"action does not exist",option_interger:"The option parameter should be an integer",type_not_exist:"The type parameter is incorrect, it must be card or text",info_error:"Incorrect Actions parameter"}});var qc={name:"Shortcut",key:"shortcut",intro:Se.intro,link:x("shortcut"),settings:[{key:"shortcutPro",type:1,help:Se.shortcut_pro.help,label:Se.shortcut_pro.label,link:Se.shortcut_pro.link},...[...Array(8).keys()].map(e=>({key:`cardShortcut${e}`,type:6,label:`${Se.card_shortcut} ${e+1}`,option:[]})),...[...Array(4).keys()].map(e=>({key:`textShortcut${e}`,type:6,label:`${Se.text_shortcut} ${e+1}`,option:[]}))]};var Qr=C(S());var zc=C(S());var G=(0,zc.i18n)({zh:{intro:"\u4F7F\u7528 OpenAI API \u6765\u589E\u5F3A OhMyMN \u6A21\u5757\u3002",ai_not_on:"AI \u6A21\u5757\u672A\u5F00\u542F",$show_key2:["\u70B9\u51FB\u67E5\u770B Key\uFF0C\u4E0D\u8981\u8BA9\u5176\u4ED6\u4EBA\u770B\u5230","\u70B9\u51FB\u9690\u85CF Key\uFF0C\u4E0D\u8981\u8BA9\u5176\u4ED6\u4EBA\u770B\u5230"],openai_base_url:{help:"OpenAI API \u670D\u52A1\u5668\u5730\u5740",link:x("ai","openai-api-\u670D\u52A1\u5668\u5730\u5740")},prompts_url:{help:"Prompts \u6570\u636E\u6E90\uFF0C\u586B\u5199\u4E00\u5F20\u5361\u7247\u7684\u94FE\u63A5\u3002\u70B9\u51FB\u67E5\u770B\u5177\u4F53\u683C\u5F0F\u3002\u4FEE\u6539\u540E\u9700\u8981\u91CD\u65B0\u56DE\u8F66\u66F4\u65B0\u3002",not_link:"\u4E0D\u662F\u6709\u6548\u7684\u94FE\u63A5",not_found:"\u672A\u627E\u5230\u5361\u7247",no_child:"\u5361\u7247\u6CA1\u6709\u5B50\u5361\u7247",no_prompts:"Prompts \u6570\u636E\u6E90\u4E3A\u7A7A\u6216\u8005\u683C\u5F0F\u9519\u8BEF",link:x("ai","prompts-\u6570\u636E\u6E90")},defaultTemperature:{label:"\u601D\u7EF4\u53D1\u6563\u7A0B\u5EA6",help:"OpenAI temperature \u53C2\u6570\uFF0C0-2\uFF0C\u4E0D\u5EFA\u8BAE\u8D85\u8FC7 1\u3002\u9700\u8981\u51C6\u786E\u56DE\u7B54\u8BF7\u5C3D\u91CF\u8C03\u5C0F\u3002",number:"\u8BF7\u8F93\u5165 0-2 \u4E4B\u95F4\u7684\u6570\u5B57"},answer_with_card:{label:"\u57FA\u4E8E\u5361\u7247\u56DE\u7B54",help:"AI \u53EF\u4EE5\u57FA\u4E8E\u5361\u7247\u5185\u5BB9\u56DE\u7B54\u95EE\u9898\u5E76\u751F\u6210\u8BC4\u8BBA\uFF0C\u4F60\u53EF\u4EE5\u7528\u81EA\u7136\u8BED\u8A00\u6307\u5B9A\u6807\u9898\uFF0C\u6458\u5F55\uFF0C\u8BC4\u8BBA\u4EE5\u53CA\u6807\u7B7E\u3002"},ai_action_prompt:{no_prompts:"\u6CA1\u6709\u627E\u5230\u8FD9\u4E2A Prompt",label:"AI \u52A8\u4F5C (Prompts)",help:"\u8BFB\u53D6 Prompts \u6570\u636E\u6E90\u4E2D\u7684 Prompts",$option7:["\u6807\u9898\u2192\u6807\u9898","\u6807\u9898\u2192\u8BC4\u8BBA","\u6458\u5F55\u2192\u6807\u9898","\u6458\u5F55\u2192\u8BC4\u8BBA","\u5361\u7247\u2192\u6807\u9898","\u5361\u7247\u2192\u6807\u7B7E","\u5361\u7247\u2192\u8BC4\u8BBA"],select_prompts:"\u9009\u62E9 Prompts",select_io:"\u9009\u62E9\u8F93\u5165\u8F93\u51FA"},openai_api_key:{help:"OpenAI API Key",link:""},model:{label:"OpenAI \u6A21\u578B",$option3:["gpt-3.5","gpt-4"]},no_result:"\u6CA1\u6709\u83B7\u53D6\u5230\u7ED3\u679C",loading:"AI \u6B63\u5728\u601D\u8003...",translate_text:"\u7FFB\u8BD1",polishing_text:"\u6DA6\u8272",summarize_text:"\u603B\u7ED3",analyze_text:"\u89E3\u6790\u53E5\u5B50",explain_code:"\u89E3\u91CA\u4EE3\u7801",no_openai_secretkey:"\u6CA1\u6709\u8BBE\u7F6EOpenAI API Key"},en:{intro:"Use OpenAI API to enhance the OhMyMN module.",$show_key2:["Click to view the key, don't let others see","Click to hide the key, don't let others see"],openai_base_url:{help:"OpenAI API Base URL",link:x("ai","openai-api-\u670D\u52A1\u5668\u5730\u5740")},ai_not_on:"AI module is not turned on",openai_api_key:{help:"OpenAI API Key",link:x("ai","prompts-\u6570\u636E\u6E90")},model:{label:"OpenAI Model",$option3:["gpt-3.5","gpt-4"]},no_result:"No result obtained",answer_with_card:{label:"Answer with Card",help:"AI can answer questions and generate comments based on the content of the card. You can specify the title, excerpt, comment and tag in natural language."},ai_action_prompt:{label:"AI Action",select_io:"Select input and output",help:"Fetch Prompts in Prompts data source",select_prompts:"Select Prompts",no_prompts:"Prompt not found",$option7:["Title \u2192 Title","Title \u2192 Comment","Excerpt \u2192 Title","Excerpt \u2192 Comment","Card \u2192 Title","Card \u2192 Tag","Card \u2192 Comment"]},loading:"AI is thinking...",translate_text:"Translate",polishing_text:"Polish",summarize_text:"Summarize",analyze_text:"Analyze sentence",explain_code:"Explain code",no_openai_secretkey:"OpenAI API Key not set",prompts_url:{help:"Prompts data source, fill in the link of a card. Click to view the specific format. You need to press Enter to update after modification.",link:"",not_link:"Not a valid link",not_found:"Card not found",no_child:"Card has no child cards",no_prompts:"Prompts data source is empty or the format is wrong"},defaultTemperature:{label:"Temperature",help:"OpenAI Temperature parameter, 0-2, not recommended to exceed 1. Please try to reduce it if you need to answer accurately",number:"Please enter a number between 0-2"}}});var ii=C(S()),dt=C(S());var Hh=["gpt-3.5-turbo","gpt-4-turbo"];function Jh(e){switch(e){case"gpt-3.5":return"gpt-3.5-turbo";case"gpt-4":return"gpt-4-turbo";default:return"gpt-3.5-turbo"}}function Zr(e){if(e===void 0){let{promptsURL:t}=self.globalProfile.ai;if(t){let o=t.replace(ii.MN.scheme+"://note/","");e=ii.MN.db.getNoteById(o)}}if(e){let t=new dt.NodeNote(e),o=[];return(0,dt.undoGroupingWithRefresh)(()=>{t.childNodes.forEach((r,n)=>{var a,s,c,u,p,f;r.title=`${n}. ${r.title.replace(/^\d+\. /,"")}`;let i=(s=(a=r.commentsText)==null?void 0:a[1])==null?void 0:s.split(`
`),l={};if(i!=null&&i.length){let d=["title2title","title2comment","excerpt2title","excerpt2comment","card2title","card2tag","card2comment","selected_text"],h=(c=i.find(P=>/io/i.test(P)))==null?void 0:c.match(new RegExp(d.join("|"),"ig"));h!=null&&h.length&&(l.io=h.map(P=>d.indexOf(P)));let y=(u=i.find(P=>/model/i.test(P)))==null?void 0:u.match(/gpt-3.5|gpt-4/);y!=null&&y.length&&(l.model=Jh(y[0]));let k=(p=i.find(P=>/temperature/i.test(P)))==null?void 0:p.match(/\d+\.\d+|\d+/);if(k!=null&&k.length){let P=Number(k[0]);!Number.isNaN(P)&&P>=0&&P<=2&&(l.temperature=P)}let N=(f=i.find(P=>/max-tokens/i.test(P)))==null?void 0:f.match(/\d+\.\d+|\d+/);if(N!=null&&N.length){let P=Number(N[0]);Number.isNaN(P)||(l.max_tokens=P)}}o.push({desc:r.title,content:r.commentsText[0],options:l})})}),o}return[]}async function Yr(e,t){var o,r;try{let{OpenAIApiKey:n,OpenAIBaseURL:i,model:l,defaultTemperature:a}=self.globalProfile.ai;if(!n)throw G.no_openai_secretkey;let s={"Content-Type":"application/json",Authorization:`Bearer ${n}`},c=i;i.trim()===""&&(c="api.openai.com");let u={model:Hh[l[0]],temperature:Number(a),messages:e};t!=null&&t.model&&(u.model=t.model),t!=null&&t.temperature&&(u.temperature=t.temperature),t!=null&&t.max_tokens&&(u.max_tokens=t.max_tokens),dt.HUDController.show(G.loading);let p=await(0,dt.fetch)(`https://${c.replace(/^https?:\/\//,"")}/v1/chat/completions`,{method:"POST",headers:s,timeout:60,json:u}).then(function(f){return f.json()});if(dt.HUDController.hidden(),(o=p==null?void 0:p.error)!=null&&o.message)throw p.error.message;if(((r=p==null?void 0:p.choices)==null?void 0:r.length)>0)return p.choices[0].message.content.trim()}catch(n){dt.HUDController.hidden("AI: "+String(n),2);return}}var Qe=C(S());var Hc={name:"AI",key:"ai",intro:G.intro,link:x("ai"),settings:[{key:"OpenAIBaseURL",type:4,help:G.openai_base_url.help},{key:"model",type:6,label:G.model.label,option:G.model.$option3},{key:"promptsURL",type:4,help:G.prompts_url.help,link:G.prompts_url.link,check({input:e}){var n;let t=e.replace(Qr.MN.scheme+"://note/","");if(t===e)throw G.prompts_url.not_link;let o=Qr.MN.db.getNoteById(t);if(!o)throw G.prompts_url.not_found;if(!((n=o.childNotes)!=null&&n.length))throw G.prompts_url.no_child;let r=Zr(o);if(!(r!=null&&r.length))throw G.prompts_url.no_prompts;g.prompts=r}},{key:"defaultTemperature",type:5,label:G.defaultTemperature.label,help:G.defaultTemperature.help,check({input:e}){let t=Number(e);if(Number.isNaN(t)||t<0||t>2)throw G.defaultTemperature.number}},{key:"showKey",type:8,label:G.$show_key2},{key:"OpenAIApiKey",type:4,help:G.openai_api_key.help,bind:[["showKey",!0]]}],actions4card:[{key:"answerWithCard",type:3,label:G.answer_with_card.label,help:G.answer_with_card.help,async method({nodes:e,content:t}){let{defaultTemperature:o}=self.globalProfile.ai;for(let r of e){let n=Qr.MN.isZH?`\u8FD9\u662F\u4E00\u5F20\u5361\u7247(Card)\uFF0C\u5361\u7247\u91CC\u7684\u5185\u5BB9\u5982\u4E0B\uFF1A
             - \u6807\u9898(Titles)\uFF1A${r.title}

             - \u6458\u5F55(Excerpts)\uFF1A${r.excerptsText.join(`
`)}\u3002

             - \u8BC4\u8BBA(Comments): ${r.commentsText.join(`
`)}\u3002

             - \u6807\u7B7E(Tags)\uFF1A${r.tags.join(" ")}\u3002

             \u8BF7\u6309\u7167\u5361\u7247\u5185\u5BB9\u56DE\u7B54
            `:`This is a Card. The contents of the Card are as follows:
             - Titles\uFF1A${r.title}.

             - Excerpts\uFF1A${r.excerptsText.join(`
`)}.

             - Comments: ${r.commentsText.join(`
`)}.

             - Tags\uFF1A${r.tags.join(" ")}.

              Please answer according to the contents of the card.
             `,i=await Yr([{content:n,role:"system"},{content:t,role:"user"}],{temperature:Number(o)});i&&(0,Qe.undoGroupingWithRefresh)(()=>{self.globalProfile.addon.useMarkdown?r.appendMarkdownComments(i):r.appendTextComments(i)})}}},{key:"aiActionPrompts",type:2,label:G.ai_action_prompt.label,help:G.ai_action_prompt.help,option:[],async method({nodes:e,option:t}){var i,l,a;if(!((i=g.prompts)!=null&&i.length)){let s=Zr();if(s!=null&&s.length)g.prompts=s;else{(0,Qe.showHUD)(G.prompts_url.no_prompts);return}}let o=g.prompts.map(s=>{var c;return s.options.io&&(s.options.io=(c=s.options.io)==null?void 0:c.filter(u=>u!==7)),s}).filter(s=>s.options.io===void 0||!s.options.io.includes(7)),r=0;if(t!==-1){if(r=o.findIndex(s=>s.desc.startsWith(String(t))),r===-1)return(0,Qe.showHUD)(G.ai_action_prompt.no_prompts)}else if(r=(await(0,Qe.select)(o.map(s=>s.desc),"AI",G.ai_action_prompt.select_prompts,!0)).index,r===-1)return;let n=o[r];for(let s of e){let c=(a=(l=n.options)==null?void 0:l.io)!=null?a:[0,1,2,3,4,5,6],u=c[0];if(c.length>1){let{index:d}=await(0,Qe.select)(G.ai_action_prompt.$option7.filter((h,y)=>c.includes(y)),"AI",G.ai_action_prompt.select_io);u=d}let p=(()=>{switch(u){case 6:case 5:case 4:return s.allText;case 3:case 2:return s.excerptsText.join(`
`);default:return s.title}})(),f=await Yr([{content:n.content,role:"user"},{content:p,role:"user"}],n.options);f&&(0,Qe.undoGroupingWithRefresh)(()=>{switch(u){case 6:case 3:case 1:self.globalProfile.addon.useMarkdown?s.appendMarkdownComments(f):s.appendTextComments(f);break;case 4:case 0:case 2:s.title=f;break;case 5:s.appendTags(...qo(f))}})}}}],actions4text:[{key:"aiActionPromptsText",type:2,label:G.ai_action_prompt.label,help:G.ai_action_prompt.help,option:[],async method({text:e,option:t}){var l;if(!((l=g.prompts)!=null&&l.length)){let a=Zr();if(a!=null&&a.length)g.prompts=a;else{(0,Qe.showHUD)(G.prompts_url.no_prompts);return}}let o=g.prompts.filter(a=>a.options.io===void 0||a.options.io.includes(7)),r=0;if(t!==-1){if(r=o.findIndex(a=>a.desc.startsWith(String(t))),r===-1)return(0,Qe.showHUD)(G.ai_action_prompt.no_prompts)}else if(r=(await(0,Qe.select)(o.map(a=>a.desc),"AI",G.ai_action_prompt.select_prompts,!0)).index,r===-1)return;let n=o[r];return await Yr([{content:n.content,role:"system"},{content:e,role:"user"}],n.options)}}]};var li=C(S());var Jc=C(S()),qt=(0,Jc.i18n)({zh:{intro:"\u5728\u70B9\u51FB\u5361\u7247\u6216\u8005\u9009\u4E2D\u6587\u5B57\u65F6\u663E\u793A\u52A8\u4F5C\u5DE5\u5177\u680F\u3002",card_toolbar:"\u5361\u7247\u52A8\u4F5C\u5DE5\u5177\u680F",action_not_work:"\u6A21\u5757\u672A\u542F\u7528\uFF0C\u8BE5\u52A8\u4F5C\u65E0\u6CD5\u6267\u884C",text_toolbar:"\u6587\u5B57\u52A8\u4F5C\u5DE5\u5177\u680F",only_mn:"\u4EC5\u652F\u6301 MarginNote \u63D2\u4EF6\u7684 URL Scheme\uFF0C\u4F46\u4E0D\u9650\u4E8E OhMyMN"},en:{intro:"Show action toolbar when clicking card or selecting text.",card_toolbar:"Card Action Toolbar",text_toolbar:"Text Action Toolbar",only_mn:"Only support MarginNote addon's URL Scheme, but not limited to OhMyMN.",action_not_work:"Module is not enabled, the action cannot be executed"}});var Xc={name:"Toolbar",key:"toolbar",intro:qt.intro,link:x("toolbar"),settings:[...[...Array(8).keys()].map(e=>[{key:`cardToolbar${e}`,type:6,label:`${qt.card_toolbar} ${e+1}`,option:[]},{key:`cardToolbar${e}Shortcut`,type:4,bind:[`cardToolbar${e}`,1],check({input:t}){if(!t.startsWith(li.MN.scheme+"://addon"))throw qt.only_mn}}]).flat(),...[...Array(4).keys()].map(e=>[{key:`textToolbar${e}`,type:6,label:`${qt.text_toolbar} ${e+1}`,option:[]},{key:`textToolbar${e}Shortcut`,type:4,bind:[`textToolbar${e}`,1],check({input:t}){if(!t.startsWith(li.MN.scheme+"://addon"))throw qt.only_mn}}]).flat()]};var Co={shortcut:qc,gesture:Ms,toolbar:Xc,anotherautotitle:Qs,anotherautodef:Xs,autoformat:vc,autocomplete:cc,autoreplace:Cc,autolist:fc,autotag:Mc,autostyle:Nc,copysearch:Gc,autoocr:bc,autotranslate:Bc,autocomment:rc,autosimplify:Kc,ai:Hc},en={addon:Es,magicaction4card:js,magicaction4text:zs};var Zc=C(S()),ve=(0,Zc.i18n)({zh:{magicaction_from_which_module:e=>`\u8BE5\u52A8\u4F5C\u6765\u81EA\u4E8E ${e}\uFF0C\u4E0E\u5176\u4F7F\u7528\u76F8\u540C\u7684\u8BBE\u7F6E\u3002`,open_panel:"\u5207\u6362\u63A7\u5236\u9762\u677F",custom_shortcut:"\u81EA\u5B9A\u4E49\u6377\u5F84",none:"\u65E0",expand:"\u25B6 \u70B9\u51FB\u5C55\u5F00\u6240\u6709\u9009\u9879",website:"\u5B98\u7F51\u53CA\u6587\u6863\uFF1Aohmymn.marginnote.cn",intro:"OhMyMN \u662F\u4E00\u4E2A\u53EF\u4EE5\u81EA\u52A8\u5904\u7406\u6458\u5F55\u7684\u5DE5\u5177\u7BB1\uFF0C\u540C\u65F6\u4E5F\u662F MarginNote \u63D2\u4EF6\u5F00\u53D1\u6846\u67B6\u3002OhMyMN \u5B8C\u5168\u5F00\u6E90\uFF0C\u6B22\u8FCE\u53C2\u4E0E\u3002"},en:{magicaction_from_which_module:e=>`This action comes from ${e} and uses the same settings. `,open_panel:"Switch Control Panel",none:"None",custom_shortcut:"Custom Shortcut",expand:"\u25B6 Click to expand all options",website:"Website & Document: ohmymn.marginnote.cn/en",intro:"OhMyMN is a toolbox that can process excerpts automatically and also is MarginNote addon development framework. OhMyMN is completely open source, and welcome to join us."}});var Yc={header:"More",key:"more",rows:[{type:0,label:ve.website,link:g.doc},{type:0,label:ve.intro,link:g.github},{type:0,label:`









`,link:""}]};function ai(e){let t=[{type:0,label:e.intro,link:e.link}];for(let o of e.settings)if(t.push(o),o.type!==8&&o.help)switch(o.type){case 7:case 6:case 1:case 5:case 4:t.push({type:0,label:o.help,link:o.link,bind:o.bind})}return e.key==="addon"?t.splice(4,0,{type:0,label:ve.expand}):t.splice(1,0,{type:0,label:ve.expand}),{header:e.name,key:e.key,rows:t}}function Xh(e,t,o){var N,P,re,b;let r=[],n={key:[],name:[]},i=(P=(N=t.actions4card)==null?void 0:N.map(m=>({...m,module:"magicaction4card",moduleName:"MagicAction For Card"})))!=null?P:[],l=(b=(re=o.actions4text)==null?void 0:re.map(m=>({...m,module:"magicaction4text",moduleName:"MagicAction For Text"})))!=null?b:[];e.forEach(m=>{var w,_;r.push(ai(m)),(w=m.actions4card)!=null&&w.length&&i.push(...m.actions4card.map(X=>({...X,moduleName:m.name,module:m.key,help:ve.magicaction_from_which_module(m.name)+(X.help?X.help:"")}))),(_=m.actions4text)!=null&&_.length&&l.push(...m.actions4text.map(X=>{var at;return{...X,moduleName:m.name,module:(at=m.key)!=null?at:m.name.replace(/\x20/g,"").toLowerCase(),help:ve.magicaction_from_which_module(m.name)+(X.help?X.help:"")}}))}),r.forEach((m,w)=>{w&&(n.key.push(m.key),n.name.push(m.header))});let a=ai(t);a.rows.push(...i);let s=ai(o);s.rows.push(...l);let[c,u,p,f]=r;for(let m of c.rows)m.type==7&&m.key=="quickSwitch"&&(m.option=n.name);let{options:d,actionKeys:h}=Qc(a),{options:y,actionKeys:k}=Qc(s);return De.push(...h),je.push(...k),p.rows=p.rows.map(m=>(m.type==6&&(m.key.includes("selectionBar")?m.option=[ve.none,...y]:m.option=[ve.none,...d]),m)),u.rows=u.rows.map(m=>(m.type==6&&(m.key.includes("text")?m.option=[ve.none,...y]:m.option=[ve.none,...d]),m)),f.rows=f.rows.map(m=>(m.type==6&&(m.key.includes("text")?m.option=[ve.none,...y]:m.option=[ve.none,...d]),m)),r.splice(1,0,a),r.splice(2,0,s),r.push(Yc),{dataSource:r,moduleNameList:n}}function Zh(e){return e.reduce((t,o,r)=>(t[o.key]=o.rows.reduce((n,i,l)=>(i.type!=0&&(n[i.key]=[r,l]),n),{}),t),{})}function Qc(e){var r;let t=[ve.custom_shortcut,ve.open_panel],o=[];for(let n of e.rows){if(n.type!==2&&n.type!==3)continue;let i=n;t.push(i.label),(r=i.option)!=null&&r.length?(o.push({key:i.key,module:i.module,moduleName:i.moduleName}),i.type==2?i.option.forEach((l,a)=>{t.push("\u2014\u2014"+l),o.push({key:i.key,option:a,module:i.module,moduleName:i.moduleName})}):i.option[0].includes("Auto")&&(t.push("\u2014\u2014"+i.option[0]),o.push({key:i.key,option:0,module:i.module,moduleName:i.moduleName}))):i.key.includes("aiActionPrompts")||i.type===3?o.push({key:i.key,module:i.module,moduleName:i.moduleName,option:void 0}):o.push({key:i.key,module:i.module,moduleName:i.moduleName,option:0})}return{actionKeys:o,options:t}}var De=[{key:"none"},{key:"customShortcut"},{key:"switchPanel"}],je=[{key:"none"},{key:"customShortcut"},{key:"switchPanel"}],{addon:Yh,magicaction4card:Qh,magicaction4text:eg}=en,{dataSource:si,moduleNameList:kt}=Xh([Yh,...Object.values(Co)],Qh,eg),Re=Zh(si);var we=C(S());var Xo=C(S());var zt=(()=>{try{let e=Object.values(Co).reduce((t,o)=>{for(let r of o.settings)if(r.key==="on"&&"auto"in r){Object.entries(r.auto).forEach(([n,i])=>{var l;t[n]=[...(l=t[n])!=null?l:[],"index"in i?{index:i.index,status:()=>tu(o.key),method:i.method}:{index:0,status:()=>tu(o.key),method:i}]});break}return t},{});return Object.entries(e).reduce((t,[o,r])=>(t[o]=r.sort((n,i)=>n.index-i.index).map(n=>({status:n.status,method:n.method})),t),{})}catch(e){return Xo.MN.error(e),{}}})(),{actions4card:ci,actions4text:ui,checkers:eu}=Object.values({...en,...Co}).reduce((e,t)=>{var o,r;return t.settings.length&&t.settings.forEach(n=>{"check"in n&&(e.checkers[n.key]=n.check)}),(o=t.actions4card)!=null&&o.length&&t.actions4card.forEach(n=>{e.actions4card[n.key]=n.method,"check"in n&&(e.checkers[n.key]=n.check)}),(r=t.actions4text)!=null&&r.length&&t.actions4text.forEach(n=>{e.actions4text[n.key]=n.method,"check"in n&&(e.checkers[n.key]=n.check)}),e},{actions4card:{},actions4text:{},checkers:{}}),tn=Object.values(Co).reduce((e,t)=>(e.push(t.key),e),[]);function le(e){let{quickSwitch:t}=self.globalProfile.addon,o=tn.indexOf(e);return o===-1||t.includes(o)}async function Zo(e,t){try{eu[t]&&await eu[t]({input:e})}catch(o){return(0,Xo.showHUD)(o?String(o):Xo.MN.isZH?"\u683C\u5F0F\u9519\u8BEF\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165":"Input errors, please re-enter",3),!1}return!0}function tu(e){var o,r,n,i,l,a;let{quickSwitch:t}=self.globalProfile.addon;return t.includes(tn.indexOf(e))&&((a=(l=(n=(o=self.globalProfile[e])==null?void 0:o.on)!=null?n:(r=self.docProfile[e])==null?void 0:r.on)!=null?l:(i=self.notebookProfile[e])==null?void 0:i.on)!=null?a:!1)}var ou=C(S()),oe=(0,ou.i18n)({zh:{input_saved:"\u8F93\u5165\u5DF2\u4FDD\u5B58",input_clear:"\u8F93\u5165\u5DF2\u6E05\u7A7A",none:"\u65E0",sure:"\u786E\u5B9A",uninstall:{$options2:["\u91CD\u7F6E\u914D\u7F6E","\u53BB\u8BBA\u575B\u66F4\u65B0/\u53CD\u9988"],profile_reset:"\u914D\u7F6E\u5DF2\u91CD\u7F6E",have_bugs:"\u9047\u5230 Bug \u4E86\u5417\uFF1F\u53EF\u4EE5\u5C1D\u8BD5\u91CD\u7F6E\u914D\u7F6E\u6216\u8005\u66F4\u65B0\u5230\u6700\u65B0\u7248\u672C\u3002"},read_failed:"\u81EA\u5B9A\u4E49\u5185\u5BB9\u8BFB\u53D6\u5931\u8D25",detect_link:"\u68C0\u6D4B\u5230\u94FE\u63A5\uFF0C\u662F\u5426\u76F4\u63A5\u6253\u5F00\uFF1F",no_doc:`\u5F53\u524D\u7B14\u8BB0\u672C\u6CA1\u6709\u6587\u6863\uFF0C${g.title} \u65E0\u6CD5\u6B63\u5E38\u5DE5\u4F5C\u3002\u5982\u679C\u4F60\u6B63\u8981\u6253\u7B97\u6DFB\u52A0\u6587\u6863\uFF0C\u8BF7\u5728\u6DFB\u52A0\u5B8C\u6210\u540E\u91CD\u65B0\u6253\u5F00\u7B14\u8BB0\u672C\u3002`,not_select_card:"\u672A\u9009\u4E2D\u4EFB\u4F55\u8111\u56FE\u5361\u7247",not_select_area:"\u6CA1\u6709\u9009\u4E2D\u4EFB\u4F55\u533A\u57DF",no_text_selection:"\u65E0\u6CD5\u5F97\u5230\u5230\u9009\u4E2D\u533A\u57DF\u7684\u6587\u5B57",text_more_option:{$options6:["\u590D\u5236","\u8BBE\u7F6E\u4E3A\u6807\u9898","\u5408\u5E76\u6807\u9898","\u5408\u5E76\u5230\u6458\u5F55","\u8BBE\u7F6E\u4E3A\u6458\u5F55","\u8BBE\u7F6E\u4E3A\u8BC4\u8BBA"],selected_excerpt:"\u68C0\u6D4B\u5230\u60A8\u4E4B\u524D\u9009\u4E2D\u4E86\u4E00\u6761\u6458\u5F55"},copy_success:"\u590D\u5236\u6210\u529F, \u5FEB\u53BB\u7C98\u8D34\u5427!",smart_select:{title:`${g.title} \u667A\u80FD\u9009\u62E9`,$option4:["\u4EC5\u5904\u7406\u9009\u4E2D\u7684\u5361\u7247","\u4EC5\u5904\u7406\u5B50\u5361\u7247","\u4EC5\u5904\u7406\u6240\u6709\u540E\u4EE3\u5361\u7247","\u5904\u7406\u9009\u4E2D\u7684\u5361\u7247\u53CA\u5176\u540E\u4EE3\u5361\u7247"],card_with_children:"\u68C0\u6D4B\u5230\u60A8\u9009\u4E2D\u7684\u552F\u4E00\u5361\u7247\u6709\u5B50\u5361\u7247",cards_with_children:"\u68C0\u6D4B\u5230\u60A8\u9009\u4E2D\u7684\u591A\u5F20\u540C\u5C42\u7EA7\u5361\u7247\u5747\u6709\u5B50\u5361\u7247"},handle_user_action:{gesture:{alert:"\u8BE5\u529F\u80FD\u7531 OhMyMN \u63D0\u4F9B\uFF0C\u4E0E MarginNote \u65E0\u5173\u3002\u8BF7\u95EE\u60A8\u662F\u5426\u8BE6\u7EC6\u9605\u8BFB\u4F7F\u7528\u6587\u6863\uFF0C\u5E76\u77E5\u6653\u5177\u4F53\u624B\u52BF\u76D1\u6D4B\u533A\u57DF\u548C\u76F8\u5173\u4F7F\u7528\u98CE\u9669",option:["\u4E0D\u6E05\u695A\uFF0C\u67E5\u770B\u6587\u6863","\u6211\u5DF2\u77E5\u6653"]}}},en:{input_saved:"Input Saved",input_clear:"Input Clear",detect_link:"Detect link, open it directly?",no_doc:`There is no document in the notebook, ${g.title} cannot work properly. If you are about to add documents, please reopen the notebook after adding.`,none:"None",sure:"Confirm",read_failed:"Custom content read failed",uninstall:{have_bugs:"have you met a bug? Try reset profile or update to newest version.",profile_reset:"Profile has been reset",$options2:["Reset Profile","Update/Feedback"]},not_select_card:"No card is selected",not_select_area:"No area is selected",no_text_selection:"Unable to get to the text of the selection",copy_success:"Copy successfully, go ahead and paste",text_more_option:{$options6:["Copy","Set as Title","Merge Title","Merge to Excerpt","Set as Excerpt","Set as Comment"],selected_excerpt:"Detected that you previously selected an excerpt"},smart_select:{title:`${g.title} Smart Selector`,$option4:["Process only selected cards","Process only child cards","Process only all descendant cards","Process selected and descendant cards"],card_with_children:"Detect only one selected card has child cards",cards_with_children:"Detect all selected cards of the same level have child cards"},handle_user_action:{gesture:{alert:"This feature is provided by OhMyMN and not related to MarginNote. Have you read the doc and are aware of the specific gesture monitoring areas and the risks associated with their use?",option:["Not sure, check the doc","Sure, I know"]}}}});var lt=C(S());async function ru(e,t,o){let r=[];if(e!="filterCard"&&self.globalProfile.addon.panelControl.includes(2)&&oo(),self.customSelectedNodes.length)r=self.customSelectedNodes,self.customSelectedNodes=[],lt.HUDController.hidden();else if(r=lt.NodeNote.getSelectedNodes(),e==="manageProfile"){if(t>1)await Wn(r[0],t);else{if(!r.length){(0,lt.showHUD)(oe.not_select_card);return}await Wn(r[0],t)}return}else{if(!r.length){(0,lt.showHUD)(oe.not_select_card);return}let n=r.every(l=>{var a,s;return((a=r[0].parentNode)==null?void 0:a.nodeId)===((s=l.note.parentNote)==null?void 0:s.noteId)&&l.childNodes.length}),i=e==="renameTitle"&&/#\[(.+)\]/.test(o);if(self.globalProfile.magicaction4card.smartSelection&&n&&!i){let{buttonIndex:l}=await(0,lt.popup)({title:oe.smart_select.title,message:r.length>1?oe.smart_select.cards_with_children:oe.smart_select.card_with_children,type:lt.UIAlertViewStyle.Default,buttons:oe.smart_select.$option4,canCancel:!1});if(l!==0){let{children:a,descendant:s,all:c}=r.reduce((u,p)=>{let{descendant:f}=p.descendantNodes;return u.descendant.push(...f),u.children.push(...p.childNodes),u.all.push(p,...f),u},{children:[],descendant:[],all:[]});r=[a,s,c][l-1]}}}switch(e){case"filterCard":self.customSelectedNodes=ci.filterCard({content:o,nodes:r,option:t});break;default:await ci[e]({content:o,nodes:r,option:t})}}var H=C(S());async function nu(e,t,o){var i,l;let r=(i=H.MN.currentDocumentController.imageFromSelection())==null?void 0:i.base64Encoding();if(r===void 0)return(0,H.showHUD)(oe.not_select_area,2);let n;if(e.endsWith("OCR"))n=await ui[e]({text:"",imgBase64:r,option:t});else{let{preFormat:a,preOCR:s,preSimplify:c}=self.docProfile.magicaction4text,{selectionText:u}=H.MN.currentDocumentController,p=s&&le("autoocr")&&(l=await jo(r))!=null?l:u;if(!p)return(0,H.showHUD)(oe.no_text_selection,2);c&&le("autosimplify")&&(p=wo(p)),a&&le("autoformat")&&(p=xo(p)),n=await ui[e]({text:p,imgBase64:"",option:t})}if(n){if(_s(n,!0)){let{buttonIndex:u}=await(0,H.popup)({title:g.title,message:oe.detect_link,type:H.UIAlertViewStyle.Default,buttons:[oe.sure]});if(u!==-1){(0,H.openURL)(n.replace(/^.*(https?:\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]).*$/,"$1"),!0);return}}let{lastFocusNote:a}=H.MN.currentDocumentController,{noteOptions:s,showCopyContent:c}=self.globalProfile.magicaction4text;if(!a||s.length===0)c?Ft(n)>10||n.includes(`
`)?await(0,H.confirm)(g.title+" Copy",n)&&(0,H.copy)(n):((0,H.showHUD)(n,3),(0,H.copy)(n,!1)):(0,H.copy)(n);else{let u=s[0];if(s.length>1){let{index:f}=await(0,H.select)(oe.text_more_option.$options6.filter((d,h)=>s.includes(h)),g.title,oe.text_more_option.selected_excerpt);u=s[f]}let p=new H.NodeNote(a);(0,H.undoGroupingWithRefresh)(()=>{if(n)switch(u){case 0:c?((0,H.copy)(n,!1),(0,H.showHUD)(n,3)):(0,H.copy)(n);break;case 1:p.title=n;break;case 2:p.appendTitles(n);break;case 4:p.mainExcerptText=n;break;case 3:p.mainExcerptText=p.mainExcerptText+n;break;case 5:if(e==="formulaOCR")if(p.note.appendMarkdownComment)p.note.appendMarkdownComment(n);else{let{markdown:f}=self.globalProfile.autoocr;switch(f[0]){case 0:a.appendHtmlComment("```math\n"+n+"\n```","```math\n"+n+"\n```",{width:420,height:100},"MarkDownEditor");break;case 1:a.appendHtmlComment(n,n,{width:420,height:100},"MarkdownEditor");break;case 2:a.appendHtmlComment(n,n,{width:420,height:100},"MilkdownEditor");break}}else self.globalProfile.addon.useMarkdown?p.appendMarkdownComments(n):p.appendTextComments(n)}})}}}var Et=async(e,t,o,r)=>{var n,i,l,a,s;if(!(e==="text"&&we.MN.studyController.studyMode===we.StudyMode.review||e==="card"&&(we.MN.studyController.studyMode!==we.StudyMode.study||we.MN.studyController.docMapSplitMode===we.DocMapSplitMode.allDoc)))if(o!==void 0&&r!==void 0){let c=r?Lt(r):"";if(c===""||c&&await Zo(c,t.key)){await Yo({type:e,key:t.key,option:o,content:c});return}}else if(o!==void 0)await Yo({type:e,key:t.key,option:o});else switch(t.type){case 3:for(;;){let{buttonIndex:c,inputContent:u}=await(0,we.popup)({title:t.label,message:(n=t.help)!=null?n:"",type:we.UIAlertViewStyle.PlainTextInput,buttons:t.option?t.option:[oe.sure]});if(c===-1)return;let p=u?(i=Lt(u))==null?void 0:i.trim():"";if(p===void 0)(0,we.showHUD)(oe.read_failed);else if(p===""||p&&await Zo(p,t.key)){await Yo({type:e,key:t.key,option:c,content:p});return}}case 2:if(((l=t.option)==null?void 0:l.length)===0)await Yo({type:e,key:t.key,option:-1});else{let{buttonIndex:c}=await(0,we.popup)({title:t.label,message:(a=t.help)!=null?a:"",type:we.UIAlertViewStyle.Default,buttons:(s=t.option)!=null&&s.length?t.option:[oe.sure]});if(c===-1)return;await Yo({type:e,key:t.key,option:c})}}};async function Yo({type:e,key:t,option:o,content:r}){try{e==="text"?await nu(t,o,r!=null?r:""):e==="card"&&await ru(t,o,r!=null?r:"")}catch(n){we.MN.error(String(n))}}function on({swipeX:e,swipeY:t},{x:o,y:r,height:n,width:i}){let l=o===void 0||i===void 0||e===void 0||e>o&&e<o+i,a=r===void 0||n===void 0||t===void 0||t>r&&t<r+n;return l&&a}function tg(e){let{studyController:t}=qe.MN,{x:o,y:r}=e.locationInView(t.view),{width:n,height:i}=t.view.bounds;if(r<100||o<70||o>n-70||self.panel.status&&on({swipeX:o,swipeY:r},self.settingViewController.view.frame))return 0;if(self.bar.text){let{winRect:s,arrow:c}=self.bar.text,{y:u}=s;if(on({swipeY:r},{y:(c===qe.DirectionOfSelection.toLeft?u-67:u+1)-3,height:40}))return 3}if(t.studyMode!=qe.StudyMode.study)return 0;let{mindmapView:l}=t.notebookController,{selViewLst:a}=l;if(t.docMapSplitMode==qe.DocMapSplitMode.allDoc||!(a!=null&&a.length))return 0;if(a.length==1&&self.bar.card){let{width:s}=t.readerController.view.frame;if(t.docMapSplitMode==qe.DocMapSplitMode.half&&(t.rightMapMode&&o<s||!t.rightMapMode&&o>n-s))return 0;let{y:c,height:u}=self.bar.card.winRect;if(on({swipeY:r},{y:(c>60?c-67:c+u-9)-3,height:40}))return 1}else if(a.length>1){let s=n>510?500:n-50,c={x:(n-s)/2,y:i-130,height:50,width:s};if(on({swipeX:o,swipeY:r},c))return 2}return 0}async function Qo(e,t,o,r,n){if(!le("gesture"))return;let i=tg(n);if(i===0)return;let l,a="card";if(i===1&&t)l=De[t];else if(i===2&&o)l=De[o];else if(i===3&&r)a="text",l=je[r];else return;let{key:s,module:c,option:u,moduleName:p}=l;if(s!=="none")if(s=="switchPanel")ro();else if(s==="customShortcut"){let f=["singleBar","muiltBar","selectionBar"][i-1]+"Swipe"+e+"Shortcut",d=self.globalProfile.gesture[f];d&&(0,qe.openURL)(d)}else if(c&&!le(c))(0,qe.showHUD)(`${p!=null?p:c} ${Vt.action_not_work}`,2);else{let[f,d]=Re[a==="card"?"magicaction4card":"magicaction4text"][s];await Et(a,self.dataSource[f].rows[d],u)}}var iu=()=>{let e=[{view:self.dragOverlayView,gesture:Pe.initGesture.pan("onDnd")},{view:self.stretchOverlayView,gesture:Pe.initGesture.pan("onStretch")}];return mt.MN.isMac||e.push({view:mt.MN.studyController.view,gesture:Pe.initGesture.swipe(1,Pe.UISwipeGestureRecognizerDirection.Up,"onSwipeUpOnMindMapView")},{view:mt.MN.studyController.view,gesture:Pe.initGesture.swipe(1,Pe.UISwipeGestureRecognizerDirection.Down,"onSwipeDownOnMindMapView")},{view:mt.MN.studyController.view,gesture:Pe.initGesture.swipe(1,Pe.UISwipeGestureRecognizerDirection.Left,"onSwipeLeftOnMindMapView")},{view:mt.MN.studyController.view,gesture:Pe.initGesture.swipe(1,Pe.UISwipeGestureRecognizerDirection.Right,"onSwipeRightOnMindMapView")}),(0,Pe.gestureRecognizerController)(e)},lu=(0,Pe.defineGestureHandlers)({onSwipeUpOnMindMapView(e){let{singleBarSwipeUp:t,muiltBarSwipeUp:o,selectionBarSwipeUp:r}=self.globalProfile.gesture;Qo("Up",t[0],o[0],r[0],e)},onSwipeDownOnMindMapView(e){let{singleBarSwipeDown:t,muiltBarSwipeDown:o,selectionBarSwipeDown:r}=self.globalProfile.gesture;Qo("Down",t[0],o[0],r[0],e)},onSwipeLeftOnMindMapView(e){let{singleBarSwipeLeft:t,muiltBarSwipeLeft:o,selectionBarSwipeLeft:r}=self.globalProfile.gesture;Qo("Left",t[0],o[0],r[0],e)},onSwipeRightOnMindMapView(e){let{singleBarSwipeRight:t,muiltBarSwipeRight:o,selectionBarSwipeRight:r}=self.globalProfile.gesture;Qo("Right",t[0],o[0],r[0],e)},onDnd(e){let t=e.locationInView(mt.MN.studyController.view),o=mt.MN.studyController.view.bounds;if(Date.now()-At.lastTime>100&&e.state!==3){let r=e.translationInView(mt.MN.studyController.view);At.locationInButton=e.locationInView(e.view),Math.abs(r.x)<20&&Math.abs(r.y)<20&&(At.locationInButton.x-=r.x,At.locationInButton.y-=r.y)}if(e.state!==3&&(At.lastTime=Date.now()),At.locationInButton){let r=t.x-At.locationInButton.x,n=t.y-At.locationInButton.y,{x:i,y:l}=Dn({x:r,y:n},o,e.view.frame),a={...self.settingViewController.view.frame,x:i,y:l};if(Go(a,.1),e.state===3){At.lastTime=0,self.globalProfile.additional.settingViewFrame=JSON.stringify(a);let s=self.globalProfile.addon.panelPosition[0]!==6;s&&(self.globalProfile.addon.panelPosition=[6]),Ze({range:2,profileNO:self.notebookProfile.addon.profile[0]}),s&&Me({range:2,profileNO:self.notebookProfile.addon.profile[0]})}}},onStretch(e){if(e.state===1)return;let t=e.locationInView(self.settingViewController.view).y,o=e.view.frame,r=t+o.height/2,n={...self.settingViewController.view.frame,height:Math.max(100,r)};if(!(n.y+n.height>mt.MN.studyController.view.bounds.height-50)&&(Go(n),e.state===3)){self.globalProfile.additional.settingViewFrame=JSON.stringify(n);let i=self.globalProfile.addon.panelHeight[0]!==3;i&&(self.globalProfile.addon.panelHeight=[3]),Ze({range:2,profileNO:self.notebookProfile.addon.profile[0]}),i&&Me({range:2,profileNO:self.notebookProfile.addon.profile[0]})}}}),At={locationInButton:void 0,lastTime:0};var B=C(S()),Be=C(S());var Le=C(S()),ke=C(S());var pi=C(S()),au=C(S());async function su(){var t;let e=(t=zt.customOCR)==null?void 0:t.filter(o=>o.status());if(e!=null&&e.length){let o=pi.MN.currentDocumentController.imageFromFocusNote().base64Encoding();for(let r of e){let n=await r.method({imgBase64:o});if(n)return n}pi.MN.log("Custom OCR over","ocr")}}async function og(e,t,o){var n;let r=(n=zt.generateTitles)==null?void 0:n.filter(i=>i.status());if(r!=null&&r.length)for(let i of r){let l=await i.method({note:e,node:t,text:o});if(l)return l}}async function fi(e,t,o){var l,a;let r={comments:[],tags:[]},n=(l=zt.generateComments)==null?void 0:l.filter(s=>s.status()),i=(a=zt.generateTags)==null?void 0:a.filter(s=>s.status());if(n!=null&&n.length)for(let s of n){let c=await s.method({note:e,node:t,text:o});c&&r.comments.push(...c)}if(i!=null&&i.length)for(let s of i){let c=await s.method({note:e,node:t,text:o});c&&r.tags.push(...c)}return r}async function cu(e){var h,y;let{note:t,text:o,node:r,isComment:n}=e,i=r.titles,{hasTitleThen:l,dragMerge:a}=self.globalProfile.addon,{cacheTitle:s}=self.notebookProfile.additional,c,u=o,p,f={text:o,title:[],comments:[],tags:[]},d=(h=zt.modifyExcerptText)==null?void 0:h.filter(k=>k.status());if(d!=null&&d.length){for(let k of d){let N=await k.method({node:r,note:t,text:f.text});N&&(f.text=N)}u=f.text}if(!(n&&(a[0]===0||a[0]!==0&&i.length!==0&&l[0]===0))){let k=await og(t,r,f.text);if(!k&&n&&a[0]===2&&(k={title:[f.text],text:""}),k!=null&&k.title.length){c=k.title,f.text=k.text,f.comments=[...(y=k==null?void 0:k.comments)!=null?y:[],...f.comments];let N=s[self.excerptStatus.noteid];if(self.excerptStatus.isModify&&i.length&&(N==null?void 0:N.length)){let P=i.reduce((re,b,m)=>(N.some(w=>Bt.tell(w,b))&&re.unshift(m),re),[]);P.length&&(p=P[P.length-1],P.forEach(re=>{i.splice(re,1)}))}}c!=null&&c.length&&(s[self.excerptStatus.noteid]=c.map(N=>Bt.to(N)),n?l[0]===1?p!==void 0?(f.title=[...i],f.title.splice(p,0,...c)):f.title=[...i,...c]:l[0]===2&&(f.title=[...c]):p!==void 0?(f.title=[...i],f.title.splice(p,0,...c)):f.title=[...i,...c])}if(f.text||u){let k=f.text;!k&&u&&(k=u);let{tags:N,comments:P}=await fi(t,r,k);f.tags.push(...N),f.comments.push(...P)}return f}async function uu(e){var o;self.excerptStatus.isModify&&(e=e.map(r=>(0,au.removeHighlight)(r)));let t=(o=zt.modifyTitles)==null?void 0:o.filter(r=>r.status());if(t!=null&&t.length)for(let r of t){let n=await r.method({titles:e});n&&(e=n)}return e}async function pu(e){var o;let t=(o=zt.modifyStyle)==null?void 0:o.filter(r=>r.status());if(t!=null&&t.length)for(let r of t){let n=await r.method({note:e});if(n)return n}}var ee,et,ao,ln=!1,nn=!1,rn=!1,di=async e=>{var t,o,r,n,i;if(Le.MN.log("Processing Excerpt","excerpt"),ee=e,Le.MN.isMN4?et=new ke.NodeNote(ee,Le.MN.currnetNotebookId):et=new ke.NodeNote(ee),ao=et.note,nn=et.nodeId!==ee.noteId,nn&&Le.MN.log("The Excerpt is a comment","excerpt"),ln=!1,rn=!1,ee.excerptPic){let l=(r=(o=(t=Le.MN.db.getNotebookById(ee.notebookId))==null?void 0:t.options)==null?void 0:o.autoOCRMode)!=null?r:!1;Le.MN.log("The excerpt is image","ocr"),l?await(0,ke.loopBreak)(50,.1,()=>!!ee.excerptText)?(Le.MN.log("Image to text success","ocr"),ln=!0,self.excerptStatus.OCROnlineStatus="free"):(rn=!0,Le.MN.log("Image to text fail, no text","ocr")):(rn=!0,Le.MN.log("No auto-to-text option on, no image processing","ocr"))}if(rn){let{tags:l,comments:a}=await fi(ee,et,"@picture");fu({comments:a,tags:l})}else{self.docProfile.additional.needOCRWait&&(self.docProfile.additional.needOCRWait=await(0,ke.loopBreak)(50,.01,()=>self.excerptStatus.OCROnlineStatus==="begin")),self.excerptStatus.OCROnlineStatus==="begin"&&(Le.MN.log("Online OCR ing","ocr"),await(0,ke.loopBreak)(50,.1,()=>self.excerptStatus.OCROnlineStatus==="end")?Le.MN.log("Online OCR success","ocr"):Le.MN.log("Online OCR fail","ocr")),self.excerptStatus.OCROnlineStatus="free";let l=(i=await su())!=null?i:(n=ee.excerptText)==null?void 0:n.trim();if(!l)return;let{title:a,text:s,comments:c,tags:u}=await cu({note:ee,node:et,text:l,isComment:nn});rg({text:s,title:(await uu(_t(a))).join("; ")}),fu({comments:c,tags:u})}ng()};function rg({text:e,title:t}){(0,ke.undoGroupingWithRefresh)(()=>{var o,r,n;if(e)ee.excerptText=e,((o=self.excerptStatus.lastRemovedComment)==null?void 0:o.note.noteId)===ee.noteId&&(self.excerptStatus.lastRemovedComment=void 0);else if(nn){let i=ao.comments.findIndex(l=>{if(l.type==="LinkNote"){let a=Le.MN.db.getNoteById(l.noteid);return(a==null?void 0:a.createDate.getTime())===ee.createDate.getTime()}});if(i!=-1){let{removeExcerpt:l}=self.globalProfile.addon;self.excerptStatus.lastRemovedComment={nodeNote:ao,index:i,note:ee},l[0]===0&&so()}ln&&((r=ao.excerptText)==null?void 0:r.trim())===((n=ao.noteTitle)==null?void 0:n.trim())&&(ao.excerptText=t)}else ln?ee.excerptText=t:ee.excerptText="";t&&(et.title=t)})}function fu({tags:e,comments:t}){var o;((o=self.excerptStatus.lastRemovedComment)==null?void 0:o.note.noteId)===ee.noteId||!(0,ke.isNoteExist)(ee)||(0,ke.undoGroupingWithRefresh)(()=>{if(t!=null&&t.length){t=_t(t);let{cacheComment:r}=self.notebookProfile.additional,n=r[ee.noteId];if(n){let i=et.note.comments,l=[];i.forEach((a,s)=>{a.type==="TextNote"&&n.some(c=>Bt.tell(c,a.text))&&l.unshift(s)}),l.forEach(a=>{ao.removeCommentByIndex(a)})}r[ee.noteId]=t.reduce((i,l)=>(l&&i.push(Bt.to(l)),i),[]),self.globalProfile.addon.useMarkdown?et.appendMarkdownComments(...t):et.appendTextComments(...t)}if(e!=null&&e.length){e=_t(e);let{cacheTag:r}=self.notebookProfile.additional,n=r[ee.noteId],i=et.tags.filter(l=>n!=null&&n.length?!n.some(a=>Bt.tell(a,l)):!0);r[ee.noteId]=e.reduce((l,a)=>(a&&l.push(Bt.to(a)),l),[]),et.tags=[...i,...e]}})}async function ng(){var r;if(((r=self.excerptStatus.lastRemovedComment)==null?void 0:r.note.noteId)===ee.noteId||!(0,ke.isNoteExist)(ee))return;let e=await pu(ee);if(!e)return;let{color:t,style:o}=e;t===void 0&&o==null||(0,ke.undoGroupingWithRefresh)(()=>{t!==void 0&&(ee.colorIndex=t!==-1?t:12),o!==void 0&&(ee.fillIndex=o)})}function so(){if(!self.excerptStatus.lastRemovedComment)return;let{nodeNote:e,index:t,note:o}=self.excerptStatus.lastRemovedComment;(0,ke.isNoteExist)(o)&&(0,ke.isNoteExist)(e)&&(0,ke.undoGroupingWithRefresh)(()=>{e.removeCommentByIndex(t)}),self.excerptStatus.lastRemovedComment=void 0;let r=o.noteId,{cacheTitle:n,cacheComment:i,cacheTag:l}=self.notebookProfile.additional;n[r]&&(n[r]=void 0),i[r]&&(n[r]=void 0),l[r]&&(n[r]=void 0)}var gu=C(S()),an=C(S()),yu=C(hu());async function bu(e){try{let t=yu.default.parse(e);if("info"in t||"actions"in t){if(!self.globalProfile.shortcut.shortcutPro)return(0,an.showHUD)(Se.pro);let o=[];try{let{info:r,actions:n}=t;if(o=JSON.parse(n||r),!o.length)throw""}catch{throw Se.info_error}for(let r of o){let{type:n,action:i,option:l,content:a}=r;if(!i)throw Se.no_action;let s=(()=>{if(n==="card"){let d=De.find(h=>h.key===i);if(d)return{...d,type:"card"}}else if(n==="text"){let d=je.find(h=>h.key===i);if(d)return{...d,type:"text"}}else throw Se.type_not_exist})();if(!s)throw Se.action_not_exist;let{key:c,module:u,moduleName:p,type:f}=s;if(u&&!le(u))throw`${p!=null?p:u} ${Se.action_not_work}`;{let[d,h]=Re[f==="card"?"magicaction4card":"magicaction4text"][c];await Et(f,self.dataSource[d].rows[h],l===void 0?0:Number(l),a===void 0?"":String(a))}}}else{let{type:o,shortcut:r}=t;switch(o){case"card":case"text":{let n=Number(r);if(!Number.isInteger(n)||o==="card"&&(n<1||n>8)||o==="text"&&(n<1||n>4))throw Se.shortcut_range;let i=self.globalProfile.shortcut[`${o}Shortcut${Number(r)-1}`],{key:l,module:a,option:s,moduleName:c}=o==="card"?De[i[0]]:je[i[0]];if(l==="none")return;if(l=="switchPanel")ro();else if(a&&!le(a))(0,an.showHUD)(`${c!=null?c:a} ${Se.action_not_work}`,2);else{let[u,p]=Re[o==="card"?"magicaction4card":"magicaction4text"][l];await Et(o,self.dataSource[u].rows[p],s)}break}default:throw Se.type_not_exist}}}catch(t){(0,an.showHUD)(String(t),2),gu.MN.error(t)}}var ht=C(S());var xu=C(S()),wu=C(S());function _u(){let e=new UIView({x:0,y:0,width:0,height:xu.MN.isMac?30:50});e.backgroundColor=UIColor.blackColor().colorWithAlphaComponent(0);let t=hi("close",{x:-30,y:2,width:25,height:25},"onCloseButtonClick");return t.adjustsImageWhenHighlighted=!1,e.addSubview(t),e}function Cu(){oo()}function hi(e,t,o){let r=UIButton.buttonWithType(0);if(r.frame={...t},!g.imagesCache.has(e)){let i=NSData.dataWithContentsOfFile(g.path+`/icon/${e}.png`);g.imagesCache.set(e,(0,wu.isNSNull)(i)?void 0:UIImage.imageWithDataScale(i,2))}let n=g.imagesCache.get(e);return n&&r.setImageForState(n,0),r.autoresizingMask=1<<0|1<<3,r.layer.cornerRadius=8,r.layer.masksToBounds=!0,r.addTargetActionForControlEvents(self,o+":",1<<6),r}function Su(){let t=new UIView({x:0,width:0,height:20,y:0});return t.backgroundColor=UIColor.blackColor().colorWithAlphaComponent(0),t}var So=C(S());function er(e){if(!!le("toolbar"))return{add(){if(e==="card"){let{winRect:t}=self.bar.card,{height:o,width:r}=self.cardActionBar.view.frame;self.cardActionBar.view.frame={x:t.x,y:(t.y>60?t.y-67-35:t.y+t.height-9+40)+(ht.MN.isMacMN3?0:ht.MN.isMacMN4?-10:-3),height:o,width:t.width},self.cardActionBar.reload(t.width!==r),self.cardActionBar.view.superview?self.cardActionBar.view.hidden=!1:ht.MN.studyController.view.addSubview(self.cardActionBar.view)}else{let{winRect:t,arrow:o}=self.bar.text,{height:r}=self.textActionBar.view.frame;self.textActionBar.view.frame={x:t.x,y:(o===So.DirectionOfSelection.toLeft?t.y-67-35:t.y+1+40)+(ht.MN.isMacMN3?0:ht.MN.isMacMN4?-10:-3),height:r,width:t.width},self.textActionBar.reload(),self.textActionBar.view.superview?self.textActionBar.view.hidden=!1:ht.MN.studyController.view.addSubview(self.textActionBar.view)}},remove(){e==="card"?self.cardActionBar.view.hidden=!0:self.textActionBar.view.hidden=!0}}}function gi(e){let n=new UIView({x:0,width:0,height:30,y:0}),i=0,l="";function a(){let s=0,c=[],u="";return Array.from({length:e==="card"?8:4}).forEach((p,f)=>{let d=self.globalProfile.toolbar[e+"Toolbar"+f][0];if(d){let h=e==="card"?De[d].key:je[d].key;u+=h;let y=hi(h,{x:s++*(30+5),y:0,height:30,width:30},"onToolbarButtonClick");c.push(y),y.tag=4096+d*1e4+f*100+(e==="card"?0:1),y.layer.borderColor=ht.MN.currentThemeColor,y.backgroundColor=ht.MN.currentThemeColor,y.layer.borderWidth=3,y.layer.cornerRadius=5,y.layer.shadowColor=UIColor.blackColor(),y.layer.shadowOffset={width:0,height:1},y.layer.masksToBounds=!1,y.layer.shadowRadius=1,y.layer.shadowOpacity=.5}}),{buttons:c,totalKey:u,length:s}}return{view:n,reload(s=!1){let{buttons:c,length:u,totalKey:p}=a();if(u){let f=c[u-1].frame.x+30,d=(()=>{let h=e==="card"?n.frame.x+n.frame.width/2-f/2+2.5:n.frame.x-f/2+2.5;if(h<30)return 30;let{width:y}=ht.MN.studyController.view.bounds;return h>y-30-f?y-30-f:h})();n.frame={...n.frame,width:f,x:d},(i!==u||l!==p||s)&&(n.subviews.forEach(h=>h.removeFromSuperview()),c.forEach(h=>n.addSubview(h)))}else n.hidden=!0;i=u,l=p}}}function ku(e){let t=e.tag,o=t%2?"text":"card",r=Math.floor((t-4096)/100)%100,n=Math.floor((t-4096)/1e4);cg(o,`${o}Toolbar${r}Shortcut`,n)}async function cg(e,t,o){if(!le("toolbar"))return;let r;e==="card"?r=De[o]:r=je[o];let{key:n,module:i,option:l,moduleName:a}=r;if(n!=="none")if(n=="switchPanel")ro();else if(n==="customShortcut"){let s=self.globalProfile.toolbar[t];s&&(0,So.openURL)(s)}else if(i&&!le(i))(0,So.showHUD)(`${a!=null?a:i} ${qt.action_not_work}`,2);else{let[s,c]=Re[e==="card"?"magicaction4card":"magicaction4text"][n];await Et(e,self.dataSource[s].rows[c],l)}}function ug(e){let{studyController:t}=B.MN,{width:o}=t.readerController.view.frame,{width:r}=t.view.bounds;return!!(t.docMapSplitMode==Be.DocMapSplitMode.half&&(t.rightMapMode&&e<o||!t.rightMapMode&&e>r-o))}var pg=[{event:g.key+"InputOver",handler:"onInputOver"},{event:g.key+"ButtonClick",handler:"onButtonClick"},{event:g.key+"SelectChange",handler:"onSelectChange"},{event:g.key+"SwitchChange",handler:"onSwitchChange"}],fg=["OCRImageEnd","OCRImageBegin","AddonBroadcast","PopupMenuOnNote","ProcessNewExcerpt","ChangeExcerptRange","PopupMenuOnSelection","ClosePopupMenuOnNote","ClosePopupMenuOnSelection"],yi=(0,Be.eventObserverController)([...pg,...fg]),Tu=(0,Be.defineEventHandlers)({async onButtonClick(e){if(self.window!==B.MN.currentWindow)return;B.MN.log("Click a button","event");let{row:t,type:o}=e.userInfo;await Et(o,t)},async onSwitchChange(e){if(self.window!==B.MN.currentWindow)return;B.MN.log("Switch the switch","event");let{name:t,key:o,status:r}=e.userInfo;await Br(t,o,r)},async onSelectChange(e){if(self.window!==B.MN.currentWindow)return;B.MN.log("Change the selection","event");let{name:t,key:o,selections:r}=e.userInfo;switch(o){case"panelPosition":ut(void 0,r[0]);break;case"panelHeight":ut(r[0]);break}await Br(t,o,r)},async onInputOver(e){if(self.window!==B.MN.currentWindow)return;B.MN.log("Input","event");let{name:t,key:o,content:r}=e.userInfo;switch(Ln(o,r),(0,Be.showHUD)(r?oe.input_saved:oe.input_clear),o){case"baiduApiKey":case"baiduSecretKey":self.globalProfile.additional.autoocr.lastGetToken=0}await Br(t,o,r)},onOCRImageBegin(e){self.window===B.MN.currentWindow&&(self.docProfile.additional.needOCRWait=!0,self.excerptStatus.OCROnlineStatus="begin",B.MN.log("Online OCR begin","ocr"))},async onOCRImageEnd(e){self.window===B.MN.currentWindow&&(self.excerptStatus.OCROnlineStatus="end",B.MN.log("Online OCR end","ocr"))},onPopupMenuOnSelection(e){var t;if(self.window===B.MN.currentWindow){if(le("gesture")||le("toolbar")){let[o,r,n,i]=JSON.parse(`[${e.userInfo.winRect.replace(/[{}]/g,"")}]`);self.bar.text={winRect:{x:o,y:r,width:n,height:i},arrow:e.userInfo.arrow},(t=er("text"))==null||t.add()}B.MN.log("Popup menu on selection open","event")}},onClosePopupMenuOnSelection(e){var t;self.window===B.MN.currentWindow&&((le("gesture")||le("toolbar"))&&((t=er("text"))==null||t.remove(),self.bar.text=void 0),self.excerptStatus.OCROnlineStatus="free",B.MN.log("Popup menu on selection close","event"))},async onPopupMenuOnNote(e){var t;if(self.window===B.MN.currentWindow&&B.MN.studyController.studyMode===Be.StudyMode.study&&(B.MN.log("Popup menu on note open","event"),le("gesture")||le("toolbar"))){let[o,r,n,i]=JSON.parse(`[${e.userInfo.winRect.replace(/[{}]/g,"")}]`);if(ug(o+n))return;self.bar.card={winRect:{x:o,y:r,width:n,height:i},lastShow:Date.now()},(t=er("card"))==null||t.add()}},onClosePopupMenuOnNote(e){var t;if(self.window===B.MN.currentWindow&&B.MN.studyController.studyMode===Be.StudyMode.study){if(self.excerptStatus.OCROnlineStatus="free",le("gesture")||le("toolbar")){if(self.bar.card&&Date.now()-self.bar.card.lastShow<500)return;(t=er("card"))==null||t.remove(),self.bar.card=void 0}B.MN.log("Popup menu on note close","event")}},onChangeExcerptRange(e){if(self.window!==B.MN.currentWindow||B.MN.studyController.studyMode!==Be.StudyMode.study)return;B.MN.log("Change excerpt range","event"),self.excerptStatus.noteid=e.userInfo.noteid;let t=B.MN.db.getNoteById(self.excerptStatus.noteid);self.excerptStatus.isModify=!0,di(t)},onProcessNewExcerpt(e){if(self.window!==B.MN.currentWindow||B.MN.studyController.studyMode!==Be.StudyMode.study)return;B.MN.log("Process new excerpt","event"),self.excerptStatus.noteid=e.userInfo.noteid;let t=B.MN.db.getNoteById(e.userInfo.noteid);self.excerptStatus.isModify=!1,so(),di(t)},async onAddonBroadcast(e){if(self.window!==B.MN.currentWindow||!le("shortcut")||B.MN.studyController.studyMode===Be.StudyMode.review)return;B.MN.log("Addon broadcast","event");let{message:t}=e.userInfo,o=t.replace(new RegExp(`^${g.key}\\?`),"");t!==o&&await bu(o)}});var J=C(S()),ze=C(S());var Nu=C(S());var bi=C(S()),Ue=C(S());var vu=C(S()),Ht=(0,vu.i18n)({zh:{input_enter:"\u8F93\u5165\u5B8C\u6309\u56DE\u8F66\uFF08Enter\uFF09\u4FDD\u5B58",none:"\u65E0",expand:"\u25B6 \u70B9\u51FB\u5C55\u5F00\u6240\u6709\u9009\u9879",collapse:"\u25BC \u70B9\u51FB\u6536\u8D77\u6240\u6709\u9009\u9879"},en:{input_enter:"Press Enter to save",none:"None",expand:"\u25B6 Click to expand all options",collapse:"\u25BC Click to collapse all options"}});var ce=C(S());var gt={label:e=>{if(ce.MN.isZH)return 16;{let t=Math.floor(380/mo(e));return t>15?15:t}},input:15,plain:12,selectButton:13};function sn(e){return e.section*100+e.row+999}function Mt(e){if(self.settingViewCache.offModules.has(e))return self.settingViewCache.offModules.get(e);if(e==="more"||e==="addon"||e==="magicaction4card"||e==="magicaction4text"){self.settingViewCache.offModules.set(e,void 0);return}let[t,o]=Re.addon.quickSwitch,r=self.dataSource[t].rows[o].selections,n=tn.indexOf(e);if(n===-1){self.settingViewCache.offModules.set(e,void 0);return}else{let i=r.includes(n);return self.settingViewCache.offModules.set(e,!i),!i}}function dg(){return self.dataSource.length}function mg(e,t){let{key:o}=self.dataSource[t];return o==="more"?self.dataSource[t].rows.length:Mt(o)?0:self.settingViewCache.expandSections.has(o)?self.dataSource[t].rows.length:o==="addon"?5:2}function hg(e,t){let{key:o,header:r}=self.dataSource[t];return Mt(o)?void 0:r}function gg(e,t){let{key:o,header:r}=self.dataSource[t];return Mt(o)?.01:30}function yg(e,t){let{key:o,header:r}=self.dataSource[t];if(Mt(o))return;let n=UITableViewCell.makeWithStyleReuseIdentifier(0,"HeaderCellID");return n.selectionStyle=0,n.textLabel.opaque=!1,n.textLabel.textAlignment=0,n.textLabel.lineBreakMode=0,n.textLabel.numberOfLines=0,n.textLabel.textColor=UIColor.whiteColor(),n.textLabel.font=UIFont.boldSystemFontOfSize(16),n.textLabel.text=r,n.contentView.backgroundColor=g.mainColor,n}function Rt(e,t){try{return!(Array.isArray(e[0])?e:[e]).every(r=>(Array.isArray(r[0])?r:[r]).some(i=>{var p,f,d,h;let[l,a]=i,[s,c]=l==="quickSwitch"?Re.addon.quickSwitch:(f=(p=Re)==null?void 0:p[t])==null?void 0:f[l];if(s===void 0)throw`bind key does not exist\uFF1A${l}`;let u=(h=(d=self.dataSource)==null?void 0:d[s].rows)==null?void 0:h[c];if((u.type===1||u.type===8)&&typeof a=="boolean")return u.status===a;if(u.type===6||u.type===7){if(typeof a=="number")return u.selections.includes(a);if(Array.isArray(a))return a.some(y=>u.selections.includes(y))}return!1}))}catch(o){return ce.MN.error(String(o)),o}}function bg(e,t){var i,l;let{rows:o,key:r}=self.dataSource[t.section],n=o[t.row];switch(n.type){case 2:case 3:if(n.module&&Mt(n.module))return 0;break;case 8:return n.bind&&Rt(n.bind,r)?0:30;case 0:{if(n.bind&&Rt(n.bind,r))return 0;let a=ws(n.label,45).length-1,s=(l=(i=n.label.match(/\n/g))==null?void 0:i.length)!=null?l:0;return(a>s?a:s)*15+30}default:if(n.bind&&Rt(n.bind,r))return 0}return 40}function xg(e,t){var i,l,a,s;let{rows:o,key:r}=self.dataSource[t.section],n=o[t.row];switch(n.type){case 0:{let c=UITableViewCell.makeWithStyleReuseIdentifier(0,"PlainTextCellID");return!ce.MN.isMacMN3&&n.bind&&Rt(n.bind,r)&&(c.hidden=!0),c.selectionStyle=0,c.textLabel.opaque=!1,c.textLabel.textAlignment=0,c.textLabel.lineBreakMode=0,c.textLabel.numberOfLines=0,c.textLabel.textColor=UIColor.grayColor(),c.textLabel.font=UIFont.systemFontOfSize(gt.plain),n.link?c.textLabel.text=`\u238B ${n.label}`:r==="more"||t.row===0||t.row===1||r==="addon"&&t.row===4?c.textLabel.text=n.label:c.textLabel.text=`\u2191 ${n.label}`,c}case 8:{let c=UITableViewCell.makeWithStyleReuseIdentifier(0,"ExplandCellID");return!ce.MN.isMacMN3&&n.bind&&Rt(n.bind,r)&&(c.hidden=!0),c.selectionStyle=0,c.textLabel.opaque=!1,c.textLabel.textAlignment=0,c.textLabel.lineBreakMode=0,c.textLabel.numberOfLines=0,c.textLabel.textColor=UIColor.grayColor(),c.textLabel.font=UIFont.systemFontOfSize(gt.plain),n.status?c.textLabel.text=`\u25BC ${n.label[1]}`:c.textLabel.text=`\u25B6 ${n.label[0]}`,c}case 2:case 3:{let c=UITableViewCell.makeWithStyleReuseIdentifier(0,"ButtonCellID");if(c.textLabel.font=UIFont.systemFontOfSize(gt.label(n.label)),ce.MN.isMacMN3&&(c.textLabel.textColor=g.textColor),c.textLabel.text=n.label,!g.imagesCache.has(n.key)){let p=NSData.dataWithContentsOfFile(g.path+`/icon/${n.key}.png`);g.imagesCache.set(n.key,(0,ce.isNSNull)(p)?void 0:UIImage.imageWithDataScale(p,2))}let u=g.imagesCache.get(n.key);return u&&(c.imageView.image=u),c}case 1:{let c=UITableViewCell.makeWithStyleReuseIdentifier(0,"SwitchCellID");!ce.MN.isMacMN3&&n.bind&&Rt(n.bind,r)&&(c.hidden=!0),c.selectionStyle=0,c.textLabel.text=n.label,c.textLabel.font=UIFont.systemFontOfSize(gt.label(n.label)),ce.MN.isMacMN3&&(c.textLabel.textColor=g.textColor);let u=cn.switch((i=n.status)!=null?i:!1),p=u.frame;return p.x=c.contentView.frame.width-p.width-10,u.frame=p,u.autoresizingMask=1<<0,u.tag=sn(t),c.contentView.addSubview(u),c}case 5:{let c=UITableViewCell.makeWithStyleReuseIdentifier(0,"inlineInputCellID");!ce.MN.isMacMN3&&n.bind&&Rt(n.bind,r)&&(c.hidden=!0),c.selectionStyle=0,c.textLabel.font=UIFont.systemFontOfSize(gt.label(n.label)),ce.MN.isMacMN3&&(c.textLabel.textColor=g.textColor),c.textLabel.text=n.label;let u=cn.inlineInput((l=n.content)!=null?l:""),p=u.frame;return p.x=c.contentView.frame.width-p.width-10,u.frame=p,u.autoresizingMask=1<<0,u.tag=sn(t),c.contentView.addSubview(u),c}case 4:{let c=UITableViewCell.makeWithStyleReuseIdentifier(0,"inputCellID");!ce.MN.isMacMN3&&n.bind&&Rt(n.bind,r)&&(c.hidden=!0),c.textLabel.font=UIFont.systemFontOfSize(gt.label(n.content)),ce.MN.isMacMN3&&(c.textLabel.textColor=g.textColor),c.selectionStyle=0;let u=cn.input((a=n.content)!=null?a:"");return u.autoresizingMask=1<<0,u.tag=sn(t),c.contentView.addSubview(u),c}case 7:case 6:{let c=UITableViewCell.makeWithStyleReuseIdentifier(0,"selectCellID");!ce.MN.isMacMN3&&n.bind&&Rt(n.bind,r)&&(c.hidden=!0),c.textLabel.font=UIFont.systemFontOfSize(gt.label(n.label)),c.textLabel.numberOfLines=0,ce.MN.isMacMN3&&(c.textLabel.textColor=g.textColor),c.textLabel.text=n.label,c.selectionStyle=0;let u=cn.select(n.type==6?(s=n.option[n.selections[0]])!=null?s:n.option[0]:n.selections.length?`${n.selections.length} \u2713`:Ht.none),p=u.frame;return p.x=c.contentView.frame.width-p.width-10,u.frame=p,u.autoresizingMask=1<<0,u.tag=sn(t),c.contentView.addSubview(u),c}}}var cn={switch(e){let t={x:0,y:5,width:70,height:30},o=new UISwitch(t);return o.addTargetActionForControlEvents(self,"switchChange:",1<<12),o.backgroundColor=UIColor.clearColor(),o.on=e,o},select(e){let t={x:0,y:5,width:70,height:30},o=new UIButton(t);return e=e.replace(new RegExp(`^[ \u2014${Ne.hollow_circle_number}]+`),""),o.setTitleForState(mo(e)<=8?e:xs(e,0,6).trimEnd()+"...",0),o.setTitleColorForState(UIColor.whiteColor(),0),o.backgroundColor=g.mainColor,o.layer.cornerRadius=10,o.layer.masksToBounds=!0,o.titleLabel.font=UIFont.boldSystemFontOfSize(gt.selectButton),o.titleLabel.lineBreakMode=4,o.addTargetActionForControlEvents(self,"clickSelectButton:",1<<6),o},inlineInput(e){let t={x:0,y:9,width:70,height:30};ce.MN.isMacMN3||(t.y=5,t.width=100);let o=new UITextField(t);return o.font=UIFont.systemFontOfSize(gt.input),o.textAlignment=ce.NSTextAlignment.Right,ce.MN.isMacMN3&&(o.textColor=g.textColor),o.delegate=self,o.text=e,o.placeholder="Enter",o.autoresizingMask=1<<1|1<<5,o},input(e){let t={x:40,y:9,width:250,height:30};ce.MN.isMacMN3||(t.y=5);let o=new UITextField(t);return o.font=UIFont.systemFontOfSize(gt.input),ce.MN.isMacMN3&&(o.textColor=g.textColor),o.placeholder=Ht.input_enter,o.delegate=self,o.autoresizingMask=1<<1|1<<5,o.text=e,o}},Pu={numberOfSectionsInTableView:dg,tableViewNumberOfRowsInSection:mg,tableViewCellForRowAtIndexPath:xg,tableViewHeightForRowAtIndexPath:bg,...ce.MN.isMac?{tableViewHeightForHeaderInSection:gg,tableViewViewForHeaderInSection:yg}:{tableViewTitleForHeaderInSection:hg}};function xi(e){let t=(e-999)%100,o=(e-999-t)/100;return NSIndexPath.indexPathForRowInSection(t,o)}var ko={location:void 0,lastTime:0};async function wg(e,t){e.cellForRowAtIndexPath(t).selected=!1;let o=self.dataSource[t.section],r=o.rows[t.row];switch(r.type){case 0:r.label===Ht.expand?(r.label=Ht.collapse,self.settingViewCache.expandSections.add(o.key),self.tableView.reloadData()):r.label===Ht.collapse?(r.label=Ht.expand,self.settingViewCache.expandSections.delete(o.key),self.tableView.reloadData()):r.link&&(self.globalProfile.addon.doubleLink?Date.now()-ko.lastTime<500&&t===ko.location?((0,Ue.openURL)(r.link,!0),ko.lastTime=0,ko.location=void 0):(ko.lastTime=Date.now(),ko.location=t):(0,Ue.openURL)(r.link,!0));break;case 3:case 2:o.key==="magicaction4card"?(0,Ue.postNotification)(g.key+"ButtonClick",{row:r,type:"card"}):o.key==="magicaction4text"&&(0,Ue.postNotification)(g.key+"ButtonClick",{row:r,type:"text"});break;case 8:r.status=!r.status,self.tableView.reloadData(),(0,Ue.postNotification)(g.key+"SwitchChange",{name:o.key,key:r.key,status:r.status})}}async function _g(e){let t=xi(e.tag),o=self.dataSource[t.section],r=o.rows[t.row],n=e.text.trim();return(0,Ue.isNoteLink)(n)&&(0,Ue.openURL)(n),(!n||await Zo(n,r.key))&&(e.resignFirstResponder(),r.content=n,(0,Ue.postNotification)(g.key+"InputOver",{name:o.key,key:r.key,content:n})),!0}function Cg(e){let t=xi(e.tag),o=self.dataSource[t.section],r=o.rows[t.row];r.status=!r.status,self.tableView.reloadData(),(0,Ue.postNotification)(g.key+"SwitchChange",{name:o.key,key:r.key,status:r.status})}var un;async function Sg(e){var l;let{indexPath:t,selection:o,menuController:r}=e,n=self.dataSource[t.section],i=n.rows[t.row];if(self.dataSource[t.section].rows[t.row].type==6)self.dataSource[t.section].rows[t.row].selections=[o],(0,Ue.postNotification)(g.key+"SelectChange",{name:n.key,key:i.key,selections:[o]}),self.popoverController&&self.popoverController.dismissPopoverAnimated(!0);else{let a=i.selections,s=i.selections.includes(o)?a.filter(c=>c!=o):[o,...a];self.dataSource[t.section].rows[t.row].selections=s,un={name:n.key,key:i.key,selections:s.sort()},r.commandTable=(l=r.commandTable)==null?void 0:l.map((c,u)=>(c.checked=i.selections.includes(u),c)),r.menuTableView.reloadData()}(i.key==="quickSwitch"||i.key==="profile")&&self.settingViewCache.offModules.clear(),self.tableView.reloadData()}function kg(e){try{let t=xi(e.tag),o=self.dataSource[t.section],r=o.rows[t.row],n=MenuController.new(),i=44,l=1e-5,a=(u,p,f)=>{try{if(u==="gesture"){let{module:d}=p.includes("selectionBar")?je[f]:De[f];return d?Mt(d):!1}else if(u==="shortcut"){let{module:d,key:h}=p.includes("text")?je[f]:De[f];return h==="customShortcut"?!0:d?Mt(d):!1}else if(u==="toolbar"){let{module:d,key:h}=p.includes("text")?je[f]:De[f];return d?Mt(d):!1}else return!1}catch{return!0}};n.commandTable=r.option.map((u,p)=>({title:u,object:self,selector:"selectAction:",height:a(o.key,r.key,p)?l:i,param:{indexPath:t,menuController:n,selection:p},checked:r.selections.includes(p)}));let s=Math.max(...r.option.map(u=>mo(u)))*10+80;n.preferredContentSize={width:s>300?300:s,height:i*n.commandTable.filter(u=>u.height!==l).length};let c=bi.MN.studyController.view;self.popoverController=new UIPopoverController(n),self.popoverController.presentPopoverFromRect(e.convertRectToView(e.bounds,c),c,1<<3,!0),self.popoverController.delegate=self}catch(t){bi.MN.error(t)}}function Tg(){un&&((0,Ue.postNotification)(g.key+"SelectChange",un),un=void 0)}var $u={popoverControllerDidDismissPopover:Tg,tableViewDidSelectRowAtIndexPath:wg,textFieldShouldReturn:_g,clickSelectButton:kg,switchChange:Cg,selectAction:Sg};var tr=C(S());var Iu={viewDidLoad(){self.tableView.allowsSelection=!0,self.view.layer.cornerRadius=10,self.view.layer.borderWidth=2,self.settingViewCache={offModules:new ho,expandSections:new Set}},viewWillAppear(){self.tableView.reloadData(),tr.MN.isMacMN3&&(self.tableView.backgroundColor=tr.MN.currentThemeColor,g.textColor=tr.MN.app.currentTheme=="Gray"||tr.MN.app.currentTheme=="Dark"?UIColor.whiteColor():UIColor.blackColor()),self.view.layer.borderColor=g.mainColor}};var Eu=JSB.defineClass((0,Nu.getObjCClassDeclar)("SettingViewController","UITableViewController"),{...Iu,...Pu,...$u});var wi=(0,ze.defineLifecycleHandlers)({instanceMethods:{sceneWillConnect(){self.addon={key:g.key,title:g.title},J.MN.log("Open a new window","lifecycle"),self.panel={status:!1,lastOpenPanel:0,lastClickButton:0,lastReaderViewWidth:0},self.metadata={data:void 0,lastFetch:0},self.excerptStatus={OCROnlineStatus:"free",isModify:!1,noteid:"",lastRemovedComment:void 0},self.bar={},self.isFirstOpenDoc=!0,self.customSelectedNodes=[],self.globalProfile=de(go),self.docProfile=de(no),self.notebookProfile=de(io),self.tempProfile=de(Lr),self.dataSource=de(si),self.settingViewController=Eu.new(),self.dragOverlayView=_u(),self.stretchOverlayView=Su(),self.cardActionBar=gi("card"),self.textActionBar=gi("text"),self.settingViewController.addon=self.addon,self.settingViewController.dataSource=self.dataSource,self.settingViewController.globalProfile=self.globalProfile,self.settingViewController.docProfile=self.docProfile,self.settingViewController.notebookProfile=self.notebookProfile},notebookWillOpen(e){var t,o;J.MN.log("Open a notebook","lifecycle"),J.MN.studyController.studyMode!==ze.StudyMode.review&&(self.isFirstOpenDoc||Me({range:3,notebookid:e}),yi.add(),self.gestureRecognizers=iu(),self.gestureRecognizers.add(),((o=(t=J.MN.db.getNotebookById(e))==null?void 0:t.documents)==null?void 0:o.length)===0&&(self.isFirstOpenDoc?(self.isFirstOpenDoc=!1,Me({range:0,docmd5:"00000000",notebookid:e})):Me({range:1,docmd5:"00000000"})))},documentDidOpen(e){J.MN.log("Open a document","lifecycle"),J.MN.studyController.studyMode!==ze.StudyMode.review&&(self.isFirstOpenDoc?(J.MN.log("First open a document","lifecycle"),self.isFirstOpenDoc=!1,Me({range:0,docmd5:e,notebookid:J.MN.currnetNotebookId})):Me({range:1,docmd5:e}))},notebookWillClose(e){J.MN.log("Close a notebook","lifecycle"),J.MN.studyController.studyMode!==ze.StudyMode.review&&(so(),Ur(),Ze({range:3,notebookid:e}),oo(),yi.remove(),self.gestureRecognizers.remove())},documentWillClose(e){J.MN.log("Close a document","lifecycle"),J.MN.studyController.studyMode!==ze.StudyMode.review&&Ze({range:1,docmd5:e})},sceneDidDisconnect(){J.MN.log("Close a window","lifecycle"),so(),J.MN.isMac&&J.MN.currentDocmd5&&J.MN.currnetNotebookId&&(Ur(),Ze({range:0,docmd5:J.MN.currentDocmd5,notebookid:J.MN.currnetNotebookId}))},sceneWillResignActive(){J.MN.log("Window is inactivation","lifecycle"),so(),!J.MN.isMac&&J.MN.currentDocmd5&&J.MN.currnetNotebookId&&(Ur(),Ze({range:0,docmd5:J.MN.currentDocmd5,notebookid:J.MN.currnetNotebookId}))},sceneDidBecomeActive(){!J.MN.isMac&&ut(),J.MN.log("Window is activated","lifecycle")}},classMethods:{async addonWillDisconnect(){J.MN.log("Addon disconected","lifecycle");let{buttonIndex:e}=await(0,ze.popup)({title:g.title,message:oe.uninstall.have_bugs,buttons:oe.uninstall.$options2});switch(e){case 0:{Fn(),self.isFirstOpenDoc=!0,(0,ze.showHUD)(oe.uninstall.profile_reset,2);break}case 1:g.forum&&(0,ze.openURL)(g.forum)}},async addonDidConnect(){J.MN.log("Addon connected","lifecycle")}}});var Ru=JSB.defineClass((0,Au.getObjCClassDeclar)(g.title,"JSExtension"),{onCloseButtonClick:Cu,onToolbarButtonClick:ku,...wi.instanceMethods,...Ss,...lu,...Tu},wi.classMethods);JSB.newAddon=e=>(g.path=e,Ru);})();

} catch (e) {
  Application.sharedInstance().alert("OhMyMN-"+String(e))
}

